(function(){var App,Base64,Blocked,BlockedCheck,Button,ButtonBig,ButtonChange,ButtonCheck,ButtonCircle,ButtonCustom,ButtonEventSetup,ButtonFactory,ButtonHidden,ButtonHiddenWidgetInsert,ButtonInsert,ButtonPng,ButtonRound,ButtonShow,ButtonSquare,CSS,Chat,ChatBlocked,ChatFeedback,ChatInactive,ChatMinimized,ChatMinimizedQuitWait,ChatMinimizedQuitWaitDisconnect,ChatOffline,ChatOperatorDisconnect,ChatQuit,ChatQuitWait,ChatQuitWaitDisconnect,ChatRating,ChatReconnecting,ChatReconnectingIntermediate,ChatReopen,ChatSendQuit,ChatUserQuit,ChatUserQuitDisconnect,ChatWaitQuit,CheckDisclaimer,CheckMobileDevice,CheckPostChatFifth,CheckPostChatFirst,CheckPostChatFourth,CheckPostChatLast,CheckPostChatSecond,CheckPostChatThird,CheckPreChatFirst,CheckPreChatLast,CheckPreChatSecond,CheckPreChatThird,CheckScriptPostion,CheckSlotAvailable,CheckTranscriptForm,Config,ConfigSetup,CustomCSS,Disclaimer,DisclaimerAvailableCheck,ErrorMessage,EventSetup,ExitIntent,ExpiredWarning,FSM,FacebookLike,FacebookLoader,FontLoader,GroupSelect,GroupSelectAvailableCheck,Idle,Init,KeyHandler,KeyHandlerFactory,KeyHandlerLivePreview,LoadStage2,NoCookies,NoCookiesMessage,NoStateCheck,NoSwitch,Offline,OfflineMessage,OfflineMessageDone,OfflineMessageForm,OfflineMessageProcess,OfflineMessageScreenshot,OfflineMessageScreenshotSend,OfflineMessageSend,OfflineMessageSent,OfflineMessageView,PageUnloading,PassiveConnectAvailableCheck,PassiveConnectOffer,PassiveConnectSlotCreate,PassiveConnectSlotStart,PassiveConnectSlotVerify,PassiveConnectSocketConnect,PassiveConnectStart,Popup,Position,PostSurveyForm,PreSurveyAvailableCheck,PreSurveyForm,ProactiveActiveSlotCreate,ProactiveActiveSlotStart,ProactiveActiveSlotVerify,ProactiveActiveSocketConnect,ProactiveEventSetup,ProactiveOffer,ProactivePassiveSlotCreate,ProactivePassiveSlotStart,ProactivePassiveSlotVerify,ProactivePassiveSocketConnect,ProactiveSlotAvailable,ProactiveSlotCheck,ProactiveSlotOfferActive,ProactiveSlotOfferPassive,ProactiveSlotOfferPassiveStart,ProactiveSlotReject,ProactiveSlotRejected,ProactiveSlotUnavailable,ProactiveTimer,Push,Pusher,PusherConnect,QuotaWarning,Rating,RegisterAvailableCheck,RegisterFacebookApiMe,RegisterFacebookLogin,RegisterForm,RegisterOptions,RemoteApiMode,RemoteControlCheck,ResetState,RestartEventSetup,RestartFacebookLoader,RestartSlot,RestartSlotCreate,RestartSlotPlayback,RestartSlotStart,RestartSlotVerify,RestartSocketConnect,RestartTwitterLoader,RestoreState,Screenshot,ServerHibernate,ServerHibernateWakeup,ServerHibernateWakeupSlotVerify,Session,SessionFactory,SessionSetup,SessionStorage,SessionStoragePrivacy,Setup,SetupError,Singleton,Slot,SlotCreate,SlotErrorDisconnect,SlotErrorHandle,SlotStart,SlotSwitch,SlotSwitchDisconnect,SlotSwitchIdle,SlotVerify,SmileyPopover,SocketConnect,Sound,SoundDummy,SoundFactory,Start,State,Survey,SwitchSlotCreate,SwitchSocketConnect,ThemeCSS,TrackingDummy,TrackingEvent,TrackingFactory,TrackingGA,TrackingGAUniversal,TrackingKissMetrics,TrackingMixpanel,TrackingPiwik,TranscriptForm,TranscriptSend,TwitterLoader,TwitterTweet,UrlParser,UserlikeReady,Warning,WhitelistCheck,WidgetGoal,WidgetInsert,WidgetVerify,button,capitalize,config,e,emotify,escapeRegExp,facebook,fsm,getMousePosition,git_version,goal,has_localstorage,hashCode,insertStringAtIndex,isElementInViewport,isIE11,is_mobile,is_ssl,loadScript,loadScripts,loadStage2,overlapDiv,popup,protocol,pusher,regex_email,regex_url,regex_url_full,regex_url_simple,rgb,serialize,session,simple_tlds,slot,sound,tracking,tracking_event,twitter,unpack,userlike,userlike_css,userlike_html,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};userlike_html='<!--[if lt IE 7]> <div id="userlike" class="lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if IE 7]> <div id="userlike" class="lt-ie9 lt-ie8"> <![endif]--><!--[if IE 8]> <div id="userlike" class="lt-ie9"> <![endif]--><!--[if gt IE 8]><!--> <div id="userlike" class=""> <!--<![endif]--> <div id="userlikePopup" class="userlikeShowLogo" style="display:none"> <div id="userlikeLogo">&nbsp;</div> <div id="userlikeClose">&nbsp;</div> <div class="userlikeDrag" id="userlikeDragTop">&nbsp;</div> <div class="userlikeDrag" id="userlikeDragBottom">&nbsp;</div> <div id="userlikeIdle" data-height="180" data-mobile-height="180" data-shrink="0" style="display:none"></div> <div id="userlikeProgress" data-height="180" data-mobile-height="180" data-shrink="0" style="display:none"> <div id="userlikeSpinner"> <div id="userlikeBounce1"></div> <div id="userlikeBounce2"></div> <div id="userlikeBounce3"></div> </div> </div> <div id="userlikeDisclaimer" data-height="240" data-mobile-height="240" data-shrink="16" style="display:none"> <div class="userlikeHeadline" id="userlikeDisclaimerHeadline"></div> <div id="userlikeDisclaimerText"></div> <div id="userlikeSubmitDisclaimer">Send</div> </div> <div id="userlikeMessage" data-height="180" data-mobile-height="180" data-shrink="16" style="display:none"> <div class="userlikeHeadline" id="userlikeMessageHeadline"></div> </div> <div id="userlikeGroupSelect" data-height="340" data-mobile-height="340" data-shrink="16" style="display:none"> <div class="userlikeHeadline" id="userlikeGroupSelectHeadline"></div> <fieldset> <div class="userlikeFieldsetWrapper"> <div class="userlikeRadioWrapper" data-select="1"> <input type="radio"> <div class="userlikeLabel"></div> </div> <div class="userlikeRadioWrapper" data-select="2"> <input type="radio"> <div class="userlikeLabel"></div> </div> <div class="userlikeRadioWrapper" data-select="3"> <input type="radio"> <div class="userlikeLabel"></div> </div> <div class="userlikeRadioWrapper" data-select="4"> <input type="radio"> <div class="userlikeLabel"></div> </div> <div class="userlikeRadioWrapper" data-select="5"> <input type="radio"> <div class="userlikeLabel"></div> </div> <div class="userlikeRadioWrapper" data-select="6"> <input type="radio"> <div class="userlikeLabel"></div> </div> </div> </fieldset> </div> <div id="userlikeRating" data-height="190" data-mobile-height="190" data-shrink="16" style="display:none"> <div class="userlikeHeadline" id="userlikeRatingHeadline"></div> <div id="userlikeStarRating"> <div><span class="userlikeOneStar">1</span></div> <div><span class="userlikeTwoStars">2</span></div> <div><span class="userlikeThreeStars">3</span></div> <div><span class="userlikeFourStars">4</span></div> <div><span class="userlikeFiveStars">5</span></div> </div> </div> <div id="userlikeFeedback" data-height="280" data-mobile-height="280" data-shrink="16" style="display:none"> <div class="userlikeHeadline" id="userlikeFeedbackHeadline"></div> <form id="userlikeFeedbackForm" onsubmit="return false;"> <textarea id="userlikeFeedbackTextarea"></textarea> <div id="userlikeSubmitFeedback">Send</div> </form> </div> <div id="userlikeSurvey" data-height="280" data-mobile-height="280" data-shrink="16" style="display:none"> <div class="userlikeHeadline" id="userlikeSurveyHeadline"></div> <fieldset> <div class="userlikeFieldsetWrapper"> <div class="userlikeRadioWrapper" data-select="1"> <input type="radio"> <div class="userlikeLabel"></div> </div> <div class="userlikeRadioWrapper" data-select="2"> <input type="radio"> <div class="userlikeLabel"></div> </div> <div class="userlikeRadioWrapper" data-select="3"> <input type="radio"> <div class="userlikeLabel"></div> </div> <div class="userlikeRadioWrapper" data-select="4"> <input type="radio"> <div class="userlikeLabel"></div> </div> </div> </fieldset> </div> <div id="userlikeFacebookLike" data-height="230" data-mobile-height="230" data-shrink="16" style="display:none"> <div class="userlikeHeadline" id="userlikeFacebookLikeHeadline"></div> <div id="userlikeFacebookLikeWrapper"></div> </div> <div id="userlikeTwitterTweet" data-height="230" data-mobile-height="230" data-shrink="16" style="display:none"> <div class="userlikeHeadline" id="userlikeTwitterTweetHeadline"></div> <div id="userlikeTwitterTweetWrapper"> </div> </div> <div id="userlikeOfflineMessage" data-height="470" data-mobile-height="420" data-shrink="16" style="display:none"> <div class="userlikeHeadline" id="userlikeOfflineMessageHeadline"></div> <div id="userlikeOfflineMessageText"></div> <form onsubmit="return false;"> <input id="userlikeOfflineName" type="text"> <input id="userlikeOfflineEmail" type="text"> <textarea id="userlikeOfflineTextarea"></textarea> <div id="userlikeScreenshotWrapper"> <input type="checkbox" id="userlikeScreenshotCheckbox" name="sendScreenshot" value="1"> <div id="userlikeScreenshotLabel"></div> </div> <div id="userlikeSubmitOfflineMessage">Send</div> </form> </div> <div id="userlikeRegister" data-height="340" data-mobile-height="340" data-shrink="16" style="display:none"> <div class="userlikeHeadline" id="userlikeRegisterHeadline"></div> <div id="userlikeRegisterText"></div> <form id="userlikeRegisterForm" onsubmit="return false;"> <input id="userlikeRegisterName" type="text"> <input id="userlikeRegisterEmail" type="text"> <input id="userlikeRegisterAdditional01" type="text"> <input id="userlikeRegisterAdditional02" type="text"> <input id="userlikeRegisterAdditional03" type="text"> <div id="userlikeSubmitFacebookConnect">Send</div> <div id="userlikeSubmitRegister">Send</div> </form> </div> <div id="userlikeTranscript" data-height="320" data-mobile-height="320" data-shrink="16" style="display:none"> <div class="userlikeHeadline" id="userlikeTranscriptHeadline"></div> <div id="userlikeTranscriptText"></div> <form id="userlikeTranscriptForm" onsubmit="return false;"> <input id="userlikeTranscriptEmail" type="text"> <div id="userlikeSubmitTranscript">Send</div> </form> </div> <div id="userlikeChatView" data-height="350" data-mobile-height="350" data-shrink="16" style="display:none"> <div id="userlikeMinimize">&nbsp;</div> <div class="userlikeHeadline" id="userlikeChatViewHeadline">Live Chat</div> <form onsubmit="return false;"> <div id="userlikeScrollView"> <div id="userlikeContentView"> <dl></dl> </div> </div> <div id="userlikeScrollTextarea"> <textarea id="userlikeChatTextarea"></textarea> <div id="userlikeSmileyPopover"></div> </div> <div id="userlikeChatState"></div> </form> </div> <div id="userlikeDataPrivacy"><a data-bypass target="_blank" href="http://"></a></div> <div id="userlikePoweredBy" class="notranslate">{{POWEREDBY_SLOGAN}} <a id="userlikePoweredByLink" data-bypass class="notranslate" target="_blank" href="{{POWEREDBY_LINK}}">Userlike</a></div> </div></div';userlike_css="#userlike, .userlike{ z-index: 10000; overflow: hidden; width:auto; height: auto; min-width: 0; min-height: 0; padding: 0; margin: 0; position: static;}#userlike *{ background:none; border:none; clear:none; color:#4b4d4f; direction:ltr; float:none; font-size:12px; font-style:normal; font-variant:normal; font-weight:400; font-family: '{{FONT}}', sans-serif; line-height:normal; letter-spacing:normal; opacity:1; outline-style:none; text-align:left; text-decoration:none; text-indent:0; text-transform:none; text-shadow:none; unicode-bidi:normal; white-space:normal; word-spacing:normal; width:auto; height:auto; top:auto; left:auto; right:auto; bottom:auto; min-width:0; min-height:0; padding:0; margin:0; -moz-text-size-adjust:100%; -webkit-text-size-adjust:100%; -webkit-touch-callout:none; -webkit-user-select:none; -moz-user-select:none; -ms-user-select:none; user-select:none; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; cursor:auto; -webkit-border-radius: 0; -moz-border-radius: 0; -ms-border-radius: 0; border-radius: 0; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; overflow: hidden; position: static;}#userlikeEyecatcher, #userlikeEyecatcherBox,#userlikeEyecatcherMask, #userlikeEyecatcherMessage { display: none;}#userlike a:hover,#userlike a:active{ outline:0; text-decoration:none; z-index:100003; cursor:pointer;}#userlike input{ font-size:100%; vertical-align:middle; margin:0; line-height:normal; overflow:visible; -moz-user-select: text; -ms-user-select: text; -webkit-user-select: text; user-select: text;}#userlike input[type=checkbox],#userlike input[type=radio]{ box-sizing:border-box; border:none;}#userlike input::-moz-focus-inner{ border:0; padding:0;}#userlike form{ display:block; position:relative; margin:0; padding:0; right: 0; top: 0;}#userlikePopup{ background:#fff; color:#4b4d4f; width:320px; height:180px; z-index:100002; overflow:visible!important; margin:0!important; padding:0 0 10px!important; position:fixed; -webkit-border-radius: 5px; -moz-border-radius: 5px; border-radius: 5px; overflow: hidden; -webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; box-shadow: 0 -5px 50px 0 rgba(0,0,0,.2);}#userlike.lt-ie9 #userlikePopup { border: 1px solid #d3d4d5;}#userlike.userlikeMobile #userlikePopup { width:240px!important;}#userlikeProgress { position: static;}#userlikeSpinner { margin: 80px auto 0; width: 70px; text-align: center; position: static; z-index: 10003;}#userlikeSpinner div { width: 18px!important; height: 18px!important; background-color: #A9B0B7!important; border-radius: 100%; display: inline-block; position: static; -webkit-animation: bouncedelay 1.4s infinite ease-in-out; animation: bouncedelay 1.4s infinite ease-in-out; -webkit-animation-fill-mode: both; animation-fill-mode: both;}#userlike.lt-ie9 #userlikeSpinner div { width: 18px!important; height: 18px!important; background-color: #A9B0B7!important; border-radius: 100%; display: inline-block; position: static;}#userlike.lt-ie8 #userlikeSpinner div { display: none;}#userlikeSpinnerIframe { width: 100%; height: 100%; text-align: center; position: relative; top: 50%; z-index: 10003;}#userlikeSpinnerIframe div { width: 40px!important; height: 40px!important; background-color: #A9B0B7!important; border-radius: 100%; display: inline-block; position: static; -webkit-animation: bouncedelay 1.4s infinite ease-in-out; animation: bouncedelay 1.4s infinite ease-in-out; -webkit-animation-fill-mode: both; animation-fill-mode: both;}#userlike.lt-ie9 #userlikeSpinnerIframe div { width: 40px!important; height: 40px!important; background-color: #A9B0B7!important; border-radius: 100%; display: inline-block; position: static;}#userlike.lt-ie8 #userlikeSpinner div { display: none;}#userlikeBounce1 { -webkit-animation-delay: -0.32s!important; animation-delay: -0.32s!important;}#userlikeBounce2 { -webkit-animation-delay: -0.16s!important; animation-delay: -0.16s!important;}@-webkit-keyframes bouncedelay { 0%, 80%, 100% { -webkit-transform: scale(0.0) } 40% { -webkit-transform: scale(1.0) }}@keyframes bouncedelay { 0%, 80%, 100% { transform: scale(0.0); -webkit-transform: scale(0.0); } 40% { transform: scale(1.0); -webkit-transform: scale(1.0); }}#userlikeDragTop{ cursor:auto; display:block; height:40px!important; width:320px!important; position:absolute; top:0!important; left:0!important; z-index:100001; margin:0!important;}#userlikeDragBottom{ cursor:auto; display:block; height:35px!important; width:320px!important; position:absolute; bottom:0!important; left:0!important; z-index:100001; margin:0!important;}#userlike .userlikeHidePoweredBy #userlikeDragBottom{ height:20px!important;}#userlikePopup.userlikeShowLogo #userlikeLogo{ background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -5px -5px no-repeat; background-repeat: no-repeat!important; display:block; height:16px!important; position:absolute; top:13px!important; left:12px!important; text-indent:-99999px; width:65px; z-index:100003; margin:0!important; padding:0!important;}#userlikeEyecatcherClose{ background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -176px -5px no-repeat; border:none; position:absolute; text-indent:-99999px; height:19px!important; width:19px!important; cursor:pointer; z-index:100003; padding:0!important; cursor:pointer;}#userlikeClose{ background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -176px -5px no-repeat; border:none; position:absolute; text-indent:-99999px; top:10px; right:10px; height:19px!important; width:19px!important; cursor:pointer; z-index:100003; padding:0!important; cursor:pointer;}#userlikeMinimize{ background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -176px -27px no-repeat; border:none; position:absolute; text-indent:-99999px; top:10px; right:35px; height:19px!important; width:19px!important; cursor:pointer; z-index:100003; padding:0!important; cursor:pointer;}.userlikeHeadline{ font-size:14px!important; font-weight:700!important; line-height:20px!important; height:auto!important; width:250px!important; display:block; z-index:100003; padding:0!important; text-overflow:ellipsis; overflow:hidden;}#userlike.userlikeMobile .userlikeHeadline{ width:190px!important;}#userlikeSurveyHeadline, #userlikeGroupSelectHeadline{ margin:60px 27px 0 27px!important;}#userlikeOfflineMessageHeadline,#userlikeRegisterHeadline,#userlikeDisclaimerHeadline,#userlikeTranscriptHeadline,#userlikeFeedbackHeadline{ min-height:22px!important; max-height:42px!important; margin:60px 27px 0 27px!important;}#userlikeOfflineMessageText, #userlikeRegisterText, #userlikeTranscriptText{ min-height:20px!important; max-height:40px!important; text-overflow:ellipsis; overflow:hidden; font-size:12px; line-height:18px; margin:5px 27px 10px;}#userlikeDisclaimerText{ min-height:20px!important; max-height:500px!important; text-overflow:ellipsis; overflow:hidden; font-size:12px; line-height:18px; margin:5px 27px 10px;}#userlikeFacebookLikeHeadline,#userlikeTwitterTweetHeadline,#userlikeRatingHeadline{ margin:60px 27px 0 27px!important; text-align:center!important; width: auto!important;}#userlikeMessageHeadline{ min-height:22px!important; max-height:60px!important; margin:60px 27px 0 27px!important;}#userlikeChatViewHeadline{ line-height:20px!important; margin:12px 10px 0 14px !important; height: 20px!important;}#userlike .userlikeShowLogo #userlikeChatViewHeadline{ width:172px!important; margin:12px 10px 0 84px !important;}#userlike.userlikeMobile .userlikeShowLogo #userlikeChatViewHeadline { width:120px!important; text-overflow: ellipsis;}#userlike.lt-ie8 .userlikeShowLogo #userlikeChatViewHeadline{ margin:10px 10px 0 84px !important; padding-top:10px!important;}#userlike.lt-ie8 #userlikeChatViewHeadline{ margin:10px 10px 0 14px !important; padding-top:10px!important;}#userlike #userlikePoweredBy{ color: rgb(169, 176, 183); display:block; position:absolute; bottom:12px; left:15px; z-index:100003;}#userlike #userlikePoweredBy a{ color: rgb(169, 176, 183); text-decoration: underline;}#userlike .userlikeHidePoweredBy #userlikePoweredBy{ display:none!important;}#userlikeDataPrivacy{ display:none; position:absolute; bottom:12px; right:15px; z-index:100003;}#userlike.userlikeMobile #userlikeDataPrivacy { display: none!important;}#userlikePopup #userlikeLogo{ display:none; padding:0!important;}#userlike input,#userlike textarea{ color:#4b4d4f; display:block; font-size:14px; font-weight:400; overflow:hidden; margin:30px 20px 10px 0; padding:2px 6px 2px 10px; border: 1px solid #d3d4d5; -webkit-border-radius: 3px; -moz-border-radius: 3px; -ms-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: rgba(0,0,0,0.03) 0 1px 0 inset,rgba(255,255,255,0.5) 0 -1px 0 inset; -moz-box-shadow: rgba(0,0,0,0.03) 0 1px 0 inset,rgba(255,255,255,0.5) 0 -1px 0 inset; box-shadow: rgba(0,0,0,0.03) 0 1px 0 inset,rgba(255,255,255,0.5) 0 -1px 0 inset; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; box-sizing: content-box;}#userlike textarea { white-space: pre-wrap;}#userlike input[type=radio]{ overflow:auto; float:left!important; clear:none!important; border:none; margin:1px 10px 0 1px !important;}#userlike.lt-ie9 input[type=radio]{ margin:1px 4px 0 1px !important;}#userlikeScreenshotWrapper{ height:42px; margin:0 0 0 20px;}#userlike.lt-ie9 #userlikeScreenshotWrapper > * { display: none;}#userlikeScreenshotLabel{ vertical-align:4px; display:inline;}#userlike input[type=checkbox],#userlike input[type=checkbox]:focus,#userlike input[type=checkbox]:hover,#userlike input[type=checkbox]:active{ -moz-appearance:checkbox; -ms-appearance:checkbox; -webkit-appearance:checkbox; border-radius:0; border:none; box-shadow:none; display:inline; overflow:hidden; margin:10px 5px 20px 0; padding:0;}#userlike input[type=text]{ height:33px!important; width:272px!important; max-width:272px!important; margin:20px 15px; -webkit-appearance: none;}#userlike.userlikeMobile input[type=text]{ width:190px!important; max-width:190px!important;}#userlike.lt-ie9 input[type=text] { padding: 7px 6px 0 10px;}#userlike textarea{ color:#4b4d4f; overflow:hidden; resize:none; vertical-align:top; width: 100%; max-width:272px!important; overflow:auto; -moz-user-select: text; -ms-user-select: text; -webkit-user-select: text; user-select: text; line-height: 16px!important; -webkit-appearance: none;}#userlike.userlikeMobile textarea { max-width:190px!important;}#userlike.userlikeMobile #userlikeChatTextarea { width: 173px!important;}#userlikeOfflineTextarea{ margin:10px 15px!important; padding:12px 6px 2px 10px!important; height:80px!important; min-height:80px!important; width: 272px!important}#userlike.userlikeMobile #userlikeOfflineTextarea{ width:190px!important; height:40px!important; min-height:40px!important;}#userlikeChatTextarea{ height:52px!important; width: 252px!important; font-size:12px!important; font-weight:400!important; margin:12px 15px!important; padding: 7px 25px 2px 10px!important;}#userlikePopup:after { content: \"\"; position: absolute; width: 0; height: 0;}#userlikePopup.userlikeArrow-custom:after { top: 0; left: 0; width: 0; height: 0;}#userlike.lt-ie9 #userlikePopup:after,#userlike.lt-ie9 #userlikePopup.userlikeArrow-custom:after,#userlike.lt-ie9 #userlikePopup.userlikeArrow-left:after,#userlike.lt-ie9 #userlikePopup.userlikeArrow-right:after,#userlike.lt-ie9 #userlikePopup.userlikeArrow-topRight:after,#userlike.lt-ie9 #userlikePopup.userlikeArrow-topLeft:after,#userlike.lt-ie9 #userlikePopup.userlikeArrow-bottomRight:after,#userlike.lt-ie9 #userlikePopup.userlikeArrow-bottomLeft:after { top: 0; left: 0; width: 0; height: 0; display: none;}#userlikeContentView{ border:1px solid #D2D9DC; -moz-border-radius:2px; -ms-border-radius:2px; -webkit-border-radius:2px; border-radius:2px; display:block; font-size:14px; font-weight:400; height:160px; overflow-y:scroll; margin:10px 15px; padding:2px 6px 2px 10px; overflow-wrap: break-word; word-wrap: break-word; word-break: break-word; -ms-word-break: break-word;}#userlikeContentView::-webkit-scrollbar { display: none;}#userlikeContentView * { -moz-user-select: text; -ms-user-select: text; -webkit-user-select: text; user-select: text;}#userlikeContentView dl{ margin:-3px 0 0;}#userlikeContentView dt,#userlikeContentView dd{ font-size:12px; font-weight:400!important; line-height:16px; margin:0; display: block!important;}#userlikeContentView dt{ margin:10px 0 0;}#userlikeContentView dt > .userlikeOperatorPictureSquare{ width:80px!important; height:80px!important; max-width:80px!important; max-height:80px!important; -webkit-border-radius: 3px; -moz-border-radius: 3px; -ms-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: rgba(0,0,0,0.03) 0 1px 0 inset,rgba(255,255,255,0.5) 0 -1px 0 inset; -moz-box-shadow: rgba(0,0,0,0.03) 0 1px 0 inset,rgba(255,255,255,0.5) 0 -1px 0 inset; box-shadow: rgba(0,0,0,0.03) 0 1px 0 inset,rgba(255,255,255,0.5) 0 -1px 0 inset; border:0; -ms-interpolation-mode:bicubic; vertical-align:middle;}#userlikeContentView dt > .userlikeOperatorPictureRound{ width:80px!important; height:80px!important; max-width:80px!important; max-height:80px!important; background-size: cover; display: block; -webkit-border-radius: 100px; -moz-border-radius: 100px; border-radius: 100px; -webkit-box-shadow: rgba(0,0,0,0.03) 0 1px 0 inset,rgba(255,255,255,0.5) 0 -1px 0 inset; -moz-box-shadow: rgba(0,0,0,0.03) 0 1px 0 inset,rgba(255,255,255,0.5) 0 -1px 0 inset; box-shadow: rgba(0,0,0,0.03) 0 1px 0 inset,rgba(255,255,255,0.5) 0 -1px 0 inset; border:0; -ms-interpolation-mode:bicubic;}#userlike .userlikeSmiley { height: 14px; width: 14px;}#userlike.lt-ie8 #userlikeContentView dt > .userlikeOperatorPictureSquare,#userlike.lt-ie8 #userlikeContentView dt > .userlikeOperatorPictureRound{ display: none;}#userlike #userlikeContentView .userlikeSmiley{ vertical-align: middle;}#userlikeChatState{ line-height:16px; height:16px; max-height:16px; overflow:hidden; text-overflow: ellipsis; white-space: nowrap; margin:-5px 0 0 15px;}#userlikeChatState > div { font-size:12px; font-weight:400!important; color:#A9B0B7;}#userlikeOfflineMessage form{ height: 290px!important;}#userlike.userlikeMobile #userlikeOfflineMessage form{ height: 250px!important;}#userlikeFeedbackForm { height: 160px!important;}#userlikeFeedbackTextarea{ margin:20px 15px!important; padding:12px 6px 2px 10px!important; height:70px!important; min-height:70px!important;}#userlikeTranscript form{ height: 140px!important;}#userlikeSubmitOfflineMessage{ background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -16px -28px no-repeat; border:none; text-indent:-99999px; width:60px; position:absolute; height:35px; bottom:5px; right:15px; z-index:100003; cursor:pointer; -webkit-border-radius: 2px; -moz-border-radius: 2px; -ms-border-radius: 2px; border-radius: 2px; -webkit-box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3) inset; -moz-box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3) inset; box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3) inset;}#userlikeSmileyPopover{ position: absolute; right: 21px; bottom: 60px; width: 22px; height: 22px; background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -7px -97px no-repeat no-repeat; border: none; cursor: pointer; z-index: 100003;}#userlikeSmileyList{ box-sizing: border-box; display: none; position: absolute; right: 15px; bottom: 90px; height: auto; width: 247px; max-width: 80%; background: #fff; padding: 9px 11px; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; box-shadow: 1px 0px 15px 0 rgba(0,0,0,.2); -webkit-box-sizing: border-box; -moz-box-sizing: border-box;}#userlikeSmileyList.show{ display: block;}#userlikePopup .userlikeSmiley{ height: 21px; width: 21px; padding: 2px;}#userlikeSubmitRegister, #userlikeSubmitTranscript { background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -57px -28px no-repeat; border:none; height:35px; position:absolute; text-indent:-99999px; width:60px; bottom:10px; right:15px; z-index:100003; cursor:pointer; -webkit-border-radius: 2px; -moz-border-radius: 2px; -ms-border-radius: 2px; border-radius: 2px; -webkit-box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3) inset; -moz-box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3) inset; box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3) inset;}#userlikeSubmitDisclaimer { background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -57px -28px no-repeat; border:none; height:35px; position:absolute; text-indent:-99999px; width:60px; bottom:30px; right:15px; z-index:100003; cursor:pointer; -webkit-border-radius: 2px; -moz-border-radius: 2px; -ms-border-radius: 2px; border-radius: 2px; -webkit-box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3) inset; -moz-box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3) inset; box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3) inset;}#userlikeSubmitFacebookConnect { background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -100px -28px no-repeat; border:none; height:35px; position:absolute; text-indent:-99999px; width:60px; bottom:10px; right:90px; z-index:100003; cursor:pointer; -webkit-border-radius: 2px; -moz-border-radius: 2px; -ms-border-radius: 2px; border-radius: 2px; -webkit-box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3) inset; -moz-box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3) inset; box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3) inset;}#userlikeSubmitFeedback{ background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -16px -28px no-repeat; border:none; text-indent:-99999px; width:60px; position:absolute; height:35px; bottom:5px; right:15px; z-index:100003; cursor:pointer; -webkit-border-radius: 2px; -moz-border-radius: 2px; -ms-border-radius: 2px; border-radius: 2px; -webkit-box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3) inset; -moz-box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3) inset; box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3) inset;}#userlike .userlikeFieldsetWrapper{ float:left; clear:none; overflow:hidden; width:260px; margin:20px 20px 0 40px;}#userlike.userlikeMobile .userlikeFieldsetWrapper{ margin:20px 20px 0 25px;}#userlikeFacebookLikeWrapper{ height:70px; width:225px; overflow: hidden; margin: 20px auto; text-align: center;}#userlike.ie #userlikeFacebookLikeWrapper { margin:20px auto; height:70px; width:225px; display: table;}#userlikeTwitterTweetWrapper{ width: 50%; margin: 20px auto;}#userlike.ie #userlikeTwitterTweetWrapper { margin: 20px auto; display: table;}#userlike .userlikeRadioWrapper{ min-height:30px!important; height:30px!important;}#userlike .userlikeLabel{ display:block!important; cursor:pointer; margin:1px 0 5px!important; padding:0 1em 10px 0!important; max-width:220px!important; font-size:12px!important; line-height:normal;}#userlike.userlikeMobile .userlikeLabel{ max-width:170px!important; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}#userlikeStarRating{ list-style:none; margin-left:90px!important; margin-top:15px!important; width:125px!important; height:25px!important; position:relative!important; background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/star.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) top left repeat-x; padding:0!important;}#userlike.userlikeMobile #userlikeStarRating{ margin-left:55px!important;}#userlikeStarRating div{ float:left; margin:0!important; padding:0!important;}#userlikeStarRating div span{ display:block; width:25px; height:25px; text-decoration:none; text-indent:-9000px; z-index:20; position:absolute; cursor:pointer; padding:0;}#userlikeStarRating div span:hover{ background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/star.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) left bottom; z-index:2; left:0; cursor:pointer;}#userlikeStarRating span:focus,#userlikeStarRating span:active{ border:0; -moz-outline-style:none; outline:none;}#userlikeStarRating span.userlikeOneStar{ left:0;}#userlikeStarRating span.userlikeOneStar:hover{ width:25px;}#userlikeStarRating span.userlikeTwoStars{ left:25px;}#userlikeStarRating span.userlikeTwoStars:hover{ width:50px;}#userlikeStarRating span.userlikeThreeStars{ left:50px;}#userlikeStarRating span.userlikeThreeStars:hover{ width:75px;}#userlikeStarRating span.userlikeFourStars{ left:75px;}#userlikeStarRating span.userlikeFourStars:hover{ width:100px;}#userlikeStarRating span.userlikeFiveStars{ left:100px;}#userlikeStarRating span.userlikeFiveStars:hover{ width:125px;}#userlikePushIframe { position:fixed; top:10%; left:10%; bottom:10%; right:10%; width:80%; height:80%; margin:0; padding:0; overflow:hidden; z-index:10000; background:#fff; color:#4b4d4f; -webkit-border-radius: 5px; -moz-border-radius: 5px; border-radius: 5px; overflow: hidden; -webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; box-shadow: 0 -5px 50px 0 rgba(0,0,0,.2);}#userlikePushIframeClose { background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -176px -5px no-repeat; border:none; position:absolute; text-indent:-99999px; height:19px!important; width:19px!important; cursor:pointer; z-index:100003; padding:0!important; cursor:pointer; right: 2px; top: 2px;}#userlikePushIframeOpen { background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -176px -48px no-repeat; border:none; position:absolute; text-indent:-99999px; height:19px!important; width:19px!important; cursor:pointer; z-index:100003; padding:0!important; cursor:pointer; right: 20px; top: 2px;}@media(-webkit-min-device-pixel-ratio: 2),(min-resolution: 192dppx) { #userlikePopup.userlikeShowLogo #userlikeLogo { background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2@2x.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -5px -5px no-repeat; background-size:200px; } #userlikeClose { background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2@2x.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -176px -5px no-repeat; background-size:200px; } #userlikeMinimize { background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2@2x.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -176px -27px no-repeat; background-size:200px; } #userlikeSubmitOfflineMessage { background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2@2x.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -16px -28px no-repeat; background-size:200px; } #userlikeSubmitRegister { background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2@2x.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -57px -28px no-repeat; background-size:200px; } #userlikeSubmitTranscript { background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2@2x.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -57px -28px no-repeat; background-size:200px; } #userlikeSubmitFacebookConnect { background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2@2x.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -100px -28px no-repeat; background-size:200px; } #userlikeStarRating { background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/star@2x.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) top left repeat-x; background-size:25px; } #userlikeStarRating div span:hover { background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/star@2x.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) left bottom; background-size:25px; } #userlikePushIframeClose { background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2@2x.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -176px -5px no-repeat; background-size:200px; } #userlikePushIframeOpen { background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2@2x.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -176px -49px no-repeat; background-size:200px; } #userlikeSubmitFeedback { background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2@2x.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -16px -28px no-repeat; background-size:200px; } #userlikeSmileyPopover{ background:url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/spritemap_v2@2x.png?v=b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf) -7px -97px no-repeat no-repeat; background-size:200px;}";
userlike={};popup=null;slot=null;pusher=null;fsm=null;session=null;config=null;sound=null;goal=null;button=null;tracking=null;tracking_event=null;facebook=false;twitter=false;git_version="b6c8aca1d6d0c972a4d532fc91e8571f0a4b74cf";is_mobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(typeof navigator!=="undefined"&&navigator!==null?navigator.userAgent:void 0);if(!(typeof window!=="undefined"&&window!==null?window._ullog:void 0)){if(typeof window!=="undefined"&&window!==null){window._ullog=function(){var args,ref1,timestamp;if(((ref1=window.__utils__)!=null?ref1.echo:void 0)&&this.console){__utils__.echo("Client: "+Array.prototype.slice.call(arguments))}if(this.console&&document.cookie.indexOf("_uslk_debug=1")>-1){timestamp=Date.now()/1e3;args=Array.prototype.slice.call(arguments);args.splice(0,0,timestamp);return console.log(args)}}}}if(!(typeof window!=="undefined"&&window!==null?window._ulwarn:void 0)){if(typeof window!=="undefined"&&window!==null){window._ulwarn=function(){var args,timestamp;if(this.console&&document.cookie.indexOf("_uslk_debug=1")>-1){timestamp=Date.now()/1e3;args=Array.prototype.slice.call(arguments);args.splice(0,0,timestamp);return console.warn(args)}}}}is_ssl=function(){if(config!=null?config.force_ssl:void 0){return true}return"https:"===document.location.protocol};protocol=function(){if(is_ssl()){return"https://"}else{return"http://"}};try{localStorage.setItem("test","test");localStorage.removeItem("test");has_localstorage=true}catch(_error){e=_error;has_localstorage=false}window.UL_EMOTICONS=[{image:"emoji_embarrassed.png",equivalents:[":-[",":["],code:":-[",name:"Embarrassed"},{image:"emoji_angry.png",equivalents:[">:-(",">:("],code:">:-(",name:"Angry"},{image:"emoji_oops.png",equivalents:[":-!",":!"],code:":-!",name:"Oops"},{image:"emoji_sleeping.png",equivalents:["|-)","I-)","I-|","|-|","|-*","|-*","|-.","|-."],code:"|-)",name:"Sleeping"},{image:"emoji_wink_tongue.png",equivalents:[";-P",";P",";-p",";p"],code:";-P",name:"Wink Tongue"},{image:"emoji_gasp.png",equivalents:[":-o",":o",":-O",":O","=-o","=-O"],code:":-o",name:"Gasp"},{image:"emoji_confused.png",equivalents:[":-?",":?"],code:":-?",name:"Confused"},{image:"emoji_frown.png",equivalents:[":-(",":("],code:":-(",name:"Frown"},{image:"emoji_mischievous.png",equivalents:[">:-)",">:)"],code:">:-)",name:"Mischievous"},{image:"emoji_straight_faced.png",equivalents:[":-|",":|",":-I",":I"],code:":-|",name:"Straight Faced"},{image:"emoji_smirk.png",equivalents:[":->",":>"],code:":->",name:"Smirk"},{image:"emoji_grimmace.png",equivalents:["X-(","x-(","X(","x("],code:"X-(",name:"Grimmace"},{image:"emoji_kiss.png",equivalents:[":-*",":*"],code:":-*",name:"Kiss"},{image:"emoji_shouting.png",equivalents:[">:-O",">:O",">:-o",">:o",":-@",":@",">:-@",">:@",">:-V",">:V",":-V",":V"],code:">:-O",name:"Shouting"},{image:"emoji_wink.png",equivalents:[";-)",";)"],code:";-)",name:"Wink"},{image:"emoji_innocent.png",equivalents:["O:-)","O:)","o:-)","o:)","0:-)","0:)"],code:"O:-)",name:"Innocent"},{image:"emoji_smile.png",equivalents:[":-)",":)",";)"],code:":-)",name:"Smile"},{image:"emoji_undecided.png",equivalents:[":-U",":U"],code:":-U",name:"Undecided"},{image:"emoji_evil.png",equivalents:[">:-D",">:D"],code:">:-D",name:"Evil"},{image:"emoji_grin.png",equivalents:[":-D",":D"],code:":-D",name:"Grin"},{image:"emoji_tongue.png",equivalents:[":-P",":P",":-p",":p"],code:":-P",name:"Tongue"},{image:"emoji_blushing.png",equivalents:[":-]",":]",":-`"],code:":-]",name:"Blushing"},{image:"emoji_lips_are_sealed.png",equivalents:[":-X",":-x"],code:":-X",name:"Lips Are Sealed"},{image:"emoji_cool.png",equivalents:["B-)","B)","8-)","8)"],code:"B-)",name:"Cool"}];loadStage2=function(callback){var scripts;scripts={userlikelib:"userlike-cdn-client.s3-eu-west-1.amazonaws.com/userlikelib.min.js"};return loadScripts(scripts,function(){return callback()})};loadScripts=function(scripts,callback){var count,i,p,results1,src,srcs;srcs=[];for(p in scripts){if(!(p in window)){srcs.push(scripts[p])}}count=srcs.length;if(count===0){callback()}i=0;results1=[];while(i<srcs.length){src=srcs[i];loadScript(src,function(){if(--count===0){return callback()}});results1.push(i++)}return results1};loadScript=function(src,callback){var script;_ullog("loadScript: "+src);script=document.createElement("script");script.setAttribute("type","text/javascript");script.setAttribute("src",""+protocol()+src);script.onload=script.onreadystatechange=function(){var state;state=script.readyState;if(!callback.done&&(!state||/loaded|complete/.test(state))){callback.done=true;return callback()}};return document.getElementsByTagName("head")[0].appendChild(script)};Config=function(){function Config(app_key1,widget_key1,config){var ref1;this.app_key=app_key1;this.widget_key=widget_key1;_ullog("Config::ctor: version="+git_version);_ullog("Config::ctor: config=%o ",config);this.set(config);if(((ref1=window.userlike)!=null?ref1.config:void 0)!=null){this.set(window.userlike.config)}}Config.prototype.set=function(config){var key,results1,value;results1=[];for(key in config){value=config[key];results1.push(this[key]=value)}return results1};return Config}();SessionFactory=function(){function SessionFactory(){}SessionFactory.prototype.get=function(){if(config.data_privacy){return new SessionStoragePrivacy}else{return new SessionStorage}};return SessionFactory}();Session=function(){function Session(){}Session.is_number=new RegExp("^[-]?[0-9]+[.]?[0-9]+$");Session.is_bool=new RegExp("^[01]$");Session.cookie_expire=function(){return config.cookie_expire*864e5};Session.cookies=function(){return{debug:this.cookie_expire(),uuid:this.cookie_expire(),name:this.cookie_expire(),email:this.cookie_expire(),additional01:this.cookie_expire(),additional02:this.cookie_expire(),additional03:this.cookie_expire(),blocked:this.cookie_expire(),visits:this.cookie_expire(),whitelist:this.cookie_expire(),ban:0,bootstrapped:0,app_state:0,exit_intent:0,id:0,pusher:0,referrer:0,page_impressions:0,ip:0,active:0,longitude:0,latitude:0,meta_id:0,ct:0,co:0}};Session.memory={};Session.state_map={Chat:"Offline",ChatMinimized:"Offline"};Session.domain=function(){var d;d=window.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i);if(d){return"."+d[0]}else{return""}}();Session.prototype.prefix=function(){return"_uslk_"};Session.prototype.reset=function(){this.yieldConfig();this.setState(null);this.persisted_state=null;return this.resetChatDuration()};Session.prototype.resetChatDuration=function(){return this.set("active",0)};Session.prototype.resetStats=function(){this._set("ct",0);return this._set("co",0)};Session.prototype.resetPusherId=function(){return this._delete("pusher")};Session.prototype.yieldConfig=function(){if(!has_localstorage){return}localStorage.removeItem("_uslk_widget_key");localStorage.removeItem("_uslk_config");return localStorage.removeItem("_uslk_app_key")};Session.prototype.persistConfig=function(){if(!has_localstorage){return}localStorage.setItem("_uslk_widget_key",config.widget_key);localStorage.setItem("_uslk_app_key",config.app_key);return localStorage.setItem("_uslk_config",JSON.stringify(config))};Session.prototype.persistDrag=function(drag){if(!has_localstorage){return}return localStorage.setItem("_uslk_drag",JSON.stringify(drag))};Session.prototype.getDrag=function(){var drag;if(!has_localstorage){return}drag=localStorage.getItem("_uslk_drag");if(!drag){return}return JSON.parse(drag)};Session.prototype.resetDrag=function(){if(!has_localstorage){return}return localStorage.removeItem("_uslk_drag")};Session.prototype.setInitalUrl=function(url){if(!has_localstorage){return}return localStorage.setItem("_uslk_url",url)};Session.prototype.getInitalUrl=function(){if(!has_localstorage){return}return localStorage.getItem("_uslk_url")};Session.prototype.setState=function(value,expires){if(expires){return this._set("app_state",value+";"+(+new Date+expires))}else{return this._set("app_state",value+";0")}};Session.prototype.getConfig=function(){var data;if(has_localstorage){data={widget_key:localStorage.getItem("_uslk_widget_key"),app_key:localStorage.getItem("_uslk_app_key"),config:JSON.parse(localStorage.getItem("_uslk_config"))};return data}};Session.prototype.hasClientTerminating=function(){return this.get("ct")!==0};Session.prototype.hasClientOriginating=function(){return this.get("co")!==0};Session.prototype.incClientTerminating=function(){return this.set("ct",this.get("ct")+1)};Session.prototype.incClientOriginating=function(){return this.set("co",this.get("co")+1)};Session.prototype.removeOldCookies=function(){var cookie,cookies,i,j,len1,name,pos,prefix,ref1,results1;ref1=["_uslk_widget_config","_uslk_widget_key","_uslk_state","_uslk_app_key","_uslk_created","_uslk_operator_id","_uslk_operator_name","_userlike_"];results1=[];for(j=0,len1=ref1.length;j<len1;j++){prefix=ref1[j];i=0;cookies=document.cookie.split(";");results1.push(function(){var results2;results2=[];while(i<cookies.length){cookie=cookies[i];pos=cookie.indexOf("=");name=pos>-1?cookie.substr(0,pos):cookie;if(cookie.indexOf(prefix)===1){document.cookie=name+"=;path=/;expires=Thu, 01 Jan 1970 00:00:00 GMT"}results2.push(i++)}return results2}())}return results1};Session.prototype.renameCookies=function(){var cookie,cookies,domain,i,key,name,pos,results1,value;cookies=document.cookie.split(";");i=0;results1=[];while(i<cookies.length){cookie=cookies[i];while(cookie.charAt(0)===" "){cookie=cookie.substring(1,cookie.length)}pos=cookie.indexOf("=");if(cookie.indexOf(this.prefix())===0){name=pos>-1?cookie.substr(0,pos):cookie;value=decodeURIComponent(cookie.substr(name.length+1,cookie.length));key=name.replace(this.prefix(),"");if(config.wildcard_cookie){domain=""}else{domain="; domain="+Session.domain}document.cookie=name+("=;"+domain+";path=/;expires=Thu, 01 Jan 1970 00:00:00 GMT");this.set(key,value)}results1.push(i++)}return results1};Session.prototype._delete_all=function(){var cookie,cookies,i,name,pos,results1;cookies=document.cookie.split(";");i=0;results1=[];while(i<cookies.length){cookie=cookies[i];pos=cookie.indexOf("=");name=pos>-1?cookie.substr(0,pos):cookie;if(cookie.indexOf(this.prefix())===1){if(config.wildcard_cookie){document.cookie=name+("=;domain="+Session.domain+";path=/;expires=Thu, 01 Jan 1970 00:00:00 GMT")}else{document.cookie=name+"=;path=/;expires=Thu, 01 Jan 1970 00:00:00 GMT"}}results1.push(i++)}return results1};Session.prototype._delete=function(name){var key;key=this.prefix()+name;if(config.wildcard_cookie){return document.cookie=key+("=;domain="+Session.domain+";path=/;expires=Thu, 01 Jan 1970 00:00:00 GMT")}else{return document.cookie=key+"=;path=/;expires=Thu, 01 Jan 1970 00:00:00 GMT"}};Session.prototype._set=function(name,value,msec){var date,domain,expires,key;key=this.prefix()+name;value=encodeURIComponent(value);if(msec){date=new Date;date.setTime(date.getTime()+msec);expires="; expires="+date.toGMTString()}else{expires=""}if(config.wildcard_cookie){domain="; domain="+Session.domain;return document.cookie=key+"="+value+expires+domain+"; path=/"}else{domain="";return document.cookie=key+"="+value+expires+"; path=/"}};Session.prototype._get=function(name){var cookie,cookies,i,value;name=this.prefix()+name+"=";cookies=document.cookie.split(";");i=0;while(i<cookies.length){cookie=cookies[i];while(cookie.charAt(0)===" "){cookie=cookie.substring(1,cookie.length)}if(cookie.indexOf(name)===0){value=cookie.substring(name.length,cookie.length);return decodeURIComponent(value)}i++}return void 0};Session.prototype.setIfEmpty=function(key,value){if(!this.get(key)){return this.set(key,value)}};Session.prototype.set=function(key,value){if(Session.cookies()[key]==null){return Session.memory[key]=value}else if(Session.cookies()[key]){return this._set(key,value,Session.cookies()[key])}else{return this._set(key,value)}};Session.prototype.get=function(key){var value;if(Session.cookies()[key]==null){return Session.memory[key]}else{value=this._get(key);if(Session.is_number.test(value)||Session.is_bool.test(value)){return parseFloat(value)}else{return value}}};Session.prototype.del=function(key){if(Session.cookies()[key]==null){return delete Session.memory[key]}else{return this._delete(key)}};Session.prototype.getState=function(){var expires,now,override_state,state,value,values;now=+new Date;value=this._get("app_state");values=value!=null?value.split(";"):void 0;if(!values){return}state=values[0];expires=parseInt(values[1]);if(expires>0&&expires<now){override_state=Session.state_map[state];this.setState(override_state);return override_state}else{return state}};Session.prototype.getCustomFromAPI=function(){if((typeof userlikeData!=="undefined"&&userlikeData!==null?userlikeData.custom:void 0)!=null){return userlikeData.custom}};Session.prototype.checkUserFromAPI=function(){var ref1,ref2,ref3,ref4,ref5;_ullog("Session::checkUserFromAPI");if(this.validateName(typeof userlikeData!=="undefined"&&userlikeData!==null?(ref1=userlikeData.user)!=null?ref1.name:void 0:void 0)){_ullog("Session::checkUserFromAPI set name="+userlikeData.user.name);this.set("name",userlikeData.user.name)}if(this.validateEmail(typeof userlikeData!=="undefined"&&userlikeData!==null?(ref2=userlikeData.user)!=null?ref2.email:void 0:void 0)){_ullog("Session::checkUserFromAPI set email="+userlikeData.user.email);this.set("email",userlikeData.user.email)}if(this.validateAdditional(typeof userlikeData!=="undefined"&&userlikeData!==null?(ref3=userlikeData.user)!=null?ref3.additional01:void 0:void 0)){_ullog("Session::checkUserFromAPI set additional01="+userlikeData.user.additional01);this.set("additional01",userlikeData.user.additional01)}if(this.validateAdditional(typeof userlikeData!=="undefined"&&userlikeData!==null?(ref4=userlikeData.user)!=null?ref4.additional02:void 0:void 0)){_ullog("Session::checkUserFromAPI set additional02="+userlikeData.user.additional02);this.set("additional02",userlikeData.user.additional02)}if(this.validateAdditional(typeof userlikeData!=="undefined"&&userlikeData!==null?(ref5=userlikeData.user)!=null?ref5.additional03:void 0:void 0)){_ullog("Session::checkUserFromAPI set additional03="+userlikeData.user.additional03);return this.set("additional03",userlikeData.user.additional03)}};Session.prototype.addAdditionalRegisterValues=function(data){var i,j,len1,ref1;ref1=[1,2,3];for(j=0,len1=ref1.length;j<len1;j++){i=ref1[j];if(config["register_additional0"+i+"_enabled"]){data["client_additional0"+i+"_value"]=this.get("additional0"+i);data["client_additional0"+i+"_name"]=config["register_additional0"+i+"_name"]}}return data};Session.prototype.setStateIdle=function(){};Session.prototype.setGoal=function(key){return this._set("goal_reached_"+key,+new Date)};Session.prototype.getGoal=function(key){return this._get("goal_reached_"+key)};Session.prototype.setOperatorBinding=function(operator_id,operator_group_id){return this._set("operator_binding_"+operator_group_id,operator_id)};Session.prototype.getOperatorBinding=function(operator_group_id){return this._get("operator_binding_"+operator_group_id)};Session.prototype.validateEmail=function(email){var validator;if(!email||email.length>100){return false}validator=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,})+$/i;return validator.test(email)};Session.prototype.validateName=function(name){if(!name||name.length>100){return false}return true};Session.prototype.validateAdditional=function(value){if(!value||value.length>100){return false}return true};Session.prototype.startChatDuration=function(){if(this.get("active")===0){this.set("active",+new Date);return true}};Session.prototype.getChatDuration=function(){var d,t;t=this.get("active");if(t>0){d=(+new Date-t)/1e3;return d}};Session.prototype.getCookieSupport=function(){var c,persist;persist=true;while(true){c="gCStest="+Math.floor(Math.random()*1e8);document.cookie=persist?c+";expires=Tue, 01-Jan-2030 00:00:00 GMT":c;if(document.cookie.indexOf(c)!==-1){document.cookie=c+";expires=Sat, 01-Jan-2000 00:00:00 GMT";return persist}if(!!(persist=!persist)){break}}return null};Session.prototype.isActive=function(){return this.persisted_state==="Chat"||this.persisted_state==="ChatMinimized"};Session.prototype.isOffline=function(){return this.persisted_state==="Offline"};Session.prototype.isRject=function(){return this.persisted_state==="ProactiveSlotReject"};Session.prototype.isPusherBanned=function(){return this.get("ban"===1)};Session.prototype.setPusherBan=function(){return this.set("ban",1)};return Session}();SessionStorage=function(superClass){extend(SessionStorage,superClass);function SessionStorage(){_ullog("SessionStorage");this.removeOldCookies();this.renameCookies();this.bootstrap();this.incPageImpressions();this.checkUserFromAPI();this.persisted_state=this.getState()}SessionStorage.prototype.incPageImpressions=function(){var i;i=this.get("page_impressions");if(isNaN(parseInt(i))){i=0}return this.set("page_impressions",++i)};SessionStorage.prototype.getLocation=function(){if(navigator.geolocation){_ullog("SessionStorage::getLocation request");return navigator.geolocation.getCurrentPosition(function(_this){return function(position){_ullog("SessionStorage::getLocation response=",position);_this.set("latitude",position.coords.latitude);_this.set("longitude",position.coords.longitude);return fsm.event("locationchange")}}(this))}else{return _ullog("SessionStorage::getLocation not supported")}};SessionStorage.prototype.bootstrap=function(){var i;if(this.get("bootstrapped")){return}_ullog("SessionStorage::bootstrap init values");i=this.get("visits");if(i){i++}else{i=1}this.set("visits",i);this.set("page_impressions",0);this.set("referrer",document.referrer);this.set("app_state",null);this.set("bootstrapped",1);this.setInitalUrl(document.location.href);this.resetStats();this.resetChatDuration();return this.resetDrag()};SessionStorage.prototype.packet=function(){var data;this.checkUserFromAPI();data={session:this.get("id"),pusher:this.get("pusher"),client_uuid:this.get("uuid"),client_name:this.get("name"),client_email:this.get("email"),url:document.location.href.substring(0,254),inital_url:this.getInitalUrl(),title:document.title,custom:this.getCustomFromAPI(),pre_survey_option:this.get("pre_survey_option"),goal:this.get("goal"),page_impressions:this.get("page_impressions"),visits:this.get("visits"),referrer:this.get("referrer"),ip:this.get("ip"),latitude:this.get("latitude"),longitude:this.get("longitude"),duration:this.getChatDuration()};return this.addAdditionalRegisterValues(data)};return SessionStorage}(Session);SessionStoragePrivacy=function(superClass){extend(SessionStoragePrivacy,superClass);function SessionStoragePrivacy(){_ullog("SessionStoragePrivacy");this.removeOldCookies();this.renameCookies();this.bootstrap();this.checkUserFromAPI();this.persisted_state=this.getState()}SessionStoragePrivacy.prototype.packet=function(){var data;this.checkUserFromAPI();data={session:this.get("id"),pusher:this.get("pusher"),client_uuid:this.get("uuid"),client_name:this.get("name"),client_email:this.get("email"),client_additional01_value:this.get("additional01"),client_additional01_name:config["register_additional01_name"],client_additional02_value:this.get("additional02"),client_additional02_name:config["register_additional02_name"],client_additional03_value:this.get("additional03"),client_additional03_name:config["register_additional03_name"],pre_survey_option:this.get("pre_survey_option"),goal:this.get("goal"),url:document.location.href.substring(0,4096),custom:this.getCustomFromAPI(),duration:this.getChatDuration()};return this.addAdditionalRegisterValues(data)};SessionStoragePrivacy.prototype.getLocation=function(){};SessionStoragePrivacy.prototype.bootstrap=function(){if(this.get("bootstrapped")){return}_ullog("SessionStoragePrivacy::bootstrap init values");this.set("bootstrapped",1);this.set("app_state",null);this.resetChatDuration();return this.resetDrag()};return SessionStoragePrivacy}(Session);emotify=function(){var EMOTICON_RE,emoticons,lookup;emotify=void 0;EMOTICON_RE=void 0;emoticons={};lookup=[];emotify=function(txt,callback){callback=callback||function(img,title,smiley,text){title=(title+", "+smiley).replace(/"/g,"&quot;").replace(/</g,"&lt;");return'<img src="'+img+'" title="'+title+'" alt="" class="userlikeSmiley"/>'};return txt.replace(EMOTICON_RE,function(a,b,text){var i,smiley;i=0;smiley=text;e=emoticons[text];if(!e){while(i<lookup.length&&!lookup[i].regexp.test(text)){i++}smiley=lookup[i].name;e=emoticons[smiley]}if(e){return b+callback(e[0],e[1],smiley,text)}else{return a}})};emotify.emoticons=function(){var alts,args,arr,base_url,i,j,len1,regexp_str,smilies;args=Array.prototype.slice.call(arguments);base_url=typeof args[0]==="string"?args.shift():"";smilies=args[0];e=void 0;arr=[];alts=void 0;i=void 0;regexp_str=void 0;for(j=0,len1=smilies.length;j<len1;j++){e=smilies[j];emoticons[e.code]=[base_url+e.image,e.name].concat(e.equivalents)}for(e in emoticons){if(emoticons[e].length>2){alts=emoticons[e].slice(2).concat(e);i=alts.length;while(i--){alts[i]=alts[i].replace(/(\W)/g,"\\$1")}regexp_str=alts.join("|");lookup.push({name:e,regexp:new RegExp("^"+regexp_str+"$")})}else{regexp_str=e.replace(/(\W)/g,"\\$1")}arr.push(regexp_str)}EMOTICON_RE=new RegExp("(^|\\s)("+arr.join("|")+")(?=(?:$|\\s))","g");return emoticons};return emotify}();emotify.emoticons("//userlike-cdn-client.s3-eu-west-1.amazonaws.com/",UL_EMOTICONS);FSM=function(){function FSM(){this.state=new Init;this.freeze=false;this.event_queue=[]}FSM.prototype.start=function(data){return this.next(Start,data)};FSM.prototype.next=function(state,data){this.freeze=true;return this.state.leave(function(_this){return function(){_this.state.persist();return _this.state.transitionOut(function(){_ullog("FSM::next:  "+_this.state.getName()+" -> "+state.getName());delete _this.state;_this.state=new state;_this.state.persist();return _this.state.transitionIn(function(){_this.freeze=false;return _this.state.enter(data)})})}}(this))};FSM.prototype.event=function(name,data){if(this.state[name]!=null&&typeof this.state[name]==="function"){if(this.freeze){if(data){_ullog("FSM::event: Frozen "+this.state.getName()+":"+name+" data=",JSON.stringify(data))}else{_ullog("FSM::event: Frozen "+this.state.getName()+":"+name)}return this.queue(name,data)}else{if(name!=="persist"){if(data){_ullog("FSM::event: Event "+this.state.getName()+":"+name+" data=",JSON.stringify(data))}else{_ullog("FSM::event: Event "+this.state.getName()+":"+name)}}return this.state[name](data)}}else{return _ullog("FSM::event: Unhandled "+this.state.getName()+":"+name)}};FSM.prototype.signal=function(name,data){if(this.state[name]!=null&&typeof this.state[name]==="function"){if(!this.freeze){_ullog("FSM::signal: Signal "+this.state.getName()+":"+name);return this.state[name](data)}else{return setTimeout(function(_this){return function(){_ullog("FSM::signal: Frozen "+_this.state.getName()+":"+name);return _this.signal(name,data)}}(this),200)}}else{return _ullog("FSM::event: Unhandled "+this.state.getName()+":"+name)}};FSM.prototype.queue=function(name,data){_ullog("FSM::queue: Event "+this.state.getName()+":"+name);return this.event_queue.push([name,data])};FSM.prototype.unshift=function(name,data){_ullog("FSM::unshift: Event "+this.state.getName()+":"+name);return this.event_queue.unshift([name,data])};FSM.prototype.poll=function(){var data,event,name,unhandled;unhandled=[];while(this.event_queue.length){event=this.event_queue.shift();name=event[0];data=event[1];if(this.state[name]!=null&&typeof this.state[name]==="function"){_ullog("FSM::poll: Event "+this.state.getName()+":"+name);this.state[name](data)}else{_ullog("FSM::poll: Unhandled "+this.state.getName()+":"+name);unhandled.push(event)}}return this.event_queue=unhandled};FSM.prototype.reset=function(){_ullog("FSM::reset: remove "+this.event_queue.length+" events");return this.event_queue=[]};return FSM}();State=function(){State.timeout=4e3;State.timeout_load_script=2e3;State.timeout_connect=1e4;State.timeout_offsite=1e5;State.timeout_persist=5e3;State.timeout_screenshot=3e4;State.timeout_disconnected=3e4;State.timeout_hibernate=8e4;function State(){}State.prototype.leave=function(callback){return callback()};State.prototype.enter=function(){};State.prototype.persist=function(){};State.prototype.transitionIn=function(callback){return callback()};State.prototype.transitionOut=function(callback){return callback()};State.prototype.getName=function(){var results;results=/function (.{1,})\(/.exec(this.constructor.toString());if((results!=null?results.length:void 0)>1){return results[1]}else{return""}};State.getName=function(){var results;results=/function (.{1,})\(/.exec(this.toString());if((results!=null?results.length:void 0)>1){return results[1]}else{return""}};return State}();Init=function(superClass){extend(Init,superClass);function Init(){return Init.__super__.constructor.apply(this,arguments)}return Init}(State);Start=function(superClass){extend(Start,superClass);function Start(){return Start.__super__.constructor.apply(this,arguments)}Start.prototype.enter=function(data){return fsm.next(CheckScriptPostion,data)};return Start}(State);CheckScriptPostion=function(superClass){extend(CheckScriptPostion,superClass);function CheckScriptPostion(){return CheckScriptPostion.__super__.constructor.apply(this,arguments)}CheckScriptPostion.prototype.enter=function(data){var i,ref1,ref2,script,scripts;scripts=document.getElementsByTagName("script");try{for(i in scripts){script=scripts[i];if((typeof script.getAttribute==="function"?(ref1=script.getAttribute("src"))!=null?ref1.indexOf("userlike-cdn-widgets"):void 0:void 0)>-1){if(((ref2=script.parentElement)!=null?ref2.nodeName:void 0)==="HEAD"){_ulwarn("####################################################################");_ulwarn("# WARNING: The Userlike script should not be included in the header");_ulwarn("####################################################################")}}}}catch(_error){e=_error;_ulwarn("Error checking script postion")}return fsm.next(ConfigSetup,data)};return CheckScriptPostion}(State);ConfigSetup=function(superClass){extend(ConfigSetup,superClass);function ConfigSetup(){return ConfigSetup.__super__.constructor.apply(this,arguments)}ConfigSetup.prototype.enter=function(data){config=new Config(data.app_key,data.widget_key,data.config);return fsm.next(FontLoader)};return ConfigSetup}(State);FontLoader=function(superClass){extend(FontLoader,superClass);function FontLoader(){return FontLoader.__super__.constructor.apply(this,arguments)}FontLoader.prototype.enter=function(){var s,wf;if(config.font==="sans-serif"){return fsm.next(SessionSetup)}try{window.WebFontConfig={google:{families:[config.font]}};wf=document.createElement("script");wf.src=protocol()+"ajax.googleapis.com/ajax/libs/webfont/1/webfont.js";wf.type="text/javascript";wf.async="true";s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(wf,s)}catch(_error){e=_error;_ulwarn("Error loading font ",e)}return fsm.next(SessionSetup)};return FontLoader}(State);SessionSetup=function(superClass){extend(SessionSetup,superClass);function SessionSetup(){return SessionSetup.__super__.constructor.apply(this,arguments)}SessionSetup.prototype.enter=function(){session=(new SessionFactory).get();return fsm.next(NoStateCheck)};return SessionSetup}(State);NoStateCheck=function(superClass){extend(NoStateCheck,superClass);function NoStateCheck(){return NoStateCheck.__super__.constructor.apply(this,arguments)}NoStateCheck.prototype.enter=function(){var ref1;if(((ref1=window.userlike)!=null?ref1.nostate:void 0)!=null&&window.userlike.nostate){_ulwarn("###################################################################");_ulwarn("WARNING: Widget in nostate mode. Sessions don't persist on page change");_ulwarn("###################################################################");return fsm.next(ResetState)}else{return fsm.next(WidgetVerify)}};return NoStateCheck}(State);ResetState=function(superClass){extend(ResetState,superClass);function ResetState(){return ResetState.__super__.constructor.apply(this,arguments)}ResetState.prototype.enter=function(){session.reset();return fsm.next(WidgetVerify)};return ResetState}(State);WidgetVerify=function(superClass){extend(WidgetVerify,superClass);function WidgetVerify(){return WidgetVerify.__super__.constructor.apply(this,arguments)}WidgetVerify.prototype.enter=function(){var data;if(session.persisted_state==="Chat"||session.persisted_state==="ChatMinimized"){data=session.getConfig();_ulwarn("WidgetVerify current="+config.widget_key+" stored="+(data!=null?data.widget_key:void 0));if(data&&data.widget_key!==config.widget_key&&data.config&&data.app_key){try{_ulwarn("###################################################################");_ulwarn("INFO: Using presisted config");_ulwarn("###################################################################");fsm.next(ConfigSetup,data);return}catch(_error){e=_error;_ulwarn("Error getting original config")}}}return fsm.next(Setup)};return WidgetVerify}(State);Setup=function(superClass){extend(Setup,superClass);function Setup(){return Setup.__super__.constructor.apply(this,arguments)}Setup.prototype.enter=function(){button=(new ButtonFactory).makeButton();goal=new WidgetGoal;slot=new Slot;pusher=new Pusher;popup=new Popup;tracking=(new TrackingFactory).get();tracking_event=new TrackingEvent;sound=(new SoundFactory).get();return fsm.next(ThemeCSS)};return Setup}(State);ThemeCSS=function(superClass){extend(ThemeCSS,superClass);function ThemeCSS(){return ThemeCSS.__super__.constructor.apply(this,arguments)}ThemeCSS.prototype.enter=function(){var theme_style_element;theme_style_element=document.createElement("style");theme_style_element.type="text/css";if(theme_style_element.styleSheet){theme_style_element.styleSheet.cssText=config.theme_css}else{theme_style_element.appendChild(document.createTextNode(config.theme_css))}document.getElementsByTagName("head")[0].appendChild(theme_style_element);return fsm.next(CustomCSS)};return ThemeCSS}(State);CustomCSS=function(superClass){extend(CustomCSS,superClass);function CustomCSS(){return CustomCSS.__super__.constructor.apply(this,arguments)}CustomCSS.prototype.enter=function(){var custom_style_element;custom_style_element=document.createElement("style");custom_style_element.type="text/css";if(custom_style_element.styleSheet){custom_style_element.styleSheet.cssText=config.custom_css}else{custom_style_element.appendChild(document.createTextNode(config.custom_css))}document.getElementsByTagName("head")[0].appendChild(custom_style_element);return fsm.next(BlockedCheck)};return CustomCSS}(State);BlockedCheck=function(superClass){extend(BlockedCheck,superClass);function BlockedCheck(){return BlockedCheck.__super__.constructor.apply(this,arguments)}BlockedCheck.prototype.enter=function(){if(session.get("blocked")){return fsm.next(Blocked)}else{return fsm.next(WhitelistCheck)}};return BlockedCheck}(State);this.userlikeCallbackGeoIP=function(data){return fsm.event("response",data)};WhitelistCheck=function(superClass){extend(WhitelistCheck,superClass);function WhitelistCheck(){return WhitelistCheck.__super__.constructor.apply(this,arguments)}WhitelistCheck.prototype.enter=function(){var ref1;if(((ref1=window.userlike)!=null?ref1.whitelist:void 0)!=null){return fsm.event("check")}else{return fsm.event("done")}};WhitelistCheck.prototype.check=function(){if(session.get("whitelist")===1){return fsm.event("done")}else{this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout_load_script);return loadScript("api.userlike.com/api/chat/geoip/?&callback=userlikeCallbackGeoIP",function(){})}};WhitelistCheck.prototype.response=function(data){clearTimeout(this.timer);if(window.userlike.whitelist.indexOf(data.country_code)>-1){fsm.event("done");return session.set("whitelist",1)}else{return _ulwarn("No whitelist match for "+data.country_code)}};WhitelistCheck.prototype.done=function(){return fsm.next(CheckMobileDevice);
};WhitelistCheck.prototype.timerFired=function(){};WhitelistCheck.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return WhitelistCheck}(State);CheckMobileDevice=function(superClass){extend(CheckMobileDevice,superClass);function CheckMobileDevice(){return CheckMobileDevice.__super__.constructor.apply(this,arguments)}CheckMobileDevice.prototype.enter=function(){if(is_mobile&&config.mobile_mode==="disabled"){button.hide();return _ulwarn("Disabled on mobile devices")}else{return fsm.next(LoadStage2)}};return CheckMobileDevice}(State);LoadStage2=function(superClass){extend(LoadStage2,superClass);function LoadStage2(){return LoadStage2.__super__.constructor.apply(this,arguments)}LoadStage2.prototype.enter=function(){return loadStage2(function(){return fsm.next(RemoteControlCheck)})};return LoadStage2}(State);RemoteControlCheck=function(superClass){extend(RemoteControlCheck,superClass);function RemoteControlCheck(){return RemoteControlCheck.__super__.constructor.apply(this,arguments)}RemoteControlCheck.prototype.enter=function(){var state;state=session.getState();if(state==="Chat"||state==="ChatMinimized"){return fsm.next(WidgetInsert)}else if(config.mode_remote){return fsm.next(RemoteApiMode)}else{return fsm.next(ButtonCheck)}};return RemoteControlCheck}(State);RemoteApiMode=function(superClass){extend(RemoteApiMode,superClass);function RemoteApiMode(){return RemoteApiMode.__super__.constructor.apply(this,arguments)}RemoteApiMode.prototype.enter=function(){var fn;fn=window["userlikeRemoteReady"];if(typeof fn==="function"){return fn()}};RemoteApiMode.prototype.reset=function(){return session.reset()};RemoteApiMode.prototype.normal=function(){return fsm.next(ButtonCheck)};RemoteApiMode.prototype.register=function(){config.mode_registration=true;config.mode_proactive=false;config.mode_proactive_registration=false;return fsm.next(ButtonCheck)};RemoteApiMode.prototype.proactive_active=function(data){config.mode_proactive_registration=false;config.mode_registration=false;config.mode_proactive=true;config.proactive_passive_connect=false;if(data.message){config.proactive_message=data.message}if(data.timeout){config.proactive_timeout=data.timeout}return fsm.next(ButtonCheck)};RemoteApiMode.prototype.proactive_passive=function(data){config.mode_proactive_registration=false;config.mode_registration=false;config.mode_proactive=true;config.proactive_passive_connect=true;if(data.message){config.proactive_message=data.message}if(data.timeout){config.proactive_timeout=data.timeout}return fsm.next(ButtonCheck)};RemoteApiMode.prototype.proactive_active_register=function(data){config.mode_proactive=false;config.mode_registration=false;config.mode_proactive_registration=true;config.proactive_passive_connect=false;if(data.message){config.proactive_message=data.message}if(data.timeout){config.proactive_timeout=data.timeout}return fsm.next(ButtonCheck)};RemoteApiMode.prototype.proactive_passive_register=function(data){config.mode_proactive=false;config.mode_registration=false;config.mode_proactive_registration=true;config.proactive_passive_connect=true;if(data.message){config.proactive_message=data.message}if(data.timeout){config.proactive_timeout=data.timeout}return fsm.next(ButtonCheck)};return RemoteApiMode}(State);Blocked=function(superClass){extend(Blocked,superClass);function Blocked(){return Blocked.__super__.constructor.apply(this,arguments)}return Blocked}(State);this.userlikeCallbackButtonCheck=function(resp){_ullog("message="+(resp!=null?resp.message:void 0));slot.setCache(resp);if(resp.message==="GROUP_ONLINE"){return fsm.event("groupAvailable")}else{return fsm.event("groupUnavailable")}};ButtonCheck=function(superClass){extend(ButtonCheck,superClass);function ButtonCheck(){return ButtonCheck.__super__.constructor.apply(this,arguments)}ButtonCheck.prototype.enter=function(){if(config.hide_button||config.change_button){return slot.checkButton("userlikeCallbackButtonCheck")}else{return fsm.next(ButtonShow)}};ButtonCheck.prototype.groupAvailable=function(){return fsm.next(ButtonShow)};ButtonCheck.prototype.groupUnavailable=function(){if(config.hide_button){return fsm.next(ButtonHidden)}else{return fsm.next(ButtonChange)}};return ButtonCheck}(State);ButtonChange=function(superClass){extend(ButtonChange,superClass);function ButtonChange(){return ButtonChange.__super__.constructor.apply(this,arguments)}ButtonChange.prototype.enter=function(){button.changeToOfflineText();return fsm.next(WidgetInsert)};return ButtonChange}(State);ButtonShow=function(superClass){extend(ButtonShow,superClass);function ButtonShow(){return ButtonShow.__super__.constructor.apply(this,arguments)}ButtonShow.prototype.enter=function(){button.fadeInEyecatcher();return fsm.next(WidgetInsert)};return ButtonShow}(State);ButtonHidden=function(superClass){extend(ButtonHidden,superClass);function ButtonHidden(){return ButtonHidden.__super__.constructor.apply(this,arguments)}ButtonHidden.prototype.enter=function(){tracking_event.trigger("button_hidden");button.hide();return fsm.next(ButtonHiddenWidgetInsert)};return ButtonHidden}(State);WidgetInsert=function(superClass){extend(WidgetInsert,superClass);function WidgetInsert(){return WidgetInsert.__super__.constructor.apply(this,arguments)}WidgetInsert.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout);return popup.inject(function(err){if(err){return fsm.event("injectFailed")}else{return fsm.event("injectDone")}})};WidgetInsert.prototype.injectFailed=function(){return fsm.next(SetupError)};WidgetInsert.prototype.injectDone=function(){return fsm.next(ButtonInsert)};WidgetInsert.prototype.timerFired=function(){return fsm.next(SetupError)};WidgetInsert.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return WidgetInsert}(State);ButtonHiddenWidgetInsert=function(superClass){extend(ButtonHiddenWidgetInsert,superClass);function ButtonHiddenWidgetInsert(){return ButtonHiddenWidgetInsert.__super__.constructor.apply(this,arguments)}ButtonHiddenWidgetInsert.prototype.injectDone=function(){return fsm.next(ButtonEventSetup)};return ButtonHiddenWidgetInsert}(WidgetInsert);ButtonInsert=function(superClass){extend(ButtonInsert,superClass);function ButtonInsert(){return ButtonInsert.__super__.constructor.apply(this,arguments)}ButtonInsert.prototype.enter=function(){var delay;button.render();delay=!session.isActive();button.show(delay);tracking_event.trigger("button_displayed");return fsm.next(ButtonEventSetup)};return ButtonInsert}(State);SetupError=function(superClass){extend(SetupError,superClass);function SetupError(){return SetupError.__super__.constructor.apply(this,arguments)}return SetupError}(State);ButtonEventSetup=function(superClass){extend(ButtonEventSetup,superClass);function ButtonEventSetup(){return ButtonEventSetup.__super__.constructor.apply(this,arguments)}ButtonEventSetup.prototype.enter=function(){button.registerEvents();return fsm.next(UserlikeReady)};return ButtonEventSetup}(State);UserlikeReady=function(superClass){extend(UserlikeReady,superClass);function UserlikeReady(){return UserlikeReady.__super__.constructor.apply(this,arguments)}UserlikeReady.prototype.enter=function(){var fn;fn=window["userlikeReady"];if(typeof fn==="function"){fn()}return fsm.next(RestoreState)};return UserlikeReady}(State);RestoreState=function(superClass){extend(RestoreState,superClass);function RestoreState(){return RestoreState.__super__.constructor.apply(this,arguments)}RestoreState.prototype.enter=function(){if(session.getCookieSupport()===null){return fsm.next(NoCookies)}else if(session.isActive()){return fsm.next(RestartSlot)}else if(session.isRject()){return fsm.next(ProactiveSlotReject)}else if(session.isOffline()){return fsm.next(Offline)}else if(config.mode_proactive||config.mode_proactive_registration){return fsm.next(ProactiveTimer)}else{return fsm.next(Idle)}};return RestoreState}(State);Idle=function(superClass){extend(Idle,superClass);function Idle(){return Idle.__super__.constructor.apply(this,arguments)}Idle.prototype.enter=function(){return fsm.reset()};Idle.prototype.persist=function(){return session.setState("Idle")};Idle.prototype.chatButton=function(){button.fadeOutEyecatcher();tracking_event.trigger("chat_requested");fsm.queue("slotRequest");return fsm.next(FacebookLoader)};Idle.prototype.directRequest=function(operator_id){tracking_event.trigger("chat_requested");fsm.queue("directRequest",{operator_id:operator_id});return fsm.next(FacebookLoader)};Idle.prototype.updateAPI=function(){return session.checkUserFromAPI()};return Idle}(State);PusherConnect=function(superClass){extend(PusherConnect,superClass);function PusherConnect(){return PusherConnect.__super__.constructor.apply(this,arguments)}PusherConnect.prototype.enter=function(){return pusher.connect()};PusherConnect.prototype.pick=function(operator_id){return fsm.event("directRequest",operator_id)};PusherConnect.prototype.ban=function(){session.setPusherBan();return pusher.disconnect()};PusherConnect.prototype.connect=function(){return pusher.update()};PusherConnect.prototype.leave=function(callback){session.resetPusherId();pusher.disconnect();return callback()};return PusherConnect}(Idle);NoCookies=function(superClass){extend(NoCookies,superClass);function NoCookies(){return NoCookies.__super__.constructor.apply(this,arguments)}NoCookies.prototype.chatButton=function(){button.fadeOutEyecatcher();return fsm.next(NoCookiesMessage)};NoCookies.prototype.directRequest=function(operator_id){return fsm.next(NoCookiesMessage)};return NoCookies}(Idle);PageUnloading=function(superClass){extend(PageUnloading,superClass);function PageUnloading(){return PageUnloading.__super__.constructor.apply(this,arguments)}return PageUnloading}(State);Offline=function(superClass){extend(Offline,superClass);function Offline(){return Offline.__super__.constructor.apply(this,arguments)}Offline.prototype.persist=function(){session.setState("Offline");return session.resetChatDuration()};return Offline}(Idle);NoSwitch=function(superClass){extend(NoSwitch,superClass);function NoSwitch(){return NoSwitch.__super__.constructor.apply(this,arguments)}NoSwitch.prototype.persist=function(){};NoSwitch.prototype.chatButton=function(){button.fadeOutEyecatcher();return fsm.next(SwitchSocketConnect)};NoSwitch.prototype.directRequest=function(operator_id){return fsm.next(SwitchSocketConnect)};return NoSwitch}(Idle);ProactiveTimer=function(superClass){extend(ProactiveTimer,superClass);function ProactiveTimer(){return ProactiveTimer.__super__.constructor.apply(this,arguments)}ProactiveTimer.prototype.chatButton=function(){button.fadeOutEyecatcher();fsm.queue("slotRequest");return fsm.next(FacebookLoader)};ProactiveTimer.prototype.directRequest=function(operator_id){fsm.queue("directRequest",{operator_id:operator_id});return fsm.next(FacebookLoader)};ProactiveTimer.prototype.timerFired=function(){return fsm.next(ProactiveSlotCheck)};ProactiveTimer.prototype.enter=function(){var delay;delay=parseInt(config.proactive_timeout)+parseInt(button.delayProactive());_ullog("ProactiveTimer::enter delay="+delay);return this.timer=setTimeout(function(){return fsm.event("timerFired")},delay*1e3)};ProactiveTimer.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};ProactiveTimer.prototype.updateAPI=function(){return session.checkUserFromAPI()};return ProactiveTimer}(State);this.userlikeCallbackProactiveSlotCheck=function(resp){if(resp.operator!=null){return fsm.event("slotAvailable",resp)}else{return fsm.event("slotUnavailable",resp)}};ProactiveSlotCheck=function(superClass){extend(ProactiveSlotCheck,superClass);function ProactiveSlotCheck(){return ProactiveSlotCheck.__super__.constructor.apply(this,arguments)}ProactiveSlotCheck.prototype.enter=function(){tracking_event.trigger("proactive_timer");this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout);return slot.checkProactive("userlikeCallbackProactiveSlotCheck")};ProactiveSlotCheck.prototype.slotAvailable=function(data){return fsm.next(ProactiveSlotAvailable,data)};ProactiveSlotCheck.prototype.slotUnavailable=function(data){return fsm.next(ProactiveSlotUnavailable)};ProactiveSlotCheck.prototype.timerFired=function(){return fsm.next(Idle)};ProactiveSlotCheck.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return ProactiveSlotCheck}(State);ProactiveSlotUnavailable=function(superClass){extend(ProactiveSlotUnavailable,superClass);function ProactiveSlotUnavailable(){return ProactiveSlotUnavailable.__super__.constructor.apply(this,arguments)}ProactiveSlotUnavailable.prototype.enter=function(){tracking_event.trigger("proactive_unavailable");return fsm.next(Idle)};return ProactiveSlotUnavailable}(State);ProactiveSlotAvailable=function(superClass){extend(ProactiveSlotAvailable,superClass);function ProactiveSlotAvailable(){return ProactiveSlotAvailable.__super__.constructor.apply(this,arguments)}ProactiveSlotAvailable.prototype.enter=function(data){return fsm.next(ProactiveEventSetup,data)};return ProactiveSlotAvailable}(State);ProactiveEventSetup=function(superClass){extend(ProactiveEventSetup,superClass);function ProactiveEventSetup(){return ProactiveEventSetup.__super__.constructor.apply(this,arguments)}ProactiveEventSetup.prototype.enter=function(data){jq(window).bind("hashchange",function(){return fsm.event("hashchange",window.location.hash)});jq(window).on("unload",function(){return fsm.next(PageUnloading)});fsm.event("done",data);return sound.load()};ProactiveEventSetup.prototype.done=function(data){return fsm.next(ProactiveOffer,data)};return ProactiveEventSetup}(State);ProactiveOffer=function(superClass){extend(ProactiveOffer,superClass);function ProactiveOffer(){return ProactiveOffer.__super__.constructor.apply(this,arguments)}ProactiveOffer.prototype.enter=function(data){if(config.proactive_passive_connect){return fsm.next(ProactiveSlotOfferPassiveStart,data)}else{return fsm.next(ProactiveSlotOfferActive,data)}};return ProactiveOffer}(State);ProactiveSlotOfferActive=function(superClass){extend(ProactiveSlotOfferActive,superClass);function ProactiveSlotOfferActive(){return ProactiveSlotOfferActive.__super__.constructor.apply(this,arguments)}ProactiveSlotOfferActive.prototype.enter=function(){return fsm.next(ProactiveActiveSocketConnect)};return ProactiveSlotOfferActive}(State);ProactiveSlotOfferPassiveStart=function(superClass){extend(ProactiveSlotOfferPassiveStart,superClass);function ProactiveSlotOfferPassiveStart(){return ProactiveSlotOfferPassiveStart.__super__.constructor.apply(this,arguments)}ProactiveSlotOfferPassiveStart.prototype.enter=function(data){session.set("operator_name",data.operator.name);session.set("operator_display_name",data.operator.display_name);session.set("operator_id",data.operator.id);session.setOperatorBinding(data.operator.id,data.operator.operator_group_id);tracking.offerProactiveChat();tracking_event.trigger("proactive_offer");return popup.displaySlot(data.operator.display_name,data.operator.url_image,config.proactive_message,function(){return fsm.next(ProactiveSlotOfferPassive)})};return ProactiveSlotOfferPassiveStart}(State);ProactiveSlotOfferPassive=function(superClass){extend(ProactiveSlotOfferPassive,superClass);function ProactiveSlotOfferPassive(){return ProactiveSlotOfferPassive.__super__.constructor.apply(this,arguments)}ProactiveSlotOfferPassive.prototype.transitionIn=function(callback){button.fadeOutEyecatcher();return popup.showChatView(callback)};ProactiveSlotOfferPassive.prototype.inputEnter=function(data){var text;text=popup.sendMessage();fsm.queue("sendMessage",text);return fsm.next(ProactivePassiveSocketConnect)};ProactiveSlotOfferPassive.prototype.closeButton=function(){return fsm.next(ProactiveSlotRejected)};ProactiveSlotOfferPassive.prototype.minimizeButton=function(){return fsm.next(ProactiveSlotRejected)};ProactiveSlotOfferPassive.prototype.chatButton=function(){return fsm.next(ProactiveSlotRejected)};return ProactiveSlotOfferPassive}(State);ProactiveSlotRejected=function(superClass){extend(ProactiveSlotRejected,superClass);function ProactiveSlotRejected(){return ProactiveSlotRejected.__super__.constructor.apply(this,arguments)}ProactiveSlotRejected.prototype.transitionIn=function(callback){return popup.close(callback)};ProactiveSlotRejected.prototype.enter=function(){tracking_event.trigger("proactive_reject");return fsm.next(ProactiveSlotReject)};return ProactiveSlotRejected}(State);ProactiveSlotReject=function(superClass){extend(ProactiveSlotReject,superClass);function ProactiveSlotReject(){return ProactiveSlotReject.__super__.constructor.apply(this,arguments)}ProactiveSlotReject.prototype.persist=function(){return session.setState("ProactiveSlotReject")};ProactiveSlotReject.prototype.chatButton=function(){fsm.queue("slotRequest");return fsm.next(FacebookLoader)};ProactiveSlotReject.prototype.directRequest=function(operator_id){fsm.queue("directRequest",{operator_id:operator_id});return fsm.next(FacebookLoader)};return ProactiveSlotReject}(State);ProactivePassiveSocketConnect=function(superClass){extend(ProactivePassiveSocketConnect,superClass);function ProactivePassiveSocketConnect(){return ProactivePassiveSocketConnect.__super__.constructor.apply(this,arguments)}ProactivePassiveSocketConnect.prototype.inputEnter=function(data){var text;text=popup.sendMessage();return fsm.queue("sendMessage",text)};ProactivePassiveSocketConnect.prototype.connect=function(){return fsm.next(ProactivePassiveSlotCreate)};ProactivePassiveSocketConnect.prototype.error=function(){return fsm.next(OfflineMessage)};ProactivePassiveSocketConnect.prototype.connectFailed=function(){return fsm.next(OfflineMessage)};ProactivePassiveSocketConnect.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout_connect);return slot.connect()};ProactivePassiveSocketConnect.prototype.timerFired=function(){return fsm.next(OfflineMessage)};ProactivePassiveSocketConnect.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return ProactivePassiveSocketConnect}(State);ProactivePassiveSlotCreate=function(superClass){extend(ProactivePassiveSlotCreate,superClass);function ProactivePassiveSlotCreate(){return ProactivePassiveSlotCreate.__super__.constructor.apply(this,arguments)}ProactivePassiveSlotCreate.prototype.inputEnter=function(data){var text;text=popup.sendMessage();return fsm.queue("sendMessage",text)};ProactivePassiveSlotCreate.prototype.slotCreated=function(data){return fsm.next(ProactivePassiveSlotVerify,data)};ProactivePassiveSlotCreate.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout_connect);return slot.create({proactive:true})};ProactivePassiveSlotCreate.prototype.timerFired=function(){slot.disconnect();return fsm.next(OfflineMessage)};ProactivePassiveSlotCreate.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return ProactivePassiveSlotCreate}(State);ProactivePassiveSlotVerify=function(superClass){extend(ProactivePassiveSlotVerify,superClass);function ProactivePassiveSlotVerify(){return ProactivePassiveSlotVerify.__super__.constructor.apply(this,arguments)}ProactivePassiveSlotVerify.prototype.enter=function(data){if(data.operator){return fsm.next(ProactivePassiveSlotStart,data)}else{return fsm.next(OfflineMessage)}};return ProactivePassiveSlotVerify}(State);ProactivePassiveSlotStart=function(superClass){extend(ProactivePassiveSlotStart,superClass);function ProactivePassiveSlotStart(){return ProactivePassiveSlotStart.__super__.constructor.apply(this,arguments)}ProactivePassiveSlotStart.prototype.enter=function(data){session.set("id",data.session);session.setIfEmpty("uuid",data.uuid);session.set("meta_id",data.meta_id);session.set("was_proactive",true);session.resetStats();if(session.get("operator_id")===data.operator.id){session.setOperatorBinding(data.operator.id,data.operator.operator_group_id);tracking.startProactiveSlot();tracking_event.trigger("chat_connected");tracking_event.trigger("chat_connected_proactive");return fsm.next(Chat)}else{session.set("operator_name",data.operator.name);session.set("operator_display_name",data.operator.display_name);session.set("operator_id",data.operator.id);session.setOperatorBinding(data.operator.id,data.operator.operator_group_id);tracking.startProactiveSlot();return popup.displaySlot(data.operator.display_name,data.operator.url_image,config.default_message,function(){tracking_event.trigger("chat_connected");tracking_event.trigger("chat_connected_proactive");return fsm.next(Chat)})}};return ProactivePassiveSlotStart}(State);ProactiveActiveSocketConnect=function(superClass){extend(ProactiveActiveSocketConnect,superClass);function ProactiveActiveSocketConnect(){return ProactiveActiveSocketConnect.__super__.constructor.apply(this,arguments)}ProactiveActiveSocketConnect.prototype.connect=function(){return fsm.next(ProactiveActiveSlotCreate)};ProactiveActiveSocketConnect.prototype.error=function(){return fsm.next(Idle)};ProactiveActiveSocketConnect.prototype.connectFailed=function(){return fsm.next(Idle)};ProactiveActiveSocketConnect.prototype.timerFired=function(){return fsm.next(Idle)};return ProactiveActiveSocketConnect}(ProactivePassiveSocketConnect);ProactiveActiveSlotCreate=function(superClass){extend(ProactiveActiveSlotCreate,superClass);function ProactiveActiveSlotCreate(){return ProactiveActiveSlotCreate.__super__.constructor.apply(this,arguments)}ProactiveActiveSlotCreate.prototype.slotCreated=function(data){return fsm.next(ProactiveActiveSlotVerify,data)};ProactiveActiveSlotCreate.prototype.timerFired=function(){return fsm.next(Idle)};return ProactiveActiveSlotCreate}(ProactivePassiveSlotCreate);ProactiveActiveSlotVerify=function(superClass){extend(ProactiveActiveSlotVerify,superClass);function ProactiveActiveSlotVerify(){return ProactiveActiveSlotVerify.__super__.constructor.apply(this,arguments)}ProactiveActiveSlotVerify.prototype.enter=function(data){if(data.operator){return fsm.next(ProactiveActiveSlotStart,data)}else{return fsm.next(Idle)}};return ProactiveActiveSlotVerify}(State);ProactiveActiveSlotStart=function(superClass){extend(ProactiveActiveSlotStart,superClass);function ProactiveActiveSlotStart(){return ProactiveActiveSlotStart.__super__.constructor.apply(this,arguments)}ProactiveActiveSlotStart.prototype.enter=function(data){tracking.startProactiveSlot();session.set("id",data.session);session.setIfEmpty("uuid",data.uuid);session.set("meta_id",data.meta_id);session.set("was_proactive",true);session.resetStats();session.set("operator_name",data.operator.name);session.set("operator_display_name",data.operator.display_name);session.set("operator_id",data.operator.id);tracking.offerProactiveChat();tracking_event.trigger("proactive_offer");session.setOperatorBinding(data.operator.id,data.operator.operator_group_id);return popup.displaySlot(data.operator.display_name,data.operator.url_image,config.proactive_message,function(){tracking_event.trigger("chat_connected");tracking_event.trigger("chat_connected_proactive");return fsm.next(Chat)})};return ProactiveActiveSlotStart}(State);FacebookLoader=function(superClass){extend(FacebookLoader,superClass);function FacebookLoader(){return FacebookLoader.__super__.constructor.apply(this,arguments)}FacebookLoader.prototype.enter=function(){if(!facebook&&config.facebook_integration==="load"){if(config.facebook_connect==="register"){return fsm.event("loadSync")}else{return fsm.event("loadAsync")}}else{return fsm.event("done")}};FacebookLoader.prototype.timerFired=function(){return fsm.event("done")};FacebookLoader.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};FacebookLoader.prototype.loadAsync=function(){window.fbAsyncInit=function(){FB.init({appId:config.facebook_app_id,status:true,cookies:true,xfbml:true});facebook=true;_ullog("FacebookLoader loaded integration="+config.facebook_integration+" facebook_ready="+facebook)};if(window.FB!==void 0){try{window.FB=null;delete window.FB}catch(_error){e=_error;_ulwarn("FacebookLoader cannot delete existing sdk")}}loadScript("connect.facebook.net/"+config.locale+"/all.js",function(){});return fsm.event("done")};FacebookLoader.prototype.loadSync=function(){window.fbAsyncInit=function(_this){return function(){clearTimeout(_this.timer);FB.init({appId:config.facebook_app_id,status:true,cookies:true,xfbml:true});return fsm.event("done")}}(this);if(window.FB!==void 0){try{window.FB=null;delete window.FB}catch(_error){e=_error;_ulwarn("FacebookLoader cannot delete existing sdk")}}this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout_load_script);return loadScript("connect.facebook.net/"+config.locale+"/all.js",function(){})};FacebookLoader.prototype.done=function(){facebook=window.FB!==void 0;_ullog("FacebookLoader integration="+config.facebook_integration+" facebook_ready="+facebook);return fsm.next(TwitterLoader)};return FacebookLoader}(State);TwitterLoader=function(superClass){extend(TwitterLoader,superClass);function TwitterLoader(){return TwitterLoader.__super__.constructor.apply(this,arguments)}TwitterLoader.prototype.timerFired=function(){return fsm.event("done")};TwitterLoader.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};TwitterLoader.prototype.enter=function(){if(config.twitter_integration==="disabled"){return fsm.event("done")}else if(config.twitter_integration==="load"){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout_load_script);return loadScript("platform.twitter.com/widgets.js",function(){twitter=true;return fsm.event("done")})}else if(config.twitter_integration==="extern"){twitter=window.twttr!==void 0;return fsm.event("done")}};TwitterLoader.prototype.done=function(){_ullog("TwitterLoader integration="+config.twitter_integration+" twitter="+twitter);return fsm.next(EventSetup)};return TwitterLoader}(State);EventSetup=function(superClass){extend(EventSetup,superClass);function EventSetup(){return EventSetup.__super__.constructor.apply(this,arguments)}EventSetup.prototype.done=function(data){return fsm.next(CheckDisclaimer,data)};return EventSetup}(ProactiveEventSetup);this.userlikeCallbackAvailableCheck=function(resp){_ullog("message="+(resp!=null?resp.message:void 0));slot.setCache(resp);if(resp.message==="GROUP_ONLINE"){return fsm.event("groupAvailable",resp)}else{return fsm.event("groupUnavailable")}};CheckDisclaimer=function(superClass){extend(CheckDisclaimer,superClass);function CheckDisclaimer(){return CheckDisclaimer.__super__.constructor.apply(this,arguments)}CheckDisclaimer.prototype.enter=function(){if(config.disclaimer_show){return fsm.next(DisclaimerAvailableCheck)}else{return fsm.next(CheckPreChatFirst)}};return CheckDisclaimer}(State);CheckPreChatFirst=function(superClass){extend(CheckPreChatFirst,superClass);function CheckPreChatFirst(){return CheckPreChatFirst.__super__.constructor.apply(this,arguments)}CheckPreChatFirst.prototype.enter=function(){if(config.mode_registration||config.mode_proactive_registration){return fsm.next(RegisterAvailableCheck)}else{return fsm.next(CheckPreChatSecond)}};return CheckPreChatFirst}(State);CheckPreChatSecond=function(superClass){extend(CheckPreChatSecond,superClass);function CheckPreChatSecond(){return CheckPreChatSecond.__super__.constructor.apply(this,arguments)}CheckPreChatSecond.prototype.enter=function(){if(config.group_select_enabled){return fsm.next(GroupSelectAvailableCheck)}else{return fsm.next(CheckPreChatThird)}};return CheckPreChatSecond}(State);CheckPreChatThird=function(superClass){extend(CheckPreChatThird,superClass);function CheckPreChatThird(){return CheckPreChatThird.__super__.constructor.apply(this,arguments)}CheckPreChatThird.prototype.enter=function(){if(config.pre_survey_enabled){return fsm.next(PreSurveyAvailableCheck)}else{return fsm.next(CheckSlotAvailable)}};return CheckPreChatThird}(State);CheckSlotAvailable=function(superClass){extend(CheckSlotAvailable,superClass);function CheckSlotAvailable(){return CheckSlotAvailable.__super__.constructor.apply(this,arguments)}CheckSlotAvailable.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout);tracking_event.trigger("slot_check");return slot.checkAvailable("userlikeCallbackAvailableCheck")};CheckSlotAvailable.prototype.groupAvailable=function(){tracking_event.trigger("slot_available");return fsm.next(CheckPreChatLast)};CheckSlotAvailable.prototype.groupUnavailable=function(){tracking_event.trigger("slot_unavailable");return fsm.next(OfflineMessage)};CheckSlotAvailable.prototype.timerFired=function(){return fsm.next(OfflineMessage)};CheckSlotAvailable.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return CheckSlotAvailable}(State);CheckPreChatLast=function(superClass){extend(CheckPreChatLast,superClass);function CheckPreChatLast(){return CheckPreChatLast.__super__.constructor.apply(this,arguments)}CheckPreChatLast.prototype.transitionIn=function(callback){button.fadeOutEyecatcher();return popup.showConnectView(callback)};CheckPreChatLast.prototype.enter=function(){if(config.passive_connect){return fsm.next(PassiveConnectAvailableCheck)}else{return fsm.next(SocketConnect)}};return CheckPreChatLast}(State);this.userlikeCallbackPassiveConnectSlotCheck=function(resp){if(resp.operator!=null){return fsm.event("slotAvailable",resp)}else{return fsm.event("slotUnavailable",resp)}};PassiveConnectAvailableCheck=function(superClass){extend(PassiveConnectAvailableCheck,superClass);function PassiveConnectAvailableCheck(){return PassiveConnectAvailableCheck.__super__.constructor.apply(this,arguments)}PassiveConnectAvailableCheck.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout);return slot.checkPassiveConnect("userlikeCallbackPassiveConnectSlotCheck")};PassiveConnectAvailableCheck.prototype.inputEnter=function(data){var text;text=popup.sendMessage();return fsm.queue("sendMessage",text)};PassiveConnectAvailableCheck.prototype.slotAvailable=function(data){return fsm.next(PassiveConnectStart,data)};PassiveConnectAvailableCheck.prototype.slotUnavailable=function(data){return fsm.next(OfflineMessage)};PassiveConnectAvailableCheck.prototype.timerFired=function(){return fsm.next(OfflineMessage)};PassiveConnectAvailableCheck.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return PassiveConnectAvailableCheck}(State);DisclaimerAvailableCheck=function(superClass){extend(DisclaimerAvailableCheck,superClass);function DisclaimerAvailableCheck(){return DisclaimerAvailableCheck.__super__.constructor.apply(this,arguments)}DisclaimerAvailableCheck.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout);tracking_event.trigger("slot_check");return slot.checkAvailable("userlikeCallbackAvailableCheck")};DisclaimerAvailableCheck.prototype.groupAvailable=function(){tracking_event.trigger("slot_available");return fsm.next(Disclaimer)};DisclaimerAvailableCheck.prototype.groupUnavailable=function(){tracking_event.trigger("slot_unavailable");return fsm.next(OfflineMessage)};DisclaimerAvailableCheck.prototype.timerFired=function(){return fsm.next(OfflineMessage)};DisclaimerAvailableCheck.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return DisclaimerAvailableCheck}(State);Disclaimer=function(superClass){extend(Disclaimer,superClass);function Disclaimer(){return Disclaimer.__super__.constructor.apply(this,arguments)}Disclaimer.prototype.enter=function(){button.fadeOutEyecatcher();return popup.showDisclaimer(function(){})};Disclaimer.prototype.chatButton=function(){tracking_event.trigger("disclaimer_cancel");return popup.close(function(){return fsm.next(Idle)})};Disclaimer.prototype.closeButton=function(){tracking_event.trigger("disclaimer_cancel");return popup.close(function(){
return fsm.next(Idle)})};Disclaimer.prototype.submitButton=function(){tracking_event.trigger("disclaimer_ok");return fsm.next(CheckPreChatFirst)};return Disclaimer}(State);RegisterAvailableCheck=function(superClass){extend(RegisterAvailableCheck,superClass);function RegisterAvailableCheck(){return RegisterAvailableCheck.__super__.constructor.apply(this,arguments)}RegisterAvailableCheck.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout);tracking_event.trigger("slot_check");return slot.checkAvailable("userlikeCallbackAvailableCheck")};RegisterAvailableCheck.prototype.groupAvailable=function(){tracking_event.trigger("slot_available");return fsm.next(RegisterOptions)};RegisterAvailableCheck.prototype.groupUnavailable=function(){tracking_event.trigger("slot_unavailable");return fsm.next(OfflineMessage)};RegisterAvailableCheck.prototype.timerFired=function(){return fsm.next(OfflineMessage)};RegisterAvailableCheck.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return RegisterAvailableCheck}(State);PreSurveyAvailableCheck=function(superClass){extend(PreSurveyAvailableCheck,superClass);function PreSurveyAvailableCheck(){return PreSurveyAvailableCheck.__super__.constructor.apply(this,arguments)}PreSurveyAvailableCheck.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout);tracking_event.trigger("slot_check");return slot.checkAvailable("userlikeCallbackAvailableCheck")};PreSurveyAvailableCheck.prototype.groupAvailable=function(){tracking_event.trigger("slot_available");return fsm.next(PreSurveyForm)};PreSurveyAvailableCheck.prototype.groupUnavailable=function(){tracking_event.trigger("slot_unavailable");return fsm.next(OfflineMessage)};PreSurveyAvailableCheck.prototype.timerFired=function(){return fsm.next(OfflineMessage)};PreSurveyAvailableCheck.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return PreSurveyAvailableCheck}(State);GroupSelectAvailableCheck=function(superClass){extend(GroupSelectAvailableCheck,superClass);function GroupSelectAvailableCheck(){return GroupSelectAvailableCheck.__super__.constructor.apply(this,arguments)}GroupSelectAvailableCheck.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout);tracking_event.trigger("slot_check");return slot.checkAvailable("userlikeCallbackAvailableCheck")};GroupSelectAvailableCheck.prototype.groupAvailable=function(data){tracking_event.trigger("slot_available");return fsm.next(GroupSelect,data)};GroupSelectAvailableCheck.prototype.groupUnavailable=function(){tracking_event.trigger("slot_unavailable");return fsm.next(OfflineMessage)};GroupSelectAvailableCheck.prototype.timerFired=function(){return fsm.next(OfflineMessage)};GroupSelectAvailableCheck.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return GroupSelectAvailableCheck}(State);Warning=function(superClass){extend(Warning,superClass);function Warning(){return Warning.__super__.constructor.apply(this,arguments)}Warning.prototype.transitionOut=function(callback){return popup.close(callback)};Warning.prototype.chatButton=function(){return fsm.next(Idle)};Warning.prototype.closeButton=function(){return fsm.next(Idle)};Warning.prototype.enter=function(){return this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout)};Warning.prototype.timerFired=function(){return fsm.next(Idle)};Warning.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return Warning}(State);NoCookiesMessage=function(superClass){extend(NoCookiesMessage,superClass);function NoCookiesMessage(){return NoCookiesMessage.__super__.constructor.apply(this,arguments)}NoCookiesMessage.prototype.transitionIn=function(callback){button.fadeOutEyecatcher();return popup.showNoCookiesMessage(callback)};NoCookiesMessage.prototype.chatButton=function(){return fsm.next(NoCookies)};NoCookiesMessage.prototype.closeButton=function(){return fsm.next(NoCookies)};NoCookiesMessage.prototype.enter=function(){return this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout)};NoCookiesMessage.prototype.timerFired=function(){return fsm.next(NoCookies)};return NoCookiesMessage}(Warning);ErrorMessage=function(superClass){extend(ErrorMessage,superClass);function ErrorMessage(){return ErrorMessage.__super__.constructor.apply(this,arguments)}ErrorMessage.prototype.enter=function(){return tracking_event.trigger("error_message")};ErrorMessage.prototype.transitionIn=function(callback){button.fadeOutEyecatcher();return popup.showErrorMessage(callback)};return ErrorMessage}(Warning);QuotaWarning=function(superClass){extend(QuotaWarning,superClass);function QuotaWarning(){return QuotaWarning.__super__.constructor.apply(this,arguments)}QuotaWarning.prototype.enter=function(){button.fadeOutEyecatcher();return popup.showQuotaWarning(function(){})};return QuotaWarning}(Warning);ExpiredWarning=function(superClass){extend(ExpiredWarning,superClass);function ExpiredWarning(){return ExpiredWarning.__super__.constructor.apply(this,arguments)}ExpiredWarning.prototype.enter=function(){button.fadeOutEyecatcher();return popup.showExpiredWarning(function(){})};return ExpiredWarning}(Warning);OfflineMessage=function(superClass){extend(OfflineMessage,superClass);function OfflineMessage(){return OfflineMessage.__super__.constructor.apply(this,arguments)}OfflineMessage.prototype.persist=function(){session.setState("Offline");return session.resetChatDuration()};OfflineMessage.prototype.enter=function(){tracking_event.trigger("offline_mode");if(config.offline_mode==="message"){return fsm.next(OfflineMessageForm)}else{return fsm.next(OfflineMessageView)}};return OfflineMessage}(State);OfflineMessageForm=function(superClass){extend(OfflineMessageForm,superClass);function OfflineMessageForm(){return OfflineMessageForm.__super__.constructor.apply(this,arguments)}OfflineMessageForm.prototype.enter=function(){tracking_event.trigger("offline_form_show");fsm.poll();return fsm.reset()};OfflineMessageForm.prototype.sendMessage=function(text){return popup.appendOfflineMessageForm(text)};OfflineMessageForm.prototype.transitionIn=function(callback){button.fadeOutEyecatcher();return popup.showOfflineMessageForm(callback)};OfflineMessageForm.prototype.chatButton=function(){return popup.close(function(){return fsm.next(Idle)})};OfflineMessageForm.prototype.closeButton=function(){return popup.close(function(){return fsm.next(Idle)})};OfflineMessageForm.prototype.submitButton=function(){if(popup.validateOfflineMessage()){return fsm.next(OfflineMessageProcess)}};OfflineMessageForm.prototype.slotRequest=function(){};return OfflineMessageForm}(State);OfflineMessageView=function(superClass){extend(OfflineMessageView,superClass);function OfflineMessageView(){return OfflineMessageView.__super__.constructor.apply(this,arguments)}OfflineMessageView.prototype.enter=function(){return tracking_event.trigger("offline_view_show")};OfflineMessageView.prototype.transitionIn=function(callback){button.fadeOutEyecatcher();return popup.showOfflineMessageView(callback)};return OfflineMessageView}(OfflineMessageForm);OfflineMessageProcess=function(superClass){extend(OfflineMessageProcess,superClass);function OfflineMessageProcess(){return OfflineMessageProcess.__super__.constructor.apply(this,arguments)}OfflineMessageProcess.prototype.enter=function(){if(popup.requestedScreenshot()){return fsm.next(OfflineMessageScreenshot)}else{return fsm.next(OfflineMessageSend)}};return OfflineMessageProcess}(State);OfflineMessageSend=function(superClass){extend(OfflineMessageSend,superClass);function OfflineMessageSend(){return OfflineMessageSend.__super__.constructor.apply(this,arguments)}OfflineMessageSend.prototype.transitionIn=function(callback){return popup.showProgressView(callback)};OfflineMessageSend.prototype.success=function(data){return fsm.next(OfflineMessageDone,data)};OfflineMessageSend.prototype.error=function(){return fsm.next(ErrorMessage)};OfflineMessageSend.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout_connect);tracking_event.trigger("offline_form_submit");return popup.sendOfflineMessage()};OfflineMessageSend.prototype.timerFired=function(){return fsm.next(ErrorMessage)};OfflineMessageSend.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return OfflineMessageSend}(State);OfflineMessageDone=function(superClass){extend(OfflineMessageDone,superClass);function OfflineMessageDone(){return OfflineMessageDone.__super__.constructor.apply(this,arguments)}OfflineMessageDone.prototype.enter=function(data){if(popup.requestedScreenshot()){if(data.id!=null){return fsm.next(OfflineMessageScreenshotSend,data)}else{return fsm.next(ErrorMessage)}}else{return fsm.next(OfflineMessageSent)}};return OfflineMessageDone}(State);OfflineMessageScreenshot=function(superClass){extend(OfflineMessageScreenshot,superClass);function OfflineMessageScreenshot(){return OfflineMessageScreenshot.__super__.constructor.apply(this,arguments)}OfflineMessageScreenshot.prototype.transitionIn=function(callback){return popup.close(callback)};OfflineMessageScreenshot.prototype.screenshotTaken=function(){return fsm.next(OfflineMessageSend)};OfflineMessageScreenshot.prototype.screenshotError=function(){return fsm.next(OfflineMessageSent)};OfflineMessageScreenshot.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout_screenshot);return popup.takeOfflineScreenshot()};OfflineMessageScreenshot.prototype.timerFired=function(){return fsm.next(OfflineMessageSent)};OfflineMessageScreenshot.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return OfflineMessageScreenshot}(State);OfflineMessageScreenshotSend=function(superClass){extend(OfflineMessageScreenshotSend,superClass);function OfflineMessageScreenshotSend(){return OfflineMessageScreenshotSend.__super__.constructor.apply(this,arguments)}OfflineMessageScreenshotSend.prototype.screenshotSent=function(){return fsm.next(OfflineMessageSent)};OfflineMessageScreenshotSend.prototype.enter=function(data){return popup.sendOfflineScreenshot(data.id)};return OfflineMessageScreenshotSend}(State);OfflineMessageSent=function(superClass){extend(OfflineMessageSent,superClass);function OfflineMessageSent(){return OfflineMessageSent.__super__.constructor.apply(this,arguments)}OfflineMessageSent.prototype.transitionIn=function(callback){return popup.showOfflineMessageSent(callback)};OfflineMessageSent.prototype.transitionOut=function(callback){return popup.close(callback)};OfflineMessageSent.prototype.chatButton=function(){return popup.close(function(){return fsm.next(Idle)})};OfflineMessageSent.prototype.closeButton=function(){return popup.close(function(){return fsm.next(Idle)})};OfflineMessageSent.prototype.directRequest=function(){return popup.close(function(){return fsm.next(Idle)})};OfflineMessageSent.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout);return tracking.sendOfflineMessage()};OfflineMessageSent.prototype.timerFired=function(){return fsm.next(Idle)};OfflineMessageSent.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return OfflineMessageSent}(State);RegisterOptions=function(superClass){extend(RegisterOptions,superClass);function RegisterOptions(){return RegisterOptions.__super__.constructor.apply(this,arguments)}RegisterOptions.prototype.enter=function(){var ref1,ref2;if(((ref1=session.get("name"))!=null?ref1.length:void 0)&&((ref2=session.get("email"))!=null?ref2.length:void 0)){return fsm.next(CheckPreChatSecond)}else if(config.facebook_connect!=="register"){return fsm.next(RegisterForm)}else if(!facebook){return fsm.next(RegisterForm)}else{this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout/2);return FB.getLoginStatus(function(_this){return function(response){_ullog("getLoginStatus response=",response);if(response.status!=="connected"){session.set("facebook_connected",true);return fsm.next(RegisterFacebookLogin)}else{return fsm.next(RegisterFacebookApiMe)}}}(this))}};RegisterOptions.prototype.timerFired=function(){return fsm.next(RegisterForm)};RegisterOptions.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return RegisterOptions}(State);GroupSelect=function(superClass){extend(GroupSelect,superClass);function GroupSelect(){return GroupSelect.__super__.constructor.apply(this,arguments)}GroupSelect.prototype.enter=function(data){this.data=data;if(this.data.available.length===1){return fsm.event("select",1)}else{button.fadeOutEyecatcher();popup.showGroupSelect(this.data,function(){});return tracking_event.trigger("group_select_show")}};GroupSelect.prototype.chatButton=function(){tracking_event.trigger("group_select_cancel");return popup.close(function(){return fsm.next(Idle)})};GroupSelect.prototype.closeButton=function(){tracking_event.trigger("group_select_cancel");return popup.close(function(){return fsm.next(Idle)})};GroupSelect.prototype.select=function(v){if(!v){return}tracking_event.trigger("group_select_submit");session.set("group_select_id",this.data.available[v-1].id);return fsm.next(CheckPreChatThird)};return GroupSelect}(State);RegisterForm=function(superClass){extend(RegisterForm,superClass);function RegisterForm(){return RegisterForm.__super__.constructor.apply(this,arguments)}RegisterForm.prototype.transitionIn=function(callback){button.fadeOutEyecatcher();return popup.showRegisterForm(callback)};RegisterForm.prototype.enter=function(){return tracking_event.trigger("register_show")};RegisterForm.prototype.chatButton=function(){tracking_event.trigger("register_cancel");return popup.close(function(){return fsm.next(Idle)})};RegisterForm.prototype.directRequest=function(){tracking_event.trigger("register_cancel");return popup.close(function(){return fsm.next(Idle)})};RegisterForm.prototype.closeButton=function(){tracking_event.trigger("register_cancel");return popup.close(function(){return fsm.next(Idle)})};RegisterForm.prototype.submitButton=function(){tracking_event.trigger("register_submit");if(popup.validateRegisterForm()){return fsm.next(CheckPreChatSecond)}};return RegisterForm}(State);RegisterFacebookLogin=function(superClass){extend(RegisterFacebookLogin,superClass);function RegisterFacebookLogin(){return RegisterFacebookLogin.__super__.constructor.apply(this,arguments)}RegisterFacebookLogin.prototype.transitionIn=function(callback){button.fadeOutEyecatcher();return popup.showRegisterFormFacebook(callback)};RegisterFacebookLogin.prototype.facebookLoginResponse=function(response){if(response.authResponse){tracking_event.trigger("facebook_login_success");return fsm.event("facebookApiMeRequest")}else{tracking_event.trigger("facebook_login_failure");_ullog("User cancelled login or did not fully authorize.");return fsm.next(RegisterForm)}};RegisterFacebookLogin.prototype.facebookApiMeRequest=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout/2);return FB.api("/me",function(response){return fsm.event("facebookApiMeResponse",response)})};RegisterFacebookLogin.prototype.facebookApiMeResponse=function(response){if(response.email&&response.name){tracking_event.trigger("facebook_me_response");session.set("email",response.email);session.set("name",response.name);return fsm.next(CheckPreChatSecond)}else{_ulwarn("Incomplete Facebook ME Response.",response);return fsm.next(RegisterForm)}};RegisterFacebookLogin.prototype.timerFired=function(){return fsm.next(RegisterForm)};RegisterFacebookLogin.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return RegisterFacebookLogin}(RegisterForm);RegisterFacebookApiMe=function(superClass){extend(RegisterFacebookApiMe,superClass);function RegisterFacebookApiMe(){return RegisterFacebookApiMe.__super__.constructor.apply(this,arguments)}RegisterFacebookApiMe.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout/2);return FB.api("/me",function(response){return fsm.event("facebookApiMeResponse",response)})};RegisterFacebookApiMe.prototype.facebookApiMeResponse=function(response){if(response.email&&response.name){tracking_event.trigger("facebook_me_response");session.set("email",response.email);session.set("name",response.name);return fsm.next(CheckPreChatSecond)}else{_ulwarn("Incomplete Facebook ME Response.",response);return fsm.next(RegisterForm)}};RegisterFacebookApiMe.prototype.timerFired=function(){return fsm.next(RegisterForm)};RegisterFacebookApiMe.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return RegisterFacebookApiMe}(State);PreSurveyForm=function(superClass){extend(PreSurveyForm,superClass);function PreSurveyForm(){return PreSurveyForm.__super__.constructor.apply(this,arguments)}PreSurveyForm.prototype.transitionIn=function(callback){button.fadeOutEyecatcher();return popup.showPreSurveyView(callback)};PreSurveyForm.prototype.enter=function(){return tracking_event.trigger("pre_survey_show")};PreSurveyForm.prototype.chatButton=function(){tracking_event.trigger("pre_survey_cancel");return popup.close(function(){return fsm.next(Idle)})};PreSurveyForm.prototype.closeButton=function(){tracking_event.trigger("pre_survey_cancel");return popup.close(function(){return fsm.next(Idle)})};PreSurveyForm.prototype.directRequest=function(){tracking_event.trigger("pre_survey_cancel");return popup.close(function(){return fsm.next(Idle)})};PreSurveyForm.prototype.select=function(v){tracking_event.trigger("pre_survey_submit");session.set("pre_survey_option",config["pre_survey_option0"+v]);return fsm.next(CheckSlotAvailable)};return PreSurveyForm}(State);PassiveConnectStart=function(superClass){extend(PassiveConnectStart,superClass);function PassiveConnectStart(){return PassiveConnectStart.__super__.constructor.apply(this,arguments)}PassiveConnectStart.prototype.enter=function(data){session.set("operator_name",data.operator.name);session.set("operator_display_name",data.operator.display_name);session.set("operator_id",data.operator.id);session.setOperatorBinding(data.operator.id,data.operator.operator_group_id);tracking_event.trigger("chat_passive_connect");return popup.displaySlot(data.operator.display_name,data.operator.url_image,config.default_message,function(){return fsm.next(PassiveConnectOffer)})};return PassiveConnectStart}(State);PassiveConnectOffer=function(superClass){extend(PassiveConnectOffer,superClass);function PassiveConnectOffer(){return PassiveConnectOffer.__super__.constructor.apply(this,arguments)}PassiveConnectOffer.prototype.enter=function(){return fsm.poll()};PassiveConnectOffer.prototype.transitionIn=function(callback){button.fadeOutEyecatcher();return popup.showChatView(callback)};PassiveConnectOffer.prototype.inputEnter=function(data){var text;text=popup.sendMessage();fsm.queue("sendMessage",text);return fsm.next(PassiveConnectSocketConnect)};PassiveConnectOffer.prototype.sendMessage=function(text){fsm.unshift("sendMessage",text);return fsm.next(PassiveConnectSocketConnect)};PassiveConnectOffer.prototype.closeButton=function(){return popup.close(function(){return fsm.next(Idle)})};PassiveConnectOffer.prototype.minimizeButton=function(){return popup.close(function(){return fsm.next(Idle)})};PassiveConnectOffer.prototype.chatButton=function(){return popup.close(function(){return fsm.next(Idle)})};return PassiveConnectOffer}(State);PassiveConnectSocketConnect=function(superClass){extend(PassiveConnectSocketConnect,superClass);function PassiveConnectSocketConnect(){return PassiveConnectSocketConnect.__super__.constructor.apply(this,arguments)}PassiveConnectSocketConnect.prototype.connect=function(){return fsm.next(PassiveConnectSlotCreate)};PassiveConnectSocketConnect.prototype.error=function(){return fsm.next(OfflineMessage)};PassiveConnectSocketConnect.prototype.connectFailed=function(){return fsm.next(OfflineMessage)};PassiveConnectSocketConnect.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout_connect);return slot.connect()};PassiveConnectSocketConnect.prototype.timerFired=function(){return fsm.next(OfflineMessage)};PassiveConnectSocketConnect.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};PassiveConnectSocketConnect.prototype.inputEnter=function(data){var text;text=popup.sendMessage();return fsm.queue("sendMessage",text)};return PassiveConnectSocketConnect}(State);PassiveConnectSlotCreate=function(superClass){extend(PassiveConnectSlotCreate,superClass);function PassiveConnectSlotCreate(){return PassiveConnectSlotCreate.__super__.constructor.apply(this,arguments)}PassiveConnectSlotCreate.prototype.inputEnter=function(data){var text;text=popup.sendMessage();return fsm.queue("sendMessage",text)};PassiveConnectSlotCreate.prototype.slotCreated=function(data){return fsm.next(PassiveConnectSlotVerify,data)};PassiveConnectSlotCreate.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout_connect);return slot.create({proactive:false,operator_group_id:session.get("group_select_id")})};PassiveConnectSlotCreate.prototype.timerFired=function(){return fsm.next(OfflineMessage)};PassiveConnectSlotCreate.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return PassiveConnectSlotCreate}(State);PassiveConnectSlotVerify=function(superClass){extend(PassiveConnectSlotVerify,superClass);function PassiveConnectSlotVerify(){return PassiveConnectSlotVerify.__super__.constructor.apply(this,arguments)}PassiveConnectSlotVerify.prototype.enter=function(data){if(data.operator){return fsm.next(PassiveConnectSlotStart,data)}else{return fsm.next(OfflineMessage)}};return PassiveConnectSlotVerify}(State);PassiveConnectSlotStart=function(superClass){extend(PassiveConnectSlotStart,superClass);function PassiveConnectSlotStart(){return PassiveConnectSlotStart.__super__.constructor.apply(this,arguments)}PassiveConnectSlotStart.prototype.enter=function(data){session.set("id",data.session);session.setIfEmpty("uuid",data.uuid);session.set("meta_id",data.meta_id);session.set("was_proactive",false);session.resetStats();if(session.get("operator_id")===data.operator.id){session.setOperatorBinding(data.operator.id,data.operator.operator_group_id);tracking.startSlot();tracking_event.trigger("chat_connected");return fsm.next(Chat)}else{session.set("operator_name",data.operator.name);session.set("operator_display_name",data.operator.display_name);session.set("operator_id",data.operator.id);session.setOperatorBinding(data.operator.id,data.operator.operator_group_id);tracking.startSlot();return popup.displaySlot(data.operator.display_name,data.operator.url_image,config.default_message,function(){tracking_event.trigger("chat_connected");return fsm.next(Chat)})}};return PassiveConnectSlotStart}(State);SocketConnect=function(superClass){extend(SocketConnect,superClass);function SocketConnect(){return SocketConnect.__super__.constructor.apply(this,arguments)}SocketConnect.prototype.connect=function(){return fsm.next(SlotCreate,{proactive:false})};SocketConnect.prototype.error=function(){return fsm.next(OfflineMessage)};SocketConnect.prototype.connectFailed=function(){return fsm.next(OfflineMessage)};SocketConnect.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout_connect);return slot.connect()};SocketConnect.prototype.timerFired=function(){slot.disconnect();return fsm.next(OfflineMessage)};SocketConnect.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return SocketConnect}(State);SlotCreate=function(superClass){extend(SlotCreate,superClass);function SlotCreate(){return SlotCreate.__super__.constructor.apply(this,arguments)}SlotCreate.prototype.slotCreated=function(data){return fsm.next(SlotVerify,data)};SlotCreate.prototype.enter=function(data){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout_connect);return fsm.poll()};SlotCreate.prototype.directRequest=function(data){return slot.direct(data)};SlotCreate.prototype.slotRequest=function(){return slot.create({proactive:false,operator_group_id:session.get("group_select_id")})};SlotCreate.prototype.timerFired=function(){slot.disconnect();return fsm.next(OfflineMessage)};SlotCreate.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};SlotCreate.prototype.closeButton=function(){return fsm.next(ChatWaitQuit)};SlotCreate.prototype.minimizeButton=function(){return fsm.next(ChatWaitQuit)};SlotCreate.prototype.inputEnter=function(){var text;text=popup.sendMessage();return fsm.queue("sendMessage",text)};return SlotCreate}(State);SlotVerify=function(superClass){extend(SlotVerify,superClass);function SlotVerify(){return SlotVerify.__super__.constructor.apply(this,arguments)}SlotVerify.prototype.enter=function(data){if(data.operator){return fsm.next(SlotStart,data)}else{return fsm.next(SlotErrorDisconnect,data)}};return SlotVerify}(State);SlotErrorDisconnect=function(superClass){extend(SlotErrorDisconnect,superClass);function SlotErrorDisconnect(){return SlotErrorDisconnect.__super__.constructor.apply(this,arguments)}SlotErrorDisconnect.prototype.enter=function(data){slot.disconnect();return fsm.event("slotDisconnect",data)};SlotErrorDisconnect.prototype.slotDisconnect=function(data){return fsm.next(SlotErrorHandle,data)};return SlotErrorDisconnect}(State);SlotErrorHandle=function(superClass){extend(SlotErrorHandle,superClass);function SlotErrorHandle(){return SlotErrorHandle.__super__.constructor.apply(this,arguments)}SlotErrorHandle.prototype.enter=function(data){_ullog("message="+(data!=null?data.message:void 0));if(data){if(data.message==="CUSTOMER_NOT_FOUND"){return fsm.next(ErrorMessage)}else if(data.message==="EXPIRED"){return fsm.next(OfflineMessage)}else if(data.message==="QUOTA_LIMIT_REACHED"){return fsm.next(OfflineMessage)}else if(data.message==="GROUP_OFFLINE"){return fsm.next(OfflineMessage)}else if(data.message==="NO_SLOT"){return fsm.next(OfflineMessage)}else{return fsm.next(OfflineMessage)}}else{return fsm.next(OfflineMessage)}};return SlotErrorHandle}(State);ChatUserQuit=function(superClass){extend(ChatUserQuit,superClass);function ChatUserQuit(){return ChatUserQuit.__super__.constructor.apply(this,arguments)}ChatUserQuit.prototype.enter=function(){slot.queue("emit","quit");session.setState("Offline");session.yieldConfig();tracking_event.trigger("chat_quit");session.resetChatDuration();return fsm.event("done")};ChatUserQuit.prototype.done=function(){return fsm.next(ChatUserQuitDisconnect)};return ChatUserQuit}(State);ChatUserQuitDisconnect=function(superClass){extend(ChatUserQuitDisconnect,superClass);function ChatUserQuitDisconnect(){return ChatUserQuitDisconnect.__super__.constructor.apply(this,arguments)}ChatUserQuitDisconnect.prototype.slotDisconnect=function(data){return fsm.next(CheckTranscriptForm)};return ChatUserQuitDisconnect}(SlotErrorDisconnect);CheckTranscriptForm=function(superClass){extend(CheckTranscriptForm,superClass);function CheckTranscriptForm(){return CheckTranscriptForm.__super__.constructor.apply(this,arguments)}CheckTranscriptForm.prototype.enter=function(){if(config.transcript_enabled&&session.hasClientOriginating()){return fsm.next(TranscriptForm)}else{return fsm.next(CheckPostChatFirst)}};return CheckTranscriptForm}(State);TranscriptForm=function(superClass){extend(TranscriptForm,superClass);function TranscriptForm(){return TranscriptForm.__super__.constructor.apply(this,arguments)}TranscriptForm.prototype.transitionIn=function(callback){return popup.showTranscriptForm(callback)};TranscriptForm.prototype.enter=function(){return tracking_event.trigger("transcript_show")};TranscriptForm.prototype.chatButton=function(){tracking_event.trigger("transcript_cancel");return popup.close(function(){return fsm.next(CheckPostChatFirst)})};TranscriptForm.prototype.directRequest=function(){tracking_event.trigger("transcript_cancel");return popup.close(function(){return fsm.next(CheckPostChatFirst)})};TranscriptForm.prototype.closeButton=function(){tracking_event.trigger("transcript_cancel");return popup.close(function(){return fsm.next(CheckPostChatFirst)})};TranscriptForm.prototype.submitButton=function(){tracking_event.trigger("transcript_submit");if(popup.validateTranscriptForm()){return fsm.next(TranscriptSend)}};return TranscriptForm}(State);TranscriptSend=function(superClass){extend(TranscriptSend,superClass);function TranscriptSend(){return TranscriptSend.__super__.constructor.apply(this,arguments)}TranscriptSend.prototype.transitionIn=function(callback){return popup.showProgressView(callback)};TranscriptSend.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout_disconnected);return slot.sendTranscript(function(){return fsm.event("sent")})};TranscriptSend.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};TranscriptSend.prototype.timerFired=function(){return fsm.next(CheckPostChatFirst)};TranscriptSend.prototype.sent=function(){return fsm.next(CheckPostChatFirst)};return TranscriptSend}(State);CheckPostChatFirst=function(superClass){extend(CheckPostChatFirst,superClass);function CheckPostChatFirst(){return CheckPostChatFirst.__super__.constructor.apply(this,arguments)}CheckPostChatFirst.prototype.enter=function(){if(config.rating_enabled&&session.hasClientOriginating()){return fsm.next(ChatRating)}else{return fsm.next(CheckPostChatSecond)}};return CheckPostChatFirst}(State);CheckPostChatSecond=function(superClass){extend(CheckPostChatSecond,superClass);function CheckPostChatSecond(){return CheckPostChatSecond.__super__.constructor.apply(this,arguments)}CheckPostChatSecond.prototype.enter=function(){if(config.feedback_enabled&&session.hasClientOriginating()){return fsm.next(ChatFeedback)}else{return fsm.next(CheckPostChatThird)}};return CheckPostChatSecond}(State);CheckPostChatThird=function(superClass){extend(CheckPostChatThird,superClass);function CheckPostChatThird(){return CheckPostChatThird.__super__.constructor.apply(this,arguments)}CheckPostChatThird.prototype.enter=function(){if(config.post_survey_enabled){return fsm.next(PostSurveyForm)}else{return fsm.next(CheckPostChatFourth)}};return CheckPostChatThird}(State);CheckPostChatFourth=function(superClass){extend(CheckPostChatFourth,superClass);function CheckPostChatFourth(){return CheckPostChatFourth.__super__.constructor.apply(this,arguments)}CheckPostChatFourth.prototype.enter=function(){if(facebook&&config.facebook_like_enabled){return fsm.next(FacebookLike)}else{return fsm.next(CheckPostChatFifth)}};return CheckPostChatFourth}(State);CheckPostChatFifth=function(superClass){extend(CheckPostChatFifth,superClass);function CheckPostChatFifth(){return CheckPostChatFifth.__super__.constructor.apply(this,arguments)}CheckPostChatFifth.prototype.enter=function(){if(twitter&&config.twitter_integration!=="disabled"){return fsm.next(TwitterTweet)}else{return fsm.next(CheckPostChatLast)}};return CheckPostChatFifth}(State);CheckPostChatLast=function(superClass){extend(CheckPostChatLast,superClass);function CheckPostChatLast(){return CheckPostChatLast.__super__.constructor.apply(this,arguments)}CheckPostChatLast.prototype.enter=function(){return fsm.next(ChatQuit)};return CheckPostChatLast}(State);ChatRating=function(superClass){extend(ChatRating,superClass);function ChatRating(){return ChatRating.__super__.constructor.apply(this,arguments)}ChatRating.prototype.transitionIn=function(callback){return popup.showRatingView(callback)};ChatRating.prototype.enter=function(){return tracking_event.trigger("rating_show")};ChatRating.prototype.closeButton=function(){tracking_event.trigger("rating_cancel");return fsm.next(CheckPostChatSecond)};ChatRating.prototype.directRequest=function(operator_id){
tracking_event.trigger("rating_cancel");return fsm.next(CheckPostChatSecond)};ChatRating.prototype.chatButton=function(){tracking_event.trigger("rating_cancel");return fsm.next(CheckPostChatSecond)};ChatRating.prototype.select=function(v){var r;tracking_event.trigger("rating_submit");r=new Rating;r.send(v);return fsm.next(CheckPostChatSecond)};return ChatRating}(State);ChatFeedback=function(superClass){extend(ChatFeedback,superClass);function ChatFeedback(){return ChatFeedback.__super__.constructor.apply(this,arguments)}ChatFeedback.prototype.transitionIn=function(callback){return popup.showFeedbackView(callback)};ChatFeedback.prototype.enter=function(){return tracking_event.trigger("feedback_show")};ChatFeedback.prototype.closeButton=function(){tracking_event.trigger("feedback_cancel");return fsm.next(CheckPostChatThird)};ChatFeedback.prototype.directRequest=function(operator_id){tracking_event.trigger("feedback_cancel");return fsm.next(CheckPostChatThird)};ChatFeedback.prototype.chatButton=function(){tracking_event.trigger("feedback_cancel");return fsm.next(CheckPostChatThird)};ChatFeedback.prototype.cancel=function(){tracking_event.trigger("feedback_cancel");return fsm.next(CheckPostChatThird)};ChatFeedback.prototype.submitButton=function(){return popup.validateFeedback()};ChatFeedback.prototype.done=function(){tracking_event.trigger("feedback_submit");return fsm.next(CheckPostChatThird)};return ChatFeedback}(State);PostSurveyForm=function(superClass){extend(PostSurveyForm,superClass);function PostSurveyForm(){return PostSurveyForm.__super__.constructor.apply(this,arguments)}PostSurveyForm.prototype.transitionIn=function(callback){return popup.showPostSurveyView(callback)};PostSurveyForm.prototype.enter=function(){return tracking_event.trigger("post_survey_show")};PostSurveyForm.prototype.closeButton=function(){tracking_event.trigger("post_survey_cancel");return fsm.next(CheckPostChatFourth)};PostSurveyForm.prototype.directRequest=function(operator_id){tracking_event.trigger("post_survey_cancel");return fsm.next(CheckPostChatFourth)};PostSurveyForm.prototype.chatButton=function(){tracking_event.trigger("post_survey_cancel");return fsm.next(CheckPostChatFourth)};PostSurveyForm.prototype.select=function(v){var s;tracking_event.trigger("post_survey_submit");s=new Survey;s.send(config["post_survey_option0"+v],v);return fsm.next(CheckPostChatFourth)};return PostSurveyForm}(State);FacebookLike=function(superClass){extend(FacebookLike,superClass);function FacebookLike(){return FacebookLike.__super__.constructor.apply(this,arguments)}FacebookLike.prototype.transitionIn=function(callback){return popup.showFacebookLikeView(callback)};FacebookLike.prototype.enter=function(){return tracking_event.trigger("facebook_like_show")};FacebookLike.prototype.closeButton=function(){tracking_event.trigger("facebook_like_cancel");return fsm.next(CheckPostChatFifth)};FacebookLike.prototype.directRequest=function(operator_id){tracking_event.trigger("facebook_like_cancel");return fsm.next(CheckPostChatFifth)};FacebookLike.prototype.chatButton=function(){tracking_event.trigger("facebook_like_cancel");return fsm.next(CheckPostChatFifth)};return FacebookLike}(State);TwitterTweet=function(superClass){extend(TwitterTweet,superClass);function TwitterTweet(){return TwitterTweet.__super__.constructor.apply(this,arguments)}TwitterTweet.prototype.transitionIn=function(callback){return popup.showTwitterTweetView(callback)};TwitterTweet.prototype.enter=function(){return tracking_event.trigger("twitter_tweet_show")};TwitterTweet.prototype.closeButton=function(){tracking_event.trigger("twitter_tweet_cancel");return fsm.next(CheckPostChatLast)};TwitterTweet.prototype.directRequest=function(operator_id){tracking_event.trigger("twitter_tweet_cancel");return fsm.next(CheckPostChatLast)};TwitterTweet.prototype.chatButton=function(){tracking_event.trigger("twitter_tweet_cancel");return fsm.next(CheckPostChatLast)};return TwitterTweet}(State);ChatQuit=function(superClass){extend(ChatQuit,superClass);function ChatQuit(){return ChatQuit.__super__.constructor.apply(this,arguments)}ChatQuit.prototype.transitionIn=function(callback){return popup.close(callback)};ChatQuit.prototype.enter=function(){return fsm.next(Offline)};return ChatQuit}(State);ChatWaitQuit=function(superClass){extend(ChatWaitQuit,superClass);function ChatWaitQuit(){return ChatWaitQuit.__super__.constructor.apply(this,arguments)}ChatWaitQuit.prototype.transitionIn=function(callback){return popup.close(callback)};ChatWaitQuit.prototype.slotCreated=function(data){return fsm.next(ChatSendQuit)};return ChatWaitQuit}(State);ChatSendQuit=function(superClass){extend(ChatSendQuit,superClass);function ChatSendQuit(){return ChatSendQuit.__super__.constructor.apply(this,arguments)}ChatSendQuit.prototype.done=function(){return fsm.next(Offline)};return ChatSendQuit}(ChatUserQuit);ChatQuitWaitDisconnect=function(superClass){extend(ChatQuitWaitDisconnect,superClass);function ChatQuitWaitDisconnect(){return ChatQuitWaitDisconnect.__super__.constructor.apply(this,arguments)}ChatQuitWaitDisconnect.prototype.slotDisconnect=function(data){return fsm.next(ChatQuitWait,data)};return ChatQuitWaitDisconnect}(SlotErrorDisconnect);ChatQuitWait=function(superClass){extend(ChatQuitWait,superClass);function ChatQuitWait(){return ChatQuitWait.__super__.constructor.apply(this,arguments)}ChatQuitWait.prototype.transitionIn=function(callback){return popup.show(callback)};ChatQuitWait.prototype.enter=function(){fsm.reset();session.setState("Offline");session.yieldConfig();tracking_event.trigger("chat_quit");session.resetChatDuration();return popup.showInfoMessage(config.quit_message.replace("{{name}}",session.get("operator_display_name")))};ChatQuitWait.prototype.closeButton=function(){return fsm.next(CheckTranscriptForm)};ChatQuitWait.prototype.minimizeButton=function(){return fsm.next(CheckTranscriptForm)};ChatQuitWait.prototype.directRequest=function(operator_id){return fsm.next(CheckTranscriptForm)};ChatQuitWait.prototype.chatButton=function(){return fsm.next(CheckTranscriptForm)};ChatQuitWait.prototype.inputEnter=function(data){tracking_event.trigger("chat_requested");fsm.queue("inputEnter",data);fsm.queue("slotRequest");return fsm.next(SocketConnect)};return ChatQuitWait}(State);ChatMinimizedQuitWaitDisconnect=function(superClass){extend(ChatMinimizedQuitWaitDisconnect,superClass);function ChatMinimizedQuitWaitDisconnect(){return ChatMinimizedQuitWaitDisconnect.__super__.constructor.apply(this,arguments)}ChatMinimizedQuitWaitDisconnect.prototype.slotDisconnect=function(data){return fsm.next(ChatMinimizedQuitWait,data)};return ChatMinimizedQuitWaitDisconnect}(SlotErrorDisconnect);ChatMinimizedQuitWait=function(superClass){extend(ChatMinimizedQuitWait,superClass);function ChatMinimizedQuitWait(){return ChatMinimizedQuitWait.__super__.constructor.apply(this,arguments)}ChatMinimizedQuitWait.prototype.enter=function(){session.setState("Offline");session.yieldConfig();tracking_event.trigger("chat_quit");return session.resetChatDuration()};ChatMinimizedQuitWait.prototype.chatButton=function(){return fsm.next(ChatQuitWait)};ChatMinimizedQuitWait.prototype.directRequest=function(operator_id){return fsm.next(ChatQuitWait)};return ChatMinimizedQuitWait}(State);SlotStart=function(superClass){extend(SlotStart,superClass);function SlotStart(){return SlotStart.__super__.constructor.apply(this,arguments)}SlotStart.prototype.enter=function(data){session.set("id",data.session);session.setIfEmpty("uuid",data.uuid);session.set("meta_id",data.meta_id);session.set("was_proactive",false);session.resetStats();session.set("operator_name",data.operator.name);session.set("operator_display_name",data.operator.display_name);session.set("operator_id",data.operator.id);session.setOperatorBinding(data.operator.id,data.operator.operator_group_id);tracking.startSlot();return popup.displaySlot(data.operator.display_name,data.operator.url_image,config.default_message,function(){tracking_event.trigger("chat_connected");return fsm.next(Chat)})};return SlotStart}(State);Chat=function(superClass){extend(Chat,superClass);function Chat(){return Chat.__super__.constructor.apply(this,arguments)}Chat.prototype.enter=function(){if(config.geo_type==="browser"){session.getLocation()}goal.check();slot.queue("emit","chat");fsm.poll();button.clear();return this.timer_persist=setInterval(function(_this){return function(){return fsm.event("persist")}}(this),State.timeout_persist)};Chat.prototype.leave=function(callback){clearInterval(this.timer_persist);return callback()};Chat.prototype.persist=function(){session.setState("Chat",State.timeout_offsite);return session.persistConfig()};Chat.prototype.slotRequest=function(){};Chat.prototype.transitionIn=function(callback){button.fadeOutEyecatcher();return popup.showChatView(callback)};Chat.prototype.inputEnter=function(){var text;text=popup.sendMessage();return fsm.event("sendMessage",text)};Chat.prototype.chatButton=function(){return fsm.next(ChatMinimized)};Chat.prototype.minimizeButton=function(){return fsm.next(ChatMinimized)};Chat.prototype.directRequest=function(operator_id){return fsm.next(ChatMinimized)};Chat.prototype.closeButton=function(){return fsm.next(ChatUserQuit)};Chat.prototype.sendMessage=function(text){if(!(text!=null?text.length:void 0)){return}if(!session.hasClientOriginating()){session.startChatDuration();tracking_event.trigger("chat_started");if(session.get("was_proactive")){tracking_event.trigger("chat_started_proactive")}}session.incClientOriginating();tracking.sendMessage();tracking_event.trigger("message_operator_terminating");slot.queue("emit","message",text);if(!(popup.isActive()&&config.audio_only_inactive)){return sound.play("message_sent")}};Chat.prototype.goalReached=function(){return slot.queue("emit","update_info",session.packet())};Chat.prototype.locationchange=function(data){return slot.queue("emit","update_info",session.packet())};Chat.prototype.hashchange=function(data){return slot.queue("emit","update_info",session.packet())};Chat.prototype.pushstate=function(data){return slot.queue("emit","update_info",session.packet())};Chat.prototype.updateAPI=function(){session.checkUserFromAPI();return slot.queue("emit","update_info_api",session.packet())};Chat.prototype.livePreview=function(input_value){return slot.queue("emit","live_preview",input_value)};Chat.prototype.receiveMessage=function(data){if(!session.hasClientTerminating()){tracking_event.trigger("message_client_terminating_first")}session.incClientTerminating();tracking.receiveMessage();tracking_event.trigger("message_client_terminating");if(!(popup.isActive()&&config.audio_only_inactive)){sound.play("message_received")}return popup.receiveMessage(data.from,data.body)};Chat.prototype.stateComposing=function(){return slot.queue("emit","composing")};Chat.prototype.statePaused=function(){return slot.queue("emit","paused")};Chat.prototype.stateActive=function(){return slot.queue("emit","active")};Chat.prototype.stateInactive=function(){return slot.queue("emit","inactive")};Chat.prototype.receiveComposing=function(data){if(config.emit_chat_state){return popup.stateComposing(data.from)}};Chat.prototype.receivePaused=function(data){if(config.emit_chat_state){return popup.statePaused(data.from)}};Chat.prototype.receiveBlock=function(){return fsm.next(ChatBlocked)};Chat.prototype.receiveInactive=function(data){return fsm.next(ChatInactive)};Chat.prototype.receiveQuit=function(data){return fsm.next(ChatQuitWaitDisconnect)};Chat.prototype.receiveSwitch=function(data){return fsm.next(SlotSwitchDisconnect)};Chat.prototype.receiveName=function(data){return session.set("name",data.name)};Chat.prototype.receiveEmail=function(data){return session.set("email",data.email)};Chat.prototype.receiveAdditional=function(data){return session.set("additional0"+data.num,data.value)};Chat.prototype.receiveReplaceText=function(data){return popup.replaceText(data)};Chat.prototype.receiveScreenshot=function(callback){return popup.takeScreenshot(callback)};Chat.prototype.screenshotTaken=function(data){return popup.sendScreenshot(data.callback)};Chat.prototype.screenshotSent=function(data){return data.callback(false,data.url)};Chat.prototype.screenshotError=function(data){return data.callback(true)};Chat.prototype.receivePush=function(data){var push;push=new Push;return push.send(data.url,data.callback)};Chat.prototype.receiveDownload=function(data){return popup.receiveDownload(data.from,data.url,data.name)};Chat.prototype.receiveOperatorDisconnect=function(){return fsm.next(ChatOperatorDisconnect)};Chat.prototype.receiveHibernate=function(){return fsm.next(ServerHibernate)};Chat.prototype.receiveSlot=function(data){session.set("operator_name",data.operator.name);session.set("operator_display_name",data.operator.display_name);session.set("operator_id",data.operator.id);session.setOperatorBinding(data.operator.id,data.operator.operator_group_id);return popup.displaySlot(data.operator.display_name,data.operator.url_image,config.default_message,function(){})};Chat.prototype.receiveForward=function(data){session.set("operator_name",data.operator.name);session.set("operator_display_name",data.operator.display_name);session.set("operator_id",data.operator.id);session.setOperatorBinding(data.operator.id,data.operator.operator_group_id);return popup.displaySlot(data.operator.display_name,data.operator.url_image,config.forward_message,function(){})};Chat.prototype.receiveOffline=function(data){slot.disconnect();return fsm.next(ChatOffline)};Chat.prototype.disconnect=function(){return fsm.next(ChatReconnectingIntermediate)};return Chat}(State);ChatMinimized=function(superClass){extend(ChatMinimized,superClass);function ChatMinimized(){return ChatMinimized.__super__.constructor.apply(this,arguments)}ChatMinimized.prototype.enter=function(){tracking_event.trigger("chat_window_minimzed");slot.queue("emit","minize");return this.timer_persists=setInterval(function(_this){return function(){return fsm.event("persist")}}(this),State.timeout_persist)};ChatMinimized.prototype.leave=function(callback){clearInterval(this.timer_persist);return callback()};ChatMinimized.prototype.persist=function(){session.setState("ChatMinimized",State.timeout_offsite);return session.persistConfig()};ChatMinimized.prototype.transitionIn=function(callback){return popup.hide(callback)};ChatMinimized.prototype.inputEnter=function(){};ChatMinimized.prototype.chatButton=function(){tracking_event.trigger("chat_window_maximized");return fsm.next(Chat)};ChatMinimized.prototype.directRequest=function(operator_id){tracking_event.trigger("chat_window_maximized");return fsm.next(Chat)};ChatMinimized.prototype.receiveMessage=function(data){if(!session.hasClientTerminating()){tracking_event.trigger("message_client_terminating_first");if(session.get("was_proactive")){tracking_event.trigger("message_client_terminating_first_proactive")}}session.incClientTerminating();tracking.receiveMessage();tracking_event.trigger("message_client_terminating");if(!(popup.isActive()&&config.audio_only_inactive)){sound.play("message_received")}popup.receiveMessage(data.from,data.body);return button.shake()};ChatMinimized.prototype.receiveQuit=function(data){return fsm.next(ChatMinimizedQuitWaitDisconnect)};return ChatMinimized}(Chat);ChatInactive=function(superClass){extend(ChatInactive,superClass);function ChatInactive(){return ChatInactive.__super__.constructor.apply(this,arguments)}ChatInactive.prototype.enter=function(){return fsm.next(OfflineMessage)};return ChatInactive}(State);ChatBlocked=function(superClass){extend(ChatBlocked,superClass);function ChatBlocked(){return ChatBlocked.__super__.constructor.apply(this,arguments)}ChatBlocked.prototype.transitionIn=function(callback){return popup.close(function(){return popup.hideTab(callback)})};ChatBlocked.prototype.enter=function(){return session.set("blocked",1)};return ChatBlocked}(State);ChatReconnectingIntermediate=function(superClass){extend(ChatReconnectingIntermediate,superClass);function ChatReconnectingIntermediate(){return ChatReconnectingIntermediate.__super__.constructor.apply(this,arguments)}ChatReconnectingIntermediate.prototype.reconnect=function(){return fsm.next(Chat)};ChatReconnectingIntermediate.prototype.connect=function(){return fsm.next(Chat)};ChatReconnectingIntermediate.prototype.reconnectFailed=function(){return fsm.next(SlotErrorDisconnect)};ChatReconnectingIntermediate.prototype.timerFired=function(){return fsm.next(ChatReconnecting)};ChatReconnectingIntermediate.prototype.enter=function(){return this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout)};ChatReconnectingIntermediate.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return ChatReconnectingIntermediate}(State);ChatReconnecting=function(superClass){extend(ChatReconnecting,superClass);function ChatReconnecting(){return ChatReconnecting.__super__.constructor.apply(this,arguments)}ChatReconnecting.prototype.transitionIn=function(callback){return popup.showProgressView(callback)};ChatReconnecting.prototype.reconnect=function(){return fsm.next(Chat)};ChatReconnecting.prototype.connect=function(){return fsm.next(Chat)};ChatReconnecting.prototype.reconnectFailed=function(){return fsm.next(SlotErrorDisconnect)};ChatReconnecting.prototype.timerFired=function(){return fsm.next(SlotErrorDisconnect)};ChatReconnecting.prototype.enter=function(){return this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout_disconnected)};ChatReconnecting.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return ChatReconnecting}(State);SlotSwitchDisconnect=function(superClass){extend(SlotSwitchDisconnect,superClass);function SlotSwitchDisconnect(){return SlotSwitchDisconnect.__super__.constructor.apply(this,arguments)}SlotSwitchDisconnect.prototype.slotDisconnect=function(data){return fsm.next(SlotSwitch,data)};return SlotSwitchDisconnect}(SlotErrorDisconnect);SlotSwitch=function(superClass){extend(SlotSwitch,superClass);function SlotSwitch(){return SlotSwitch.__super__.constructor.apply(this,arguments)}SlotSwitch.prototype.transitionIn=function(callback){return popup.showTransfer(callback)};SlotSwitch.prototype.transitionOut=function(callback){return popup.close(callback)};SlotSwitch.prototype.chatButton=function(){return fsm.next(SlotSwitchIdle)};SlotSwitch.prototype.closeButton=function(){return fsm.next(SlotSwitchIdle)};SlotSwitch.prototype.minimizeButton=function(){return fsm.next(SlotSwitchIdle)};return SlotSwitch}(State);SlotSwitchIdle=function(superClass){extend(SlotSwitchIdle,superClass);function SlotSwitchIdle(){return SlotSwitchIdle.__super__.constructor.apply(this,arguments)}SlotSwitchIdle.prototype.chatButton=function(){return fsm.next(SwitchSocketConnect)};SlotSwitchIdle.prototype.directRequest=function(operator_id){return fsm.next(SwitchSocketConnect)};return SlotSwitchIdle}(State);ChatReopen=function(superClass){extend(ChatReopen,superClass);function ChatReopen(){return ChatReopen.__super__.constructor.apply(this,arguments)}ChatReopen.prototype.enter=function(data){fsm.event("receiveMessage",data);return fsm.next(Chat)};return ChatReopen}(Chat);ServerHibernate=function(superClass){extend(ServerHibernate,superClass);function ServerHibernate(){return ServerHibernate.__super__.constructor.apply(this,arguments)}ServerHibernate.prototype.transitionIn=function(callback){return popup.showProgressView(callback)};ServerHibernate.prototype.connect=function(){return fsm.next(ServerHibernateWakeup)};ServerHibernate.prototype.reconnectFailed=function(){return fsm.next(ChatOffline)};ServerHibernate.prototype.timerFired=function(){return fsm.next(ChatOffline)};ServerHibernate.prototype.enter=function(){return this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout_hibernate)};ServerHibernate.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return ServerHibernate}(State);ServerHibernateWakeup=function(superClass){extend(ServerHibernateWakeup,superClass);function ServerHibernateWakeup(){return ServerHibernateWakeup.__super__.constructor.apply(this,arguments)}ServerHibernateWakeup.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout_hibernate);return slot.wakeup()};ServerHibernateWakeup.prototype.wakeupDone=function(data){return fsm.next(ServerHibernateWakeupSlotVerify,data)};ServerHibernateWakeup.prototype.timerFired=function(){return fsm.next(ChatOffline)};ServerHibernateWakeup.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return ServerHibernateWakeup}(State);ServerHibernateWakeupSlotVerify=function(superClass){extend(ServerHibernateWakeupSlotVerify,superClass);function ServerHibernateWakeupSlotVerify(){return ServerHibernateWakeupSlotVerify.__super__.constructor.apply(this,arguments)}ServerHibernateWakeupSlotVerify.prototype.enter=function(data){if(data.operator){return fsm.next(Chat)}else{return fsm.next(ChatOffline)}};return ServerHibernateWakeupSlotVerify}(State);ChatOperatorDisconnect=function(superClass){extend(ChatOperatorDisconnect,superClass);function ChatOperatorDisconnect(){return ChatOperatorDisconnect.__super__.constructor.apply(this,arguments)}ChatOperatorDisconnect.prototype.transitionIn=function(callback){return popup.showProgressView(callback)};ChatOperatorDisconnect.prototype.receiveOperatorReconnect=function(){return fsm.next(Chat)};ChatOperatorDisconnect.prototype.receiveOffline=function(data){slot.disconnect();return fsm.next(ChatOffline)};ChatOperatorDisconnect.prototype.receiveSlot=function(data){session.set("operator_name",data.operator.name);session.set("operator_display_name",data.operator.display_name);session.set("operator_id",data.operator.id);session.setOperatorBinding(data.operator.id,data.operator.operator_group_id);return popup.displaySlot(data.operator.display_name,data.operator.url_image,config.default_message,function(){return fsm.next(Chat)})};ChatOperatorDisconnect.prototype.receiveForward=function(data){session.set("operator_name",data.operator.name);session.set("operator_display_name",data.operator.display_name);session.set("operator_id",data.operator.id);session.setOperatorBinding(data.operator.id,data.operator.operator_group_id);return popup.displaySlot(data.operator.display_name,data.operator.url_image,config.forward_message,function(){return fsm.next(Chat)})};ChatOperatorDisconnect.prototype.timerFired=function(){slot.disconnect();return fsm.next(ChatOffline)};ChatOperatorDisconnect.prototype.enter=function(){return this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout_disconnected)};ChatOperatorDisconnect.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return ChatOperatorDisconnect}(State);ChatOffline=function(superClass){extend(ChatOffline,superClass);function ChatOffline(){return ChatOffline.__super__.constructor.apply(this,arguments)}ChatOffline.prototype.enter=function(){return fsm.next(OfflineMessage)};return ChatOffline}(State);RestartSlot=function(superClass){extend(RestartSlot,superClass);function RestartSlot(){return RestartSlot.__super__.constructor.apply(this,arguments)}RestartSlot.prototype.enter=function(){return fsm.next(RestartFacebookLoader)};return RestartSlot}(State);RestartFacebookLoader=function(superClass){extend(RestartFacebookLoader,superClass);function RestartFacebookLoader(){return RestartFacebookLoader.__super__.constructor.apply(this,arguments)}RestartFacebookLoader.prototype.done=function(){_ullog("RestartFacebookLoader integration="+config.facebook_integration+" facebook="+facebook);return fsm.next(RestartTwitterLoader)};return RestartFacebookLoader}(FacebookLoader);RestartTwitterLoader=function(superClass){extend(RestartTwitterLoader,superClass);function RestartTwitterLoader(){return RestartTwitterLoader.__super__.constructor.apply(this,arguments)}RestartTwitterLoader.prototype.done=function(){_ullog("RestartTwitterLoader integration="+config.twitter_integration+" twitter="+twitter);return fsm.next(RestartEventSetup)};return RestartTwitterLoader}(TwitterLoader);RestartEventSetup=function(superClass){extend(RestartEventSetup,superClass);function RestartEventSetup(){return RestartEventSetup.__super__.constructor.apply(this,arguments)}RestartEventSetup.prototype.done=function(data){return fsm.next(RestartSocketConnect,data)};return RestartEventSetup}(EventSetup);RestartSocketConnect=function(superClass){extend(RestartSocketConnect,superClass);function RestartSocketConnect(){return RestartSocketConnect.__super__.constructor.apply(this,arguments)}RestartSocketConnect.prototype.connect=function(){return fsm.next(RestartSlotCreate)};RestartSocketConnect.prototype.error=function(){return fsm.next(OfflineMessage)};RestartSocketConnect.prototype.connectFailed=function(){return fsm.next(OfflineMessage)};RestartSocketConnect.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout_connect);return slot.connect()};RestartSocketConnect.prototype.timerFired=function(){return fsm.next(OfflineMessage)};RestartSocketConnect.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return RestartSocketConnect}(State);RestartSlotCreate=function(superClass){extend(RestartSlotCreate,superClass);function RestartSlotCreate(){return RestartSlotCreate.__super__.constructor.apply(this,arguments)}RestartSlotCreate.prototype.slotReconnceted=function(data){return fsm.next(RestartSlotVerify,data)};RestartSlotCreate.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout_connect);return slot.reconnect()};RestartSlotCreate.prototype.timerFired=function(){slot.disconnect();return fsm.next(OfflineMessage)};RestartSlotCreate.prototype.leave=function(callback){clearTimeout(this.timer);return callback()};return RestartSlotCreate}(State);RestartSlotVerify=function(superClass){extend(RestartSlotVerify,superClass);function RestartSlotVerify(){return RestartSlotVerify.__super__.constructor.apply(this,arguments)}RestartSlotVerify.prototype.enter=function(data){if(data.status==="switch"){return fsm.next(RestartSlotPlayback,data)}else if(data.status==="noswitch"){slot.disconnect();return fsm.next(NoSwitch)}else{return fsm.next(Offline)}};return RestartSlotVerify}(State);RestartSlotPlayback=function(superClass){extend(RestartSlotPlayback,superClass);function RestartSlotPlayback(){return RestartSlotPlayback.__super__.constructor.apply(this,arguments)}RestartSlotPlayback.prototype.slotPlayback=function(data){return fsm.next(RestartSlotStart,data)};RestartSlotPlayback.prototype.enter=function(data){session.set("operator_name",data.operator.name);session.set("operator_display_name",data.operator.display_name);session.set("operator_id",data.operator.id);session.setOperatorBinding(data.operator.id,data.operator.operator_group_id);return slot.playback()};return RestartSlotPlayback}(State);RestartSlotStart=function(superClass){extend(RestartSlotStart,superClass);function RestartSlotStart(){return RestartSlotStart.__super__.constructor.apply(this,arguments)}RestartSlotStart.prototype.enter=function(data){tracking_event.trigger("chat_reconnect");popup.playbackSlot(data);if(session.persisted_state==="ChatMinimized"){return fsm.next(ChatMinimized)}else{return fsm.next(Chat)}};return RestartSlotStart}(State);SwitchSocketConnect=function(superClass){extend(SwitchSocketConnect,superClass);function SwitchSocketConnect(){return SwitchSocketConnect.__super__.constructor.apply(this,arguments)}SwitchSocketConnect.prototype.connect=function(){return fsm.next(SwitchSlotCreate)};return SwitchSocketConnect}(RestartSocketConnect);SwitchSlotCreate=function(superClass){extend(SwitchSlotCreate,superClass);function SwitchSlotCreate(){return SwitchSlotCreate.__super__.constructor.apply(this,arguments)}SwitchSlotCreate.prototype.slotSwitched=function(data){return fsm.next(RestartSlotVerify,data)};SwitchSlotCreate.prototype.enter=function(){this.timer=setTimeout(function(){return fsm.event("timerFired")},State.timeout_connect);return slot["switch"]()};return SwitchSlotCreate}(RestartSlotCreate);Push=function(){function Push(){}Push.prototype.send=function(url,callback){var up;_ullog("Push::send  url="+url);up=new UrlParser(url);if(up.isOffsite()){if(jq.browser.msie||isIE11()){return callback({action:"not_supported"})}if(up.isInsecure()){_ullog("Push::send offsite failed insecure url="+up.url());return callback({action:"insecure"})}_ullog("Push::send offsite url="+up.url());return jq.ajax({url:protocol()+"api.userlike.com/api/client/iframe/?url="+encodeURIComponent(up.url()),dataType:"jsonp",timeout:3e3,success:function(_this){return function(resp){if(resp.status!=="200"||resp.xframe){return callback({action:"xframe"})}else{popup.injectIframe(up.url_inherit());return callback({action:"open"})}}}(this),error:function(_this){return function(resp){_ullog("Push::send offsite failed ajax url="+up.url());return callback({action:"failed"})}}(this)})}else{_ullog("Push::send onsite url="+up.original());if(up.isSame()){_ullog("Push::send onsite failed same url="+up.original());return callback({action:"same"})}return jq.get(up.original()).done(function(){_ullog("Push::send onsite navigate url="+up.original());window.location=up.original();return callback({action:"navigate"})}).fail(function(){_ullog("Push::send onsite failed url="+up.original());return callback({action:"failed"})})}};return Push}();UrlParser=function(){function UrlParser(source1,force_absolute){this.source=source1;this.force_absolute=force_absolute!=null?force_absolute:false;if(this.isAbsolute()){this.addHttp()}this.loc=window.location;this.e=document.createElement("a");this.e.href=this.source}UrlParser.prototype.original=function(){return this.source};UrlParser.prototype.url=function(){e=document.createElement("a");e.href=this.source;return e.href};UrlParser.prototype.url_inherit=function(){e=document.createElement("a");e.href=this.source;e.protocol=this.loc.protocol;return e.href};UrlParser.prototype.url_http=function(){e=document.createElement("a");e.href=this.source;e.protocol="http:";return e.href};UrlParser.prototype.url_https=function(){e=document.createElement("a");e.href=this.source;e.protocol="https:";return e.href};UrlParser.prototype.isSame=function(){return this.loc.href===this.e.href};UrlParser.prototype.isInsecure=function(){return this.e.protocol==="http:"&&this.loc.protocol==="https:"};UrlParser.prototype.isOffsite=function(){return this.loc.hostname!==this.e.hostname&&this.e.hostname.length>0};UrlParser.prototype.isAbsolute=function(){var ref1;return this.force_absolute||((ref1=this.source.match(/(www\.|https?:\/\/)/))!=null?ref1.length:void 0)>0};UrlParser.prototype.addHttp=function(){if(!/^(?:f|ht)tps?\:\/\//.test(this.source)){return this.source="http://"+this.source}};return UrlParser}();Base64=function(){function Base64(){}Base64.key="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";Base64.encode=function(input){var chr1,chr2,chr3,enc1,enc2,enc3,enc4,i,output;output="";chr1=void 0;chr2=void 0;chr3=void 0;enc1=void 0;enc2=void 0;enc3=void 0;enc4=void 0;i=0;input=Base64._utf8_encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=(chr1&3)<<4|chr2>>4;enc3=(chr2&15)<<2|chr3>>6;enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else{if(isNaN(chr3)){enc4=64}}output=output+Base64.key.charAt(enc1)+Base64.key.charAt(enc2)+Base64.key.charAt(enc3)+Base64.key.charAt(enc4)}return output};Base64.decode=function(input){var chr1,chr2,chr3,enc1,enc2,enc3,enc4,i,output;output="";i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=Base64.key.indexOf(input.charAt(i++));enc2=Base64.key.indexOf(input.charAt(i++));enc3=Base64.key.indexOf(input.charAt(i++));enc4=Base64.key.indexOf(input.charAt(i++));chr1=enc1<<2|enc2>>4;chr2=(enc2&15)<<4|enc3>>2;
chr3=(enc3&3)<<6|enc4;output=output+String.fromCharCode(chr1);if(enc3!==64){output=output+String.fromCharCode(chr2)}if(enc4!==64){output=output+String.fromCharCode(chr3)}}output=Base64._utf8_decode(output);return output};Base64._utf8_encode=function(string){var c,n,utftext;string=string.replace(/\r\n/g,"\n");utftext="";n=0;while(n<string.length){c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else if(c>127&&c<2048){utftext+=String.fromCharCode(c>>6|192);utftext+=String.fromCharCode(c&63|128)}else{utftext+=String.fromCharCode(c>>12|224);utftext+=String.fromCharCode(c>>6&63|128);utftext+=String.fromCharCode(c&63|128)}n++}return utftext};Base64._utf8_decode=function(utftext){var c,c1,c2,c3,i,string;string="";i=0;c=c1=c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++}else if(c>191&&c<224){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode((c&31)<<6|c2&63);i+=2}else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode((c&15)<<12|(c2&63)<<6|c3&63);i+=3}}return string};return Base64}();hashCode=function(s){var char,hash,i;hash=0;if(s.length===0){return hash}i=0;while(i<s.length){char=s.charCodeAt(i);hash=(hash<<5)-hash+char;hash=hash&hash;i++}return hash};unpack=function(input){var output;output=Base64.decode(input);if(this.JSON!=null){return JSON.parse(output)}else{return eval("("+output+")")}};capitalize=function(string){return string.charAt(0).toUpperCase()+string.slice(1)};insertStringAtIndex=function(source,index,string){var output;output=source;if(index>0){output=source.substring(0,index)+string+source.substring(index,source.length)}else{output=string+source}return output};getMousePosition=function(e){var posx,posy;posx=0;posy=0;if(!e){e=window.event}if(e.pageX||e.pageY){posx=e.pageX;posy=e.pageY}else if(e.clientX||e.clientY){posx=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;posy=e.clientY+document.body.scrollTop+document.documentElement.scrollTop}return{x:posx,y:posy}};overlapDiv=function(){var comparePositions,getPositions;getPositions=function(elem){var $el,height,pos,width;pos=void 0;width=void 0;height=void 0;$el=jq(elem);pos=$el.offset();width=$el.width();height=$el.height();return[[pos.left,pos.left+width],[pos.top,pos.top+height]]};comparePositions=function(p1,p2){var r1,r2;r1=void 0;r2=void 0;r1=p1[0]<p2[0]?p1:p2;r2=p1[0]<p2[0]?p2:p1;return r1[1]>r2[0]||r1[0]===r2[0]};return function(a,b){var pos1,pos2;pos1=getPositions(a);pos2=getPositions(b);return comparePositions(pos1[0],pos2[0])&&comparePositions(pos1[1],pos2[1])}}();escapeRegExp=function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")};isElementInViewport=function(el){var rect;try{el=el[0];rect=el.getBoundingClientRect();return rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth)}catch(_error){e=_error;return true}};rgb=function(c){var d;try{d=/rgba\( *(\d+)[^,]*, *(\d+)[^,]*, *(\d+)[^,]*,.*\)/.exec(c);return"rgb("+d[1]+","+d[2]+","+d[3]+")"}catch(_error){e=_error;_ullog("rgb: parse error",e);return"rgb(0,174,239)"}};serialize=function(obj){var p,str;str=[];for(p in obj){if(obj.hasOwnProperty(p)&&obj[p]){str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]))}}return str.join("&")};regex_url=/(?:\s|^)((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)(?!\S)/gi;regex_url_full=new RegExp("(?:\\s|^)"+"(?:(?:https?|ftps?)://)"+"(?:\\S+(?::\\S*)?@)?"+"(?:"+"(?!(?:10|127)(?:\\.\\d{1,3}){3})"+"(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})"+"(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})"+"(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])"+"(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}"+"(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))"+"|"+"(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)"+"(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+"(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))"+")"+"(?::\\d{2,5})?"+"(?:/\\S*)?"+"(?!\\S)","i");simple_tlds=["com","org","edu","gov","uk","net","ca","de","jp","fr","au","us","ru","ch","it","nl","se","no","es","info","biz","eu","cz"].join("|");regex_url_simple=new RegExp("(?:\\s|^)"+"(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)"+"(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+("(?:\\.(?:"+simple_tlds+"))")+"(?::\\d{2,5})?"+"(?:/\\S*)?"+"(?!\\S)","i");regex_email=/(?:\s|^)(([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,})+)(?!\S)/gi;isIE11=function(){var re,rv;if(navigator.appName==="Netscape"){re=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");if(re.exec(navigator.userAgent)!==null){rv=parseInt(parseFloat(RegExp.$1));return rv===11}}return false};Screenshot=function(){var constructor;function Screenshot(){}constructor=function(){init_screenshot();return this.screentshot=null};Screenshot.prototype.take=function(callback){if(jq.browser.msie&&parseInt(jq.browser.version)<9){return callback(true)}return loadScripts({html2canvas:"userlike-cdn-client.s3-eu-west-1.amazonaws.com/html2canvas.0.4.1.min.js"},function(_this){return function(){try{return html2canvas([document.body],{logging:document.cookie.indexOf("_uslk_debug=1")>-1,proxy:protocol()+"www.userlike.com/api/proxy/image/",onrendered:function(canvas){_this.screentshot=canvas.toDataURL("image/png");return callback(false)}})}catch(_error){e=_error;_ullog("Screenshot::take error=%o",e);return callback(true)}}}(this))};Screenshot.prototype.crossDomainPost=function(url,args,callback){return jq.ajax({url:url,type:"POST",crossDomain:true,data:JSON.stringify(args),dataType:"json",success:function(response){return callback(false,response)},error:function(xhr,status){return callback(true)}})};Screenshot.prototype.attachToOfflineMessage=function(id,callback){return this.crossDomainPost(protocol()+"api.userlike.com/api/client/message/offline_message/screenshot/",{id:id,customer_id:config.customer_id,screenshot:this.screentshot},function(err,resp){return callback(err,resp!=null?resp.url:void 0)})};Screenshot.prototype.sendToOperator=function(id,callback){return this.crossDomainPost(protocol()+"api.userlike.com/api/client/message/chat_meta/screenshot/",{id:id,customer_id:config.customer_id,screenshot:this.screentshot},function(err,resp){return callback(err,resp!=null?resp.url:void 0)})};return Screenshot}();SoundFactory=function(){function SoundFactory(){}SoundFactory.prototype.get=function(){if(config.audio_message_received||config.audio_message_sent){return new Sound}else{return new SoundDummy}};return SoundFactory}();SoundDummy=function(){function SoundDummy(){}SoundDummy.prototype.play=function(){};SoundDummy.prototype.load=function(){};return SoundDummy}();Sound=function(){function Sound(){}Sound.prototype.load=function(){this.audio={message_received:document.createElement("audio"),message_sent:document.createElement("audio")};try{this.audio.message_received.setAttribute("src","//userlike-cdn-client.s3-eu-west-1.amazonaws.com/message_received.mp3");return this.audio.message_sent.setAttribute("src","//userlike-cdn-client.s3-eu-west-1.amazonaws.com/message_sent.mp3")}catch(_error){e=_error;return _ullog("Sound::load raised an exception ",e)}};Sound.prototype.play=function(name){try{if(config["audio_"+name]){return this.audio[name].play()}}catch(_error){e=_error;return _ullog("Sound::play raised an exception ",e)}};return Sound}();(function(context){var Userlikecon,abbreviateNumber,browser,canvas,currentFavicon,drawBubble,drawFavicon,faviconImage,getCanvas,getCurrentFavicon,getFaviconTag,options,originalFavicon,originalTitle,r,refreshFavicon,removeFaviconTag,round,setFaviconTag,size,ua,updateTitle;Userlikecon={};currentFavicon=null;originalFavicon=null;originalTitle=document.title;faviconImage=null;canvas=null;r=window.devicePixelRatio||1;size=16*r;options={width:7,height:9,font:10*r+"px arial",colour:"#ffffff",background:"#F00",fallback:true,crossOrigin:true,abbreviate:true};ua=function(){var agent;agent=navigator.userAgent.toLowerCase();return function(browser){return agent.indexOf(browser)!==-1}}();browser={ie:ua("msie")||ua("trident/7.0"),chrome:ua("chrome"),webkit:ua("chrome")||ua("safari"),safari:ua("safari")&&!ua("chrome"),mozilla:ua("mozilla")&&!ua("chrome")&&!ua("safari")};getFaviconTag=function(){var i,len,links;links=document.getElementsByTagName("link");i=0;len=links.length;while(i<len){if((links[i].getAttribute("rel")||"").match(/\bicon\b/)){return links[i]}i++}return false};removeFaviconTag=function(){var exists,head,i,len,links,results1;links=document.getElementsByTagName("link");head=document.getElementsByTagName("head")[0];i=0;len=links.length;results1=[];while(i<len){exists=typeof links[i]!=="undefined";if(exists&&(links[i].getAttribute("rel")||"").match(/\bicon\b/)){head.removeChild(links[i])}results1.push(i++)}return results1};getCurrentFavicon=function(){var tag;if(!originalFavicon||!currentFavicon){tag=getFaviconTag();originalFavicon=currentFavicon=tag?tag.getAttribute("href"):"/favicon.ico"}return currentFavicon};getCanvas=function(){if(!canvas){canvas=document.createElement("canvas");canvas.width=size;canvas.height=size}return canvas};setFaviconTag=function(url){var link;removeFaviconTag();link=document.createElement("link");link.type="image/x-icon";link.rel="icon";link.href=url;return document.getElementsByTagName("head")[0].appendChild(link)};drawFavicon=function(label,colour){var src;if(!getCanvas().getContext||browser.ie||browser.safari){return updateTitle(label)}context=getCanvas().getContext("2d");colour=colour||"#000000";src=getCurrentFavicon();faviconImage=document.createElement("img");faviconImage.onload=function(){context.clearRect(0,0,size,size);context.drawImage(faviconImage,0,0,faviconImage.width,faviconImage.height,0,0,size,size);if((label+"").length>0){drawBubble(context,label,colour)}return refreshFavicon()};if(!src.match(/^data/)&&options.crossOrigin){faviconImage.crossOrigin="anonymous"}return faviconImage.src=src};updateTitle=function(label){if(options.fallback){if((label+"").length>0){return document.title="("+label+") "+originalTitle}else{return document.title=originalTitle}}};drawBubble=function(context,label,colour){var bottom,height,left,len,radius,right,top,width;if(typeof label==="number"&&label>99&&options.abbreviate){label=abbreviateNumber(label)}len=(label+"").length-1;width=options.width*r+6*r*len;height=options.height*r;top=size-height;left=size-width-r;bottom=16*r;right=16*r;radius=2*r;context.font=(browser.webkit?"bold ":"")+options.font;context.fillStyle=options.background;context.strokeStyle=options.background;context.lineWidth=r;context.beginPath();context.moveTo(left+radius,top);context.quadraticCurveTo(left,top,left,top+radius);context.lineTo(left,bottom-radius);context.quadraticCurveTo(left,bottom,left+radius,bottom);context.lineTo(right-radius,bottom);context.quadraticCurveTo(right,bottom,right,bottom-radius);context.lineTo(right,top+radius);context.quadraticCurveTo(right,top,right-radius,top);context.closePath();context.fill();context.beginPath();context.strokeStyle="rgba(0,0,0,0.3)";context.moveTo(left+radius/2,bottom);context.lineTo(right-radius/2,bottom);context.stroke();context.fillStyle=options.colour;context.textAlign="right";context.textBaseline="top";return context.fillText(label,r===2?29:15,browser.mozilla?7*r:6*r)};refreshFavicon=function(){if(!getCanvas().getContext){return}return setFaviconTag(getCanvas().toDataURL())};abbreviateNumber=function(label){var i,metricPrefixes;metricPrefixes=[["G",1e9],["M",1e6],["k",1e3]];i=0;while(i<metricPrefixes.length){if(label>=metricPrefixes[i][1]){label=round(label/metricPrefixes[i][1])+metricPrefixes[i][0];break}++i}return label};round=function(value,precision){var number;number=new Number(value);return number.toFixed(precision)};return context.setBubble=function(label,colour){label=label||"";drawFavicon(label,colour);return this}})(this);ExitIntent=function(){var _delayTimer,_fireAndCallback,_html,aggressive,attachOuiBounce,delay,disable,disableKeydown,handleKeydown,handleMouseenter,handleMouseleave,sensitivity,setDefault,timer;_ullog("ExitIntent start");aggressive=false;sensitivity=20;timer=1e3;delay=0;_delayTimer=null;_html=document.documentElement;setDefault=function(_property,_default){if(typeof _property==="undefined"){return _default}else{return _property}};attachOuiBounce=function(){_html.addEventListener("mouseleave",handleMouseleave);_html.addEventListener("mouseenter",handleMouseenter);_html.addEventListener("keydown",handleKeydown)};handleMouseleave=function(e){if(e.clientY>sensitivity||session.get("exit_intent")&&!aggressive){return}_delayTimer=setTimeout(_fireAndCallback,delay)};handleMouseenter=function(e){if(_delayTimer){clearTimeout(_delayTimer);_delayTimer=null}};handleKeydown=function(e){var disableKeydown;if(disableKeydown||session.get("exit_intent")&&!aggressive){return}else if(!e.metaKey||e.keyCode!==76){return}disableKeydown=true;_delayTimer=setTimeout(_fireAndCallback,delay)};_fireAndCallback=function(){session.set("exit_intent",1);fsm.event("fire_exit_intent");return disable()};disable=function(options){_html.removeEventListener("mouseleave",handleMouseleave);_html.removeEventListener("mouseenter",handleMouseenter);_html.removeEventListener("keydown",handleKeydown)};setTimeout(attachOuiBounce,timer);return disableKeydown=false};CSS={eyecatcher:{enabled:"#userlikeEyecatcher {\n  display: none;\n  border:none;\n  border-radius:0;\n  clear:none;\n  cursor:pointer;\n  float:none;\n  outline-style:none;\n  position:fixed;\n  text-decoration:none;\n  text-indent:-100000px;\n  box-shadow:none;\n  z-index:100000;\n  padding: 0;\n  margin: 0;\n  -webkit-box-sizing: content-box; \n  -moz-box-sizing: content-box;\n  box-sizing: content-box; \n  -webkit-transition: opacity 0.1s ease-in;\n  -moz-transition: opacity 0.1s ease-in;\n  -ms-transition: opacity 0.1s ease-in;\n  transition: opacity 0.1s ease-in;\n  opacity: 0;\n}\n#userlikeEyecatcher.fadeIn {\n  opacity: 1!important;\n}",type00:"#userlikeEyecatcherClose {\n    top: 3px!important;\n    right: 3px!important;\n    display: none;\n}\n#userlikeEyecatcher:hover > #userlikeEyecatcherClose {\n  display: block;\n}\n#userlikeEyecatcher.@eyecatcher_type@ {\n    height: 60px;\n    width: 242px;\n    min-height: 60px;\n    max-height: 60px;\n    max-width: 242px;\n    min-width: 242px;\n    overflow: visible!important;\n    opacity: 0;\n    \n}\n#userlikeEyecatcherBox {\n    display: block;\n    background-color: #fff;\n    -moz-box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.1), 0 1px 4px 0 rgba(0, 0, 0, 0.1);\n    -webkit-box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.1), 0 1px 4px 0 rgba(0, 0, 0, 0.1);\n    box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.1), 0 1px 4px 0 rgba(0, 0, 0, 0.1);\n    border: 4px solid #FFF;\n    -moz-border-radius: 5px;\n    -webkit-border-radius: 5px;\n    border-radius: 5px;\n    height: 60px;\n    width: 242px;\n    overflow: visible!important;\n    -webkit-box-sizing: border-box; \n    -moz-box-sizing: border-box;\n    box-sizing: border-box; \n}\n#userlikeEyecatcherBox:before {\n    display: block;\n    position: absolute;\n    top: -50px;\n    left: 0;\n    right: 0;\n    margin: auto;\n    content: \"\";\n    background-color: #fff;\n    -moz-box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.1), 0 1px 4px 0 rgba(0, 0, 0, 0.1);\n    -webkit-box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.1), 0 1px 4px 0 rgba(0, 0, 0, 0.1);\n    box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.1), 0 1px 4px 0 rgba(0, 0, 0, 0.1);\n    border: 5px solid #fff;\n    -moz-border-radius: 50%;\n    -webkit-border-radius: 50%;\n    border-radius: 50%;\n    display: block;\n    width: 70px;\n    height: 70px;\n    z-index: -1;\n    -webkit-box-sizing: content-box; \n    -moz-box-sizing: content-box;\n    box-sizing: content-box; \n}\n\n#userlikeEyecatcherMask {\n    display: block;\n    position: absolute;\n    top: -50px;\n    left: 0;\n    right: 0;\n    margin: auto;\n    background-color: #fff;\n    border: 5px solid #fff;\n    -moz-border-radius: 50%;\n    -webkit-border-radius: 50%;\n    border-radius: 50%;\n    display: block;\n    width: 70px;\n    height: 70px;\n    overflow: hidden;\n    -webkit-box-sizing: content-box; \n    -moz-box-sizing: content-box;\n    box-sizing: content-box; \n}\n#userlikeEyecatcherPicture {\n    background: #fff url(https://@eyecatcher_picture_url@);\n    background-size: 70px 70px;\n    width: 70px;\n    height: 70px;\n}\n\n#userlikeEyecatcherMessage {\n    display: block;\n    position: absolute;\n    bottom: 14px;\n    text-align: center;\n    width: 100%;\n    font-family: '{{FONT}}', Sans-Serif;\n    font-size: 15px;\n    line-height: 17px;\n    color: #4b4d4f;\n    text-indent: 0px\n}\n#userlikeEyecatcher.@eyecatcher_type@.bottomRight {\n  right: 40px;\n  bottom: 40px;\n}\n#userlikeEyecatcher.@eyecatcher_type@.bottomLeft {\n  left: 40px;\n  bottom: 40px;\n}\n#userlikeEyecatcher.@eyecatcher_type@.topRight {\n  right: 40px;\n  top: 90px;\n}\n#userlikeEyecatcher.@eyecatcher_type@.topLeft {\n  left: 40px;\n  top: 90px;\n}",type01:"#userlikeEyecatcherClose {\n    top: 3px!important;\n    right: 15px!important;\n    display: none;\n}\n#userlikeEyecatcher:hover > #userlikeEyecatcherClose {\n  display: block;\n}\n#userlikeEyecatcher.@eyecatcher_type@ {\n  width: 204px;\n  height: 347px;\n  background-repeat: no-repeat;\n}\n@media\n(-webkit-min-device-pixel-ratio: 2),\n(min-resolution: 192dppx) {\n    #userlikeEyecatcher.@eyecatcher_type@.bottomLeft, \n    #userlikeEyecatcher.@eyecatcher_type@.bottomRight {\n        background: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/@eyecatcher_type@_bottom@2x.png) center no-repeat; \n        background-size: 104px 307px;\n    }\n    #userlikeEyecatcher.@eyecatcher_type@.topLeft, \n    #userlikeEyecatcher.@eyecatcher_type@.topRight {\n        background: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/@eyecatcher_type@_top@2x.png) center no-repeat; \n        background-size: 104px 307px;\n    }\n}\n#userlikeEyecatcher.@eyecatcher_type@.bottomRight {\n  background: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/@eyecatcher_type@_bottom.png) center no-repeat; \n  right: 60px;\n  bottom: 20px;\n}\n#userlikeEyecatcher.@eyecatcher_type@.bottomLeft {\n  background: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/@eyecatcher_type@_bottom.png) center no-repeat; \n  left: 60px;\n  bottom: 20px;\n}\n#userlikeEyecatcher.@eyecatcher_type@.topRight {\n  background: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/@eyecatcher_type@_top.png) center no-repeat; \n  right: 60px;\n  top: 20px;\n}\n#userlikeEyecatcher.@eyecatcher_type@.topLeft {\n  background: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/@eyecatcher_type@_top.png) center no-repeat; \n  left: 60px;\n  top: 20px;\n}",type02:"#userlikeEyecatcherClose {\n    top: -10px!important;\n    right: 5px!important;\n    display: none;\n}\n#userlikeEyecatcher:hover > #userlikeEyecatcherClose {\n  display: block;\n}\n#userlikeEyecatcher.@eyecatcher_type@ {\n  width: 205px;\n  height: 237px;\n  background-repeat: no-repeat;\n}\n\n@media\n(-webkit-min-device-pixel-ratio: 2),\n(min-resolution: 192dppx) {\n    #userlikeEyecatcher.@eyecatcher_type@.bottomLeft, \n    #userlikeEyecatcher.@eyecatcher_type@.bottomRight {\n        background: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/@eyecatcher_type@_bottom@2x.png) center no-repeat; \n        background-size: 205px 237px;\n    }\n    #userlikeEyecatcher.@eyecatcher_type@.topLeft, \n    #userlikeEyecatcher.@eyecatcher_type@.topRight {\n        background-size: 205px 237px;\n    }\n}\n#userlikeEyecatcher.@eyecatcher_type@.bottomRight {\n  background: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/@eyecatcher_type@_bottom.png) center no-repeat; \n  right: 65px;\n  bottom: 40px;\n}\n#userlikeEyecatcher.@eyecatcher_type@.bottomLeft {\n  background: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/@eyecatcher_type@_bottom.png) center no-repeat; \n  left: 65px;\n  bottom: 40px;\n}\n#userlikeEyecatcher.@eyecatcher_type@.topRight {\n  background: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/@eyecatcher_type@_top.png) center no-repeat; \n  right: 65px;\n  top: 40px;\n}\n#userlikeEyecatcher.@eyecatcher_type@.topLeft {\n  background: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/@eyecatcher_type@_top.png) center no-repeat; \n  left: 65px;\n  top: 40px;\n}\n"},round:{arrow:"#userlikePopup.userlikeArrow-topRight:after {\n    width: 0px;\n    height: 0px;\n    top: -10px;\n    left: 200px;\n    border-left: 10px solid transparent;\n    border-right: 10px solid transparent;\n    border-bottom: 10px solid #FFF;\n}\n\n#userlikePopup.userlikeArrow-topLeft:after {\n    width: 0px;\n    height: 0px;\n    top: -10px;\n    left: 55px;\n    border-left: 10px solid transparent;\n    border-right: 10px solid transparent;\n    border-bottom: 10px solid #FFF;\n}\n\n#userlikePopup.userlikeArrow-bottomRight:after {\n    width: 0px;\n    height: 0px;\n    top: 100%;\n    left: 200px;\n    border-left: 10px solid transparent;\n    border-right: 10px solid transparent;\n    border-top: 10px solid #FFF;\n}\n#userlikePopup.userlikeArrow-bottomLeft:after {\n    width: 0px;\n    height: 0px;\n    top: 100%;\n    left: 55px;\n    border-left: 10px solid transparent;\n    border-right: 10px solid transparent;\n    border-top: 10px solid #FFF;\n}\n\n#userlikePopup.userlikeArrow-right:after {\n    width: 0px;\n    height: 0px;\n    top: 40px;\n    right: -10px;\n    border-top: 10px solid transparent;\n    border-bottom: 10px solid transparent;\n    border-left: 10px solid #FFF;\n}\n\n#userlikePopup.userlikeArrow-left:after {\n    width: 0px;\n    height: 0px;\n    top: 40px;\n    left: -10px;\n    border-top: 10px solid transparent;\n    border-bottom: 10px solid transparent;\n    border-right:10px solid #FFF;\n}",button:"a#userlikeTab\n{\n    background:none;\n    border:none;\n    border-radius:0;\n    clear:none;\n    cursor:pointer;\n    color:#4b4d4f;\n    float:none;\n    height:104px;\n    overflow:hidden;\n    outline-style:none;\n    position:fixed;\n    text-decoration:none;\n    text-indent:-100000px;\n    width:36px;\n    box-shadow:none;\n    z-index:100000;\n    padding: 0;\n    margin: 0;\n    min-width:0;\n    min-height:0;\n    -webkit-box-sizing: content-box; \n    -moz-box-sizing: content-box;\n    box-sizing: content-box; \n}\n\na#userlikeTab.left\n{\n    top:25%!important;\n    left:0;\n    margin-left:-7px;\n    margin-right:auto!important;\n    width:36px!important;\n}\n\na#userlikeTab.left:hover\n{\n    margin-left:-4px;\n}\n\na#userlikeTab.right\n{\n    top:25%!important;\n    right:0;\n    left:auto!important;\n    margin-left:auto!important;\n    margin-right:-7px!important;\n    width:36px!important;\n}\n\na#userlikeTab.right:hover\n{\n    margin-right:-4px!important;\n    margin-left:auto!important;\n}\n\na#userlikeTab.bottomRight\n{\n    bottom:0;\n    left:80%!important;\n    width:104px;\n    height:36px;\n    margin-bottom:-6px!important;\n    margin-left:auto!important;\n}\n\na#userlikeTab.bottomLeft\n{\n    bottom:0;\n    left:20%!important;\n    width:104px;\n    height:36px;\n    margin-bottom:-6px!important;\n    margin-left:auto!important;\n}\n\na#userlikeTab.topRight\n{\n    top:0;\n    left:80%!important;\n    width:104px;\n    height:36px;\n    margin-top:-6px!important;\n    margin-left:auto!important;\n}\n\na#userlikeTab.topLeft\n{\n    top:0;\n    left:20%!important;\n    width:104px;\n    height:36px;\n    margin-top:-6px!important;\n    margin-left:auto!important;\n}\n\na#userlikeTab.bottomRight:hover,a#userlikeTab.bottomLeft:hover\n{\n    margin-bottom:-3px!important;\n    margin-left:auto!important;\n}\n\na#userlikeTab.topRight:hover,a#userlikeTab.topLeft:hover\n{\n    margin-top:-3px!important;\n    margin-left:auto!important;\n}\n\na#userlikeTab.@Style@@Text@Left {\n    background-image: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_left.png);\n    background-repeat: no-repeat;\n    -webkit-border-top-right-radius:@radius@px;\n    -moz-border-top-right-radius:@radius@px;\n    border-top-right-radius:@radius@px;\n    -webkit-border-bottom-right-radius:@radius@px;\n    -moz-border-bottom-right-radius:@radius@px;\n    border-bottom-right-radius:@radius@px;\n}\na#userlikeTab.@Style@@Text@Right {\n    background-image: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_right.png);\n    background-repeat: no-repeat;\n    -webkit-border-top-left-radius:@radius@px;\n    -moz-border-top-left-radius:@radius@px;\n    border-top-left-radius:@radius@px;\n    -webkit-border-bottom-left-radius:@radius@px;\n    -moz-border-bottom-left-radius:@radius@px;\n    border-bottom-left-radius:@radius@px;\n}\na#userlikeTab.@Style@@Text@TopLeft {\n    background-image: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_top.png);\n    background-repeat: no-repeat;\n    -webkit-border-bottom-left-radius:@radius@px;\n    -moz-border-bottom-left-radius:@radius@px;\n    border-bottom-left-radius:@radius@px;\n    -webkit-border-bottom-right-radius:@radius@px;\n    -moz-border-bottom-right-radius:@radius@px;\n    border-bottom-right-radius:@radius@px;\n}\na#userlikeTab.@Style@@Text@TopRight {\n    background-image: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_top.png);\n    background-repeat: no-repeat;\n    -webkit-border-bottom-left-radius:@radius@px;\n    -moz-border-bottom-left-radius:@radius@px;\n    border-bottom-left-radius:@radius@px;\n    -webkit-border-bottom-right-radius:@radius@px;\n    -moz-border-bottom-right-radius:@radius@px;\n    border-bottom-right-radius:@radius@px;\n}\na#userlikeTab.@Style@@Text@BottomLeft {\n    background-image: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_bottom.png);\n    background-repeat: no-repeat;\n    -webkit-border-top-left-radius:@radius@px;\n    -moz-border-top-left-radius:@radius@px;\n    border-top-left-radius:@radius@px;\n    -webkit-border-top-right-radius:@radius@px;\n    -moz-border-top-right-radius:@radius@px;\n    border-top-right-radius:@radius@px;\n}\na#userlikeTab.@Style@@Text@BottomRight {\n    background-image: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_bottom.png);\n    background-repeat: no-repeat;\n    -webkit-border-top-left-radius:@radius@px;\n    -moz-border-top-left-radius:@radius@px;\n    border-top-left-radius:@radius@px;\n    -webkit-border-top-right-radius:@radius@px;\n    -moz-border-top-right-radius:@radius@px;\n    border-top-right-radius:@radius@px;\n}\n@media\n(-webkit-min-device-pixel-ratio: 2),\n(min-resolution: 192dppx) {\n    a#userlikeTab.@Style@@Text@Left {\n        background-image: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_left@2x.png);\n        background-size: 36px 104px;\n        background-repeat: no-repeat;\n    }\n    a#userlikeTab.@Style@@Text@Right {\n        background-image: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_right@2x.png);\n        background-size: 36px 104px;\n        background-repeat: no-repeat;\n    }\n    a#userlikeTab.@Style@@Text@TopLeft {\n        background-image: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_top@2x.png);\n        background-size: 104px 36px;\n        background-repeat: no-repeat;\n    }\n    a#userlikeTab.@Style@@Text@TopRight {\n        background-image: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_top@2x.png);\n        background-size: 104px 36px;\n        background-repeat: no-repeat;\n    }\n    a#userlikeTab.@Style@@Text@BottomLeft {\n        background-image: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_bottom@2x.png);\n        background-size: 104px 36px;\n        background-repeat: no-repeat;\n    }\n    a#userlikeTab.@Style@@Text@BottomRight {\n        background-image: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_bottom@2x.png);\n        background-size: 104px 36px;\n        background-repeat: no-repeat;\n    }\n}\na#userlikeTab.lt-ie9.@Style@@Text@Left {\n    background-image: none;\n    filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_left.png',sizingMethod=\"crop\");\n}\na#userlikeTab.lt-ie9.@Style@@Text@Right {\n    background-image: none;\n    filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_right.png',sizingMethod=\"crop\");\n}\na#userlikeTab.lt-ie9.@Style@@Text@TopLeft {\n    background-image: none;\n    filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_top.png',sizingMethod=\"crop\");\n}\na#userlikeTab.lt-ie9.@Style@@Text@TopRight {\n    background-image: none;\n    filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_top.png',sizingMethod=\"crop\");\n}\na#userlikeTab.lt-ie9.@Style@@Text@BottomLeft {\n    background-image: none;\n    filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_bottom.png',sizingMethod=\"crop\");\n}\na#userlikeTab.lt-ie9.@Style@@Text@BottomRight {\n    background-image: none;\n    filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_bottom.png',sizingMethod=\"crop\");\n}"},circle:{arrow:"#userlikePopup.userlikeArrow-topLeft:after {\n    width: 0px;\n    height: 0px;\n    top: -10px;\n    left: 18px;\n    border-left: 10px solid transparent;\n    border-right: 10px solid transparent;\n    border-bottom: 10px solid #FFF;\n}\n#userlikePopup.userlikeArrow-topRight:after {\n    width: 0px;\n    height: 0px;\n    top: -10px;\n    left: 283px;\n    border-left: 10px solid transparent;\n    border-right: 10px solid transparent;\n    border-bottom: 10px solid #FFF;\n}\n#userlikePopup.userlikeArrow-bottomLeft:after {\n    width: 0px;\n    height: 0px;\n    top: 100%;\n    left: 18px;\n    border-left: 10px solid transparent;\n    border-right: 10px solid transparent;\n    border-top: 10px solid #FFF;\n}\n#userlikePopup.userlikeArrow-bottomRight:after{\n    width: 0px;\n    height: 0px;\n    top: 100%;\n    left: 283px;\n    border-left: 10px solid transparent;\n    border-right: 10px solid transparent;\n    border-top: 10px solid #FFF;\n}\n#userlikePopup.userlikeArrow-right:after {\n    width: 0px;\n    height: 0px;\n    top: 50px;\n    right: -10px;\n    border-top: 10px solid transparent;\n    border-bottom: 10px solid transparent;\n    border-left: 10px solid #FFF;\n}\n\n#userlikePopup.userlikeArrow-left:after {\n    width: 0px;\n    height: 0px;\n    top: 50px;\n    left: -10px;\n    border-top: 10px solid transparent;\n    border-bottom: 10px solid transparent;\n    border-right:10px solid #FFF;\n}\n\n#userlike.userlikeMobile #userlikePopup.userlikeArrow-topRight:after,\n#userlike.userlikeMobile #userlikePopup.userlikeArrow-bottomRight:after {\n    left: 204px;\n}",button:"a#userlikeTab\n{\n    display: block;\n    cursor:pointer;\n    overflow:hidden;\n    position:fixed;\n    text-decoration:none;\n    text-indent:-100000px;\n    z-index:100000;\n    padding: 0;\n    margin: 0;\n    width:50px;\n    height:50px;\n    border: 1px solid rgba(50,50,50,0.2);\n    border-radius: 60px;\n    color: #FFF;\n    box-shadow: inset -1px 1px 1px -1px rgba(75,75,75,0.75);\n    min-width:0;\n    min-height:0;\n    -webkit-box-sizing: content-box; \n    -moz-box-sizing: content-box;\n    box-sizing: content-box; \n}\n\na#userlikeTab.left\n{\n    top:25%;\n    left:30px;\n}\n\na#userlikeTab.right\n{\n    top:25%;\n    right:30px;\n}\n\n\na#userlikeTab.bottomRight\n{\n    bottom:30px;\n    right:30px;\n}\n\na#userlikeTab.bottomLeft\n{\n    bottom:30px;\n    left:30px;\n}\n\na#userlikeTab.topRight\n{\n    top:30px;\n    right:30px;\n}\n\na#userlikeTab.topLeft\n{\n    top:30px;\n    left:30px;\n}\na#userlikeTab.@Style@@Text@TopLeft,\na#userlikeTab.@Style@@Text@TopRight,\na#userlikeTab.@Style@@Text@BottomLeft,\na#userlikeTab.@Style@@Text@BottomRight,\na#userlikeTab.@Style@@Text@Right,\na#userlikeTab.@Style@@Text@Left {\n    background: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@.png) no-repeat 10px 13px;\n}\n\n@media\n(-webkit-min-device-pixel-ratio: 2),\n(min-resolution: 192dppx) {\n  a#userlikeTab.@Style@@Text@TopLeft,\n  a#userlikeTab.@Style@@Text@TopRight,\n  a#userlikeTab.@Style@@Text@BottomLeft,\n  a#userlikeTab.@Style@@Text@BottomRight,\n  a#userlikeTab.@Style@@Text@Right,\n  a#userlikeTab.@Style@@Text@Left {\n        background: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@@2x.png) no-repeat 10px 13px;\n        background-size: 30px 25px;\n    }\n}"
},big:{arrow:"#userlikePopup.userlikeArrow-topRight:after {\n    width: 0px;\n    height: 0px;\n    top: -10px;\n    left: 240px;\n    border-left: 10px solid transparent;\n    border-right: 10px solid transparent;\n    border-bottom: 10px solid #FFF;\n}\n\n#userlikePopup.userlikeArrow-topLeft:after {\n    width: 0px;\n    height: 0px;\n    top: -10px;\n    left: 55px;\n    border-left: 10px solid transparent;\n    border-right: 10px solid transparent;\n    border-bottom: 10px solid #FFF;\n}\n\n#userlikePopup.userlikeArrow-bottomRight:after {\n    width: 0px;\n    height: 0px;\n    top: 100%;\n    left: 240px;\n    border-left: 10px solid transparent;\n    border-right: 10px solid transparent;\n    border-top: 10px solid #FFF;\n}\n#userlikePopup.userlikeArrow-bottomLeft:after {\n    width: 0px;\n    height: 0px;\n    top: 100%;\n    left: 55px;\n    border-left: 10px solid transparent;\n    border-right: 10px solid transparent;\n    border-top: 10px solid #FFF;\n}\n\n#userlike.userlikeMobile #userlikePopup.userlikeArrow-topRight:after,\n#userlike.userlikeMobile #userlikePopup.userlikeArrow-bottomRight:after {\n    left: 180px;\n}\n\na#userlikeTab\n{\n    background:none;\n    font-family: '{{FONT}}', Sans-Serif;\n    font-size: 16px;\n    font-weight: 700;\n    border:none;\n    border-radius:0;\n    clear:none;\n    cursor:pointer;\n    color:#fff;\n    float:none;\n    outline-style:none;\n    position:fixed;\n    text-decoration:none;\n    box-shadow:none;\n    z-index:100000;\n    padding: 0;\n    margin: 0;\n    min-width: 0;\n    min-height: 0;\n    width: 190px;\n    height: 35px;\n    max-height: 0px;\n    line-height: @height1@px;\n    padding-bottom: 0px;\n    padding-left: 42px;\n    padding-right: 10px;\n    padding-top: 5px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    letter-spacing:normal;\n    opacity:1;\n    outline-style:none;\n    text-align:left;\n    text-decoration:none;\n    text-indent:0;\n    text-transform:none;\n    text-shadow:none;\n    unicode-bidi:normal;\n    word-spacing:normal;\n    -moz-text-size-adjust:100%;\n    -webkit-text-size-adjust:100%;\n    -webkit-touch-callout:none;\n    -webkit-user-select:none;\n    -moz-user-select:none;\n    -ms-user-select:none;\n    -webkit-user-select:none;\n    user-select:none;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    -webkit-box-sizing: content-box; \n    -moz-box-sizing: content-box;\n    box-sizing: content-box; \n    border-radius:  5px;\n    box-shadow: 0px -5px 30px 0px rgba(0,0,0,.1);\n    -webkit-box-shadow: 0px -5px 30px 0px rgba(0,0,0,.1);\n    -moz-box-shadow: 0px -5px 30px 0px rgba(0,0,0,.1);\n}\na#userlikeTab.slideUp {\n    max-height: 35px;            \n    -webkit-transition: max-height 0.5s ease-in-out;\n    -moz-transition: max-height 0.5s ease-in-out;\n    transition: max-height 0.5s ease-in-out;\n}\na#userlikeTab.slideDown {\n    top: 0!important;\n    max-height: 35px;            \n    -webkit-transition: top 0.5s ease-in-out;\n    -moz-transition: top 0.5s ease-in-out;\n    transition: top 0.5s ease-in-out;\n}",button:"a#userlikeTab.bottomRight\n{\n    bottom:0;\n    right: 40px;\n    margin-bottom: -6px;\n}\n\na#userlikeTab.bottomLeft\n{\n    bottom:0;\n    left: 40px;\n    margin-bottom: -6px;\n}\n\na#userlikeTab.topRight\n{\n    top:-35px;\n    right: 40px;\n    margin-top: -6px;\n    line-height: @height2@px;\n}\n\na#userlikeTab.topLeft\n{\n    top:-35px;\n    left: 40px;\n    margin-top: -6px;\n    line-height: @height2@px;\n}\n\na#userlikeTab.@Style@@Text@TopLeft {\n    background-image: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_top.png);\n    background-repeat: no-repeat;\n    -webkit-border-bottom-left-radius:@radius@px;\n    -moz-border-bottom-left-radius:@radius@px;\n    border-bottom-left-radius:@radius@px;\n    -webkit-border-bottom-right-radius:@radius@px;\n    -moz-border-bottom-right-radius:@radius@px;\n    border-bottom-right-radius:@radius@px;\n}\na#userlikeTab.@Style@@Text@TopRight {\n    background-image: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_top.png);\n    background-repeat: no-repeat;\n    -webkit-border-bottom-left-radius:@radius@px;\n    -moz-border-bottom-left-radius:@radius@px;\n    border-bottom-left-radius:@radius@px;\n    -webkit-border-bottom-right-radius:@radius@px;\n    -moz-border-bottom-right-radius:@radius@px;\n    border-bottom-right-radius:@radius@px;\n}\na#userlikeTab.@Style@@Text@BottomLeft {\n    background-image: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_bottom.png);\n    background-repeat: no-repeat;\n    -webkit-border-top-left-radius:@radius@px;\n    -moz-border-top-left-radius:@radius@px;\n    border-top-left-radius:@radius@px;\n    -webkit-border-top-right-radius:@radius@px;\n    -moz-border-top-right-radius:@radius@px;\n    border-top-right-radius:@radius@px;\n}\na#userlikeTab.@Style@@Text@BottomRight {\n    background-image: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@_bottom.png);\n    background-repeat: no-repeat;\n    -webkit-border-top-left-radius:@radius@px;\n    -moz-border-top-left-radius:@radius@px;\n    border-top-left-radius:@radius@px;\n    -webkit-border-top-right-radius:@radius@px;\n    -moz-border-top-right-radius:@radius@px;\n    border-top-right-radius:@radius@px;\n}\n\na#userlikeTab.@Style@@Text@TopLeft,\na#userlikeTab.@Style@@Text@TopRight {\n      background: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@.png) no-repeat 10px 10px;\n      background-size: 24px 24px;\n}\n\na#userlikeTab.@Style@@Text@BottomLeft,\na#userlikeTab.@Style@@Text@BottomRight {\n      background: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@.png) no-repeat 10px 6px;\n      background-size: 24px 24px;\n}\n\n@media\n(-webkit-min-device-pixel-ratio: 2),\n(min-resolution: 192dppx) {\n  a#userlikeTab.@Style@@Text@TopLeft,\n  a#userlikeTab.@Style@@Text@TopRight {\n      background: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@@2x.png) no-repeat 10px 10px;\n      background-size: 24px 24px;\n    }\n\n  a#userlikeTab.@Style@@Text@BottomLeft,\n  a#userlikeTab.@Style@@Text@BottomRight {\n      background: url(//userlike-cdn-client.s3-eu-west-1.amazonaws.com/tab_@style@_@text@@2x.png) no-repeat 10px 6px;\n      background-size: 24px 24px;\n    }\n}"}};Button=function(){function Button(){this.callbacks=[];this.addCallback("userlikeButtonHandler")}Button.prototype.changeToOfflineText=function(){};Button.prototype.delayProactive=function(){return 0};Button.prototype.el=function(){return document.getElementById("userlikeTab")};Button.prototype.elEyecatcher=function(){return document.getElementById("userlikeEyecatcher")};Button.prototype.elEyecatcherClose=function(){return document.getElementById("userlikeEyecatcherClose")};Button.prototype.addCallback=function(name){var fn;fn=window[name];if(typeof fn==="function"){return this.callbacks.push(fn)}};Button.prototype.triggerCallbacks=function(visible){var callback,j,len1,ref1,results1;ref1=this.callbacks;results1=[];for(j=0,len1=ref1.length;j<len1;j++){callback=ref1[j];results1.push(callback(visible))}return results1};Button.prototype.registerEvents=function(){var ref1,ref2,ref3;if((ref1=this.el())!=null){ref1.onclick=function(){fsm.event("chatButton");return false}}if((ref2=this.elEyecatcherClose())!=null){ref2.onclick=function(_this){return function(event){event.stopPropagation();_this.fadeOutEyecatcher();return false}}(this)}return(ref3=this.elEyecatcher())!=null?ref3.onclick=function(_this){return function(){_this.fadeOutEyecatcher();fsm.event("chatButton");return false}}(this):void 0};Button.prototype.hide=function(){return this.triggerCallbacks(false)};Button.prototype.show=function(delay){this.inject();return this.triggerCallbacks(true)};Button.prototype.fadeInEyecatcher=function(delay){};Button.prototype.fadeOutEyecatcher=function(){};Button.prototype.replaceTemplate=function(css,style,radius,text){return css.replace(/@Style@/g,capitalize(style)).replace(/@style@/g,style).replace(/@Text@/g,capitalize(text)).replace(/@text@/g,text).replace(/@radius@/g,radius)};Button.prototype.renderEyecatcher=function(){var doc,i,ref1;i=parseInt(config.eyecatcher_type.split("_")[1]);doc="";if(config.eyecatcher_enabled){doc=CSS.eyecatcher.enabled;if(i===0){doc+=CSS.eyecatcher.type00}else if(i<37){doc+=CSS.eyecatcher.type01}else{doc+=CSS.eyecatcher.type02}doc=doc.replace(/@eyecatcher_type@/g,config.eyecatcher_type);doc=doc.replace(/@eyecatcher_picture_url@/g,config.eyecatcher_picture_url);doc=doc.replace("{{FONT}}",(ref1=config.font)!=null?ref1.split(":")[0]:void 0)}return doc};Button.prototype.render=function(){var doc;doc=this.replaceTemplate(CSS.round.arrow+CSS.round.button,this.kind.toLowerCase(),10,config.tab_text);return this.writeCss(doc)};Button.prototype.writeCss=function(doc){var userlikestyle_element;userlikestyle_element=document.createElement("style");userlikestyle_element.type="text/css";if(userlikestyle_element.styleSheet){userlikestyle_element.styleSheet.cssText=doc}else{userlikestyle_element.appendChild(document.createTextNode(doc))}return document.getElementsByTagName("head")[0].appendChild(userlikestyle_element)};Button.prototype.inject=function(){var div,inject,trial;if(this.el()){return}div=document.createElement("div");div.className="userlike";div.innerHTML='<div id="userlikeEyecatcher" class="'+config.eyecatcher_type+" "+config.orientation+'"><div id="userlikeEyecatcherClose">&nbsp;</div><div id="userlikeEyecatcherBox"><div id="userlikeEyecatcherMask"><div id="userlikeEyecatcherPicture"></div></div><div id="userlikeEyecatcherMessage">'+config.eyecatcher_message+'</div></div></div><a href="javascript:void(0);" onkeypress="javascript:return false;" id="userlikeTab" class="'+config.orientation+" "+this.kind+this.text+capitalize(config.orientation)+'" style="'+this.style+'">'+this.label+"</a>";trial=100;inject=function(_this){return function(){var el;el=document.getElementsByTagName("body");if(el[0]){el[0].appendChild(div)}else{el=document.getElementsByTagName("frameset");if(el[0]){el=window.frame[0].document.getElementsByTagName("body");if(el[0]){el[0].appendChild(div)}}}if(!_this.el()&&trial--){window.setTimeout(inject,100)}}}(this);return inject()};Button.prototype.shake=function(){var $tab,data,ref1,what;if(this.timer){return}_ullog("Button::shake start");$tab=jq(this.el());if(config.orientation==="left"){what="left"}else if(config.orientation==="right"){what="right"}else if((ref1=config.orientation)==="topLeft"||ref1==="topRight"){what="top"}else{what="bottom"}data=[];data[0]={};data[0][what]=-2;data[1]={};data[1][what]=+5;data[2]={};data[2][what]=-1;data[3]={};data[3][what]=+1;return this.timer=setInterval(function(_this){return function(){_ullog("Button::shake interval");return $tab.animate(data[0],80,function(){return $tab.animate(data[1],100,function(){return $tab.animate(data[2],100,function(){return $tab.animate(data[3],80,function(){})})})})}}(this),1500)};Button.prototype.clear=function(){clearInterval(this.timer);this.timer=void 0;return _ullog("Button::clear")};Button.prototype.popupOrientation=function(){return config.orientation};Button.prototype.popupPosition=function(){var offset,orientation,pos,top;orientation=this.popupOrientation();offset=jq(this.el()).offset();top=jq(window).scrollTop();if(orientation==="left"){pos={top:offset.top-15-top,left:50,right:"auto",bottom:"auto"}}else if(orientation==="right"){pos={top:offset.top-15-top,left:"auto",right:50,bottom:"auto"}}else if(orientation==="topLeft"){pos={top:50,left:offset.left-30,right:"auto",bottom:"auto"}}else if(orientation==="topRight"){pos={top:50,left:offset.left-140,right:"auto",bottom:"auto"}}else if(orientation==="bottomLeft"){pos={top:"auto",left:offset.left-30,right:"auto",bottom:50}}else if(orientation==="bottomRight"){pos={top:"auto",left:offset.left-140,right:"auto",bottom:50}}return pos};return Button}();ButtonCustom=function(superClass){extend(ButtonCustom,superClass);function ButtonCustom(){var callback,ref1;this.callbacks=[];callback=(ref1=this.el().attributes.getNamedItem("data-callback"))!=null?ref1.value:void 0;this.addCallback(callback);this.addCallback("userlikeButtonHandler");this.render()}ButtonCustom.prototype.el=function(){return document.getElementById("userlikeCustomTab")};ButtonCustom.prototype.render=function(){var doc;doc=CSS.round.arrow;return this.writeCss(doc)};ButtonCustom.prototype.show=function(){return this.triggerCallbacks(true)};ButtonCustom.prototype.popupOrientation=function(){var data,orientation;data=jq("#userlikeCustomTab").data();orientation=data.orientation||"";return orientation};ButtonCustom.prototype.popupPosition=function(){var $el,data,h,offset,orientation,pos,sleft,stop,w;$el=jq("#userlikeCustomTab");data=$el.data();orientation=this.popupOrientation();if(data.left||data.right||data.bottom||data.top){return data}w=$el.outerWidth();h=$el.outerHeight();offset=$el.offset();if($el.css("position")==="fixed"){stop=jq(window).scrollTop();sleft=jq(window).scrollLeft()}else{stop=0;sleft=0}if(orientation==="left"){return pos={top:offset.top-15-stop+"px",left:offset.left+w+15-sleft+"px",right:"auto",bottom:"auto"}}else if(orientation==="right"){return pos={top:offset.top-15-stop+"px",left:offset.left-popup.popup.width()-15-sleft+"px",bottom:"auto"}}else if(orientation==="topLeft"){return pos={top:offset.top+h+15-stop+"px",left:offset.left-sleft+"px",right:"auto",bottom:"auto"}}else if(orientation==="topRight"){return pos={top:offset.top+h+15-stop+"px",left:offset.left-200+15-sleft+"px",right:"auto",bottom:"auto"}}else if(orientation==="bottomLeft"){return pos={top:"auto",left:offset.left-sleft+"px",right:"auto",bottom:jq(window).height()-offset.top+15+stop+"px"}}else if(orientation==="bottomRight"){return pos={top:"auto",left:offset.left-200+15+"px",right:"auto",bottom:jq(window).height()-offset.top+15+stop+"px"}}else if(orientation==="center"){return pos={top:Math.max(0,(jq(window).height()-jq("#userlikePopup").outerHeight())/2)+"px",left:Math.max(0,(jq(window).width()-jq("#userlikePopup").outerWidth())/2)+"px"}}else{pos={top:offset.top,left:offset.left,right:"auto",bottom:"auto"};return pos}};return ButtonCustom}(Button);ButtonPng=function(superClass){extend(ButtonPng,superClass);function ButtonPng(){this.kind=capitalize(config.tab_color_png);this.style="";this.text=capitalize(config.tab_text);this.label="";ButtonPng.__super__.constructor.call(this)}return ButtonPng}(Button);ButtonCircle=function(superClass){extend(ButtonCircle,superClass);function ButtonCircle(){this.kind="Circle";this.style="background-color:"+config.tab_color_css;this.text=capitalize(config.tab_icon);this.label="";ButtonCircle.__super__.constructor.call(this)}ButtonCircle.prototype.render=function(){var doc;doc=this.replaceTemplate(CSS.circle.arrow+CSS.circle.button,this.kind.toLowerCase(),50,config.tab_icon);return this.writeCss(doc)};ButtonCircle.prototype.popupPosition=function(){var mobile_offset,offset,orientation,pos,top;orientation=this.popupOrientation();offset=jq(this.el()).offset();top=jq(window).scrollTop();if(is_mobile){mobile_offset=80}else{mobile_offset=0}if(orientation==="left"){pos={top:offset.top-35-top,left:105,right:"auto",bottom:"auto"}}else if(orientation==="right"){pos={top:offset.top-35-top,left:"auto",right:105,bottom:"auto"}}else if(orientation==="topLeft"){pos={top:105,left:offset.left-2,right:"auto",bottom:"auto"}}else if(orientation==="topRight"){pos={top:105,left:offset.left-268+mobile_offset,right:"auto",bottom:"auto"}}else if(orientation==="bottomLeft"){pos={top:"auto",left:offset.left-2,right:"auto",bottom:105}}else if(orientation==="bottomRight"){pos={top:"auto",left:offset.left-268+mobile_offset,right:"auto",bottom:105}}return pos};return ButtonCircle}(Button);ButtonBig=function(superClass){extend(ButtonBig,superClass);function ButtonBig(){this.kind="Big";this.style="background-color:"+config.tab_color_css;this.icon=config.tab_icon;this.text=capitalize(this.icon);this.label=config.tab_text_label;ButtonBig.__super__.constructor.call(this)}ButtonBig.prototype.changeToOfflineText=function(){this.label=config.tab_text_offline;this.icon="envelope-alt";return this.text=capitalize(this.icon)};ButtonBig.prototype.delayProactive=function(){return 3};ButtonBig.prototype.replaceTemplate=function(css,style,radius,height1,height2,text){return css.replace(/@Style@/g,capitalize(style)).replace(/@style@/g,style).replace(/@Text@/g,capitalize(text)).replace(/@text@/g,text).replace(/@height1@/g,height1).replace(/@height2@/g,height2).replace(/@radius@/g,radius)};ButtonBig.prototype.fadeInEyecatcher=function(delay){var _,trial;if(!config.eyecatcher_enabled){return}delay=delay||3e3;trial=100;_=function(_this){return function(){var el;el=_this.elEyecatcher();if(el){el.style.display="block";return _this.eyecatcherTimer=setTimeout(function(){if(el.classList){return el.classList.add("fadeIn")}else{return el.className+=" fadeIn"}},delay)}else if(trial--){return setTimeout(_,100)}}}(this);return _()};ButtonBig.prototype.fadeOutEyecatcher=function(){var el;if(!config.eyecatcher_enabled){return}clearTimeout(this.eyecatcherTimer);el=this.elEyecatcher();if(el.classList){el.classList.remove("fadeIn")}else{el.className.replace(/(?:^|\s)fadeIn(?!\S)/g,"")}return setTimeout(function(_this){return function(){el=_this.elEyecatcher();return el.style.display="none"}}(this),200)};ButtonBig.prototype.render=function(){var doc,offset,ref1;offset=config.font!=="sans-serif"?1:0;doc=this.replaceTemplate(CSS.big.arrow+CSS.big.button,this.kind.toLowerCase(),5,26-offset,34-offset,this.icon);doc=doc.replace("{{FONT}}",(ref1=config.font)!=null?ref1.split(":")[0]:void 0);doc+=this.renderEyecatcher();return this.writeCss(doc)};ButtonBig.prototype.show=function(delay){this.inject();return this.slide(delay)};ButtonBig.prototype.slide=function(delay){var classname,orientation;delay=delay?2e3:0;orientation=this.popupOrientation();if(orientation==="topLeft"||orientation==="topRight"){classname="slideDown"}else{classname="slideUp"}return setTimeout(function(_this){return function(){var el;el=_this.el();if(el.classList){el.classList.add(classname)}else{el.className+=" "+classname}return _this.triggerCallbacks(true)}}(this),delay)};ButtonBig.prototype.popupPosition=function(){var orientation,pos;orientation=this.popupOrientation();if(orientation==="topLeft"){pos={top:55,left:20,right:"auto",bottom:"auto"}}else if(orientation==="topRight"){pos={top:55,right:20,left:"auto",bottom:"auto"}}else if(orientation==="bottomLeft"){pos={top:"auto",left:20,right:"auto",bottom:55}}else if(orientation==="bottomRight"){pos={top:"auto",right:20,left:"auto",bottom:55}}return pos};return ButtonBig}(Button);ButtonSquare=function(superClass){extend(ButtonSquare,superClass);function ButtonSquare(){this.kind="Square";this.style="background-color:"+config.tab_color_css;this.text=capitalize(config.tab_text);this.label="";ButtonSquare.__super__.constructor.call(this)}ButtonSquare.prototype.render=function(){var doc;doc=this.replaceTemplate(CSS.round.arrow+CSS.round.button,this.kind.toLowerCase(),0,config.tab_text);return this.writeCss(doc)};return ButtonSquare}(Button);ButtonRound=function(superClass){extend(ButtonRound,superClass);function ButtonRound(){this.kind="Round";this.style="background-color:"+config.tab_color_css;this.text=capitalize(config.tab_text);this.label="";ButtonRound.__super__.constructor.call(this)}return ButtonRound}(Button);ButtonFactory=function(){function ButtonFactory(){}ButtonFactory.prototype.checkIE=function(){var div;div=document.createElement("div");div.innerHTML="<!--[if lt IE 9]><i></i><![endif]-->";div.className="userlike";return div.getElementsByTagName("i").length};ButtonFactory.prototype.makeButton=function(){if(document.getElementById("userlikeCustomTab")){return new ButtonCustom}else if(config.tab_type==="png"){return new ButtonPng}else{if(config.tab_form_css==="circle"){return new ButtonCircle}else if(config.tab_form_css==="big"){return new ButtonBig}else if(this.checkIE()){return new ButtonSquare}else if(config.tab_form_css==="square"){return new ButtonSquare}else{return new ButtonRound}}};return ButtonFactory}();this.userlikeCallbackIframeCheck=function(resp){var blacklist,key;key="iframe_blacklist_"+hashCode(resp.url);blacklist=resp.status!=="200"||resp.xframe;_ullog("userlikeCallbackIframeCheck: url="+resp.url+" status="+resp.status+" xframe="+resp.xframe+" blacklist="+blacklist);return session.set(key,blacklist)};KeyHandlerFactory=function(){function KeyHandlerFactory(){}KeyHandlerFactory.prototype.get=function($input,fsm){if(!config.data_privacy&&config.live_preview){return new KeyHandlerLivePreview($input,fsm)}else{return new KeyHandler($input,fsm)}};return KeyHandlerFactory}();KeyHandler=function(){KeyHandler.PAUSED="Paused";KeyHandler.COMPOSING="Composing";KeyHandler.ACTIVE="Active";KeyHandler.CHAT_STATE_INTERVAL=5e3;KeyHandler.PREVIEW_INTERVAL=500;KeyHandler.fsm=null;KeyHandler.$input=null;KeyHandler.chat_state_timer=null;KeyHandler.chat_state_last_input="";KeyHandler.chat_state_last_length="";function KeyHandler($input1,fsm1){this.$input=$input1;this.fsm=fsm1;this.handler=bind(this.handler,this);this.chatStateTimer=bind(this.chatStateTimer,this);this.chat_state=KeyHandler.PAUSED;this.$input.off().on("keypress",this.handler);this.$input.blur(function(_this){return function(){return _this.changeChatState(KeyHandler.PAUSED)}}(this));this.$input.focus(function(_this){return function(){return _this.changeChatState(KeyHandler.ACTIVE)}}(this))}KeyHandler.prototype.chatStateTimer=function(){if(this.chat_state===KeyHandler.COMPOSING&&this.$input.val().length===this.chat_state_last_length){return this.changeChatState(KeyHandler.PAUSED)}else if(this.chat_state===KeyHandler.COMPOSING){this.chat_state_last_length=this.$input.val().length;clearTimeout(this.chat_state_timer);return this.chat_state_timer=setTimeout(this.chatStateTimer,KeyHandler.CHAT_STATE_INTERVAL)}};KeyHandler.prototype.changeChatState=function(newChatState){this.chat_state_last_input=this.chat_state;this.chat_state=newChatState;if(this.chat_state!==this.chat_state_last_input){_ullog("KeyHandler changeChatState name="+this.chat_state);return this.fsm.event("state"+this.chat_state)}};KeyHandler.prototype.clearTimer=function(){clearTimeout(this.chat_state_timer);return this.chat_state_timer=null};KeyHandler.prototype.handler=function(e){if(e.which===13&&e.shiftKey){}else if(e.which===13){this.changeChatState(KeyHandler.PAUSED);fsm.event("inputEnter");this.clearTimer();e.preventDefault()}else{this.changeChatState(KeyHandler.COMPOSING);clearTimeout(this.chat_state_timer);return this.timer=setTimeout(this.chatStateTimer,KeyHandler.CHAT_STATE_INTERVAL)}};return KeyHandler}();KeyHandlerLivePreview=function(superClass){extend(KeyHandlerLivePreview,superClass);function KeyHandlerLivePreview(){this.handler=bind(this.handler,this);this.livePreviewTimer=bind(this.livePreviewTimer,this);return KeyHandlerLivePreview.__super__.constructor.apply(this,arguments)}KeyHandlerLivePreview.prototype.clearTimer=function(){KeyHandlerLivePreview.__super__.clearTimer.call(this);clearTimeout(this.live_preview_timer);this.live_preview_timer=null;return this.live_preview_last_input=""};KeyHandlerLivePreview.prototype.livePreviewTimer=function(){var val;val=this.$input.val();if(val!==this.live_preview_last_input&&val.indexOf(config.default_textarea)===-1){_ullog("KeyHandlerPreview livePreviewTimer send event livePreview val="+this.$input.val());this.live_preview_last_input=val;this.fsm.event("livePreview",val)}clearTimeout(this.live_preview_timer);this.live_preview_timer=null;return this.live_preview_timer=setTimeout(this.livePreviewTimer,KeyHandler.PREVIEW_INTERVAL)};KeyHandlerLivePreview.prototype.handler=function(e){KeyHandlerLivePreview.__super__.handler.call(this,e);return this.live_preview_timer=this.live_preview_timer||setTimeout(this.livePreviewTimer,KeyHandler.PREVIEW_INTERVAL)};return KeyHandlerLivePreview}(KeyHandler);Position=function(){function Position(){var ref1,ref2,ref3,ref4;this.pointer="userlikeArrow-"+button.popupOrientation();this.$button=jq(button.el());this.$popup=jq("#userlikePopup");this.drag=session.getDrag()||{};if(!this.drag.snap&&config.drag_enabled&&((ref1=this.drag)!=null?(ref2=ref1.pos)!=null?ref2.top:void 0:void 0)!=null&&((ref3=this.drag)!=null?(ref4=ref3.pos)!=null?ref4.left:void 0:void 0)!=null){_ullog("Position::ctor use stored position top="+this.drag.pos.top+" left="+this.drag.pos.left+" snap="+this.drag.snap)}else{this.snap();_ullog("Position::ctor use button position")}if(config.drag_enabled){this.setupEvents()}}Position.prototype.snap=function(){_ullog("Position::snap");this.drag.snap=true;this.drag.down=false;this.$popup.addClass(this.pointer);return session.persistDrag(this.drag)};Position.prototype.update=function(){if(!isElementInViewport(this.$popup)&&!this.drag.down){this.snap()}if(this.drag.snap){this.drag.pos=button.popupPosition()}try{return this.$popup.css(this.drag.pos)}catch(_error){e=_error;return _ullog("Position:update error=",e," drag=",this.drag)}};Position.prototype.setupEvents=function(){var $area;$area=jq(".userlikeDrag");$area.css({cursor:"move"});$area.on("mousedown",function(_this){return function(e){_this.startDrag(e);return false}}(this)).on("touchstart",function(_this){return function(e){_this.startDrag(e);return false}}(this));return jq(document).on("mouseup",function(_this){return function(e){return _this.stopDrag(e)}}(this)).on("mousemove",function(_this){return function(e){return _this.moveDrag(e)}}(this)).on("touchend",function(_this){return function(e){return _this.stopDrag(e)}}(this)).on("touchmove",function(_this){return function(e){return _this.moveDrag(e)}}(this))};Position.prototype.getMousePosition=function(e){var posx,posy,ref1,t;posx=0;posy=0;if(!e){e=window.event}if(((ref1=e.originalEvent)!=null?ref1.targetTouches:void 0)!=null){t=e.originalEvent.targetTouches[0];posx=t.clientX;posy=t.clientY}else if(e.pageX||e.pageY){posx=e.pageX;posy=e.pageY}else if(e.clientX||e.clientY){posx=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;posy=e.clientY+document.body.scrollTop+document.documentElement.scrollTop}return{x:posx,y:posy}};Position.prototype.startDrag=function(e){var start;start=this.$popup.position();this.drag={mouse:getMousePosition(e),start:{left:start.left,top:start.top-jq(document).scrollTop()},down:true,snap:false};this.$popup.removeClass(this.pointer);return session.persistDrag(this.drag)};Position.prototype.stopDrag=function(e){if(!this.drag.down){return}this.drag.down=false;if(overlapDiv(this.$button,this.$popup)){this.snap()}this.update();return session.persistDrag(this.drag)};Position.prototype.moveDrag=function(e){var pos;if(!this.drag.down){return}pos=getMousePosition(e);this.drag.pos={left:pos.x-this.drag.mouse.x+this.drag.start.left,top:pos.y-this.drag.mouse.y+this.drag.start.top};this.update();return session.persistDrag(this.drag)};return Position}();Popup=function(){Popup.TIMEOUT=5e3;Popup.FADE=50;function Popup(){var css,ref1,userlikestyle_element;this.incoming_messages=0;this.last_chatstate=null;this.screenshot=new Screenshot;this.tab_active=true;css=userlike_css.replace("{{FONT}}",(ref1=config.font)!=null?ref1.split(":")[0]:void 0);userlikestyle_element=document.createElement("style");userlikestyle_element.type="text/css";if(userlikestyle_element.styleSheet){userlikestyle_element.styleSheet.cssText=css}else{userlikestyle_element.appendChild(document.createTextNode(css))}document.getElementsByTagName("head")[0].appendChild(userlikestyle_element)}Popup.prototype.inject=function(callback){var div,el,j,len1,ref,ref1,trial,wait;div=document.createElement("div");div.innerHTML=userlike_html.replace("{{POWEREDBY_LINK}}",config.poweredby_link).replace("{{POWEREDBY_SLOGAN}}",config.poweredby_slogan);div.className="userlike";ref1=["body","frameset","head"];for(j=0,len1=ref1.length;j<len1;j++){ref=ref1[j];el=document.getElementsByTagName(ref);if(el[0]){el[0].appendChild(div);break}}trial=100;wait=function(){if((!document.getElementById("userlike")||!document.getElementById("userlikeSubmitOfflineMessage")||!document.getElementById("userlikeSubmitRegister"))&&trial--){_ullog("Popup::inject wait");return window.setTimeout(wait,300)}else{return callback(!document.getElementById("userlike")&&!document.getElementById("userlikeSubmitOfflineMessage")&&!document.getElementById("userlikeSubmitRegister"))}};return wait()};Popup.prototype.setup=function(){this.setupDomReferences();this.setupEventHandlers();this.setupMobileVersion();this.setupLayout();this.setupDebranding();this.setupLogo();this.position=new Position;this.position.update();this.setView(jq("#userlikeIdle"));this.keyhandler=(new KeyHandlerFactory).get(this.$input,fsm);return this.smileyPopover=new SmileyPopover};Popup.prototype.setupDomReferences=function(){this.$popup=jq("#userlikePopup");this.$input=jq("#userlikeChatTextarea");this.$content=jq("#userlikeContentView");this.$header=jq("#userlikeChatViewHeadline");this.$data_privacy=jq("#userlikeDataPrivacy");this.$data_privacy_link=jq("#userlikeDataPrivacy a");this.$message_headline=jq("#userlikeMessageHeadline");return this.$chat_state_area=jq("#userlikeChatState")};Popup.prototype.setupEventHandlers=function(){jq("#userlikeClose").click(function(_this){return function(){fsm.event("closeButton");return false}}(this));jq("#userlikeMinimize").click(function(_this){return function(){fsm.event("minimizeButton");return false}}(this));jq("#userlikeSubmitRegister").click(function(_this){return function(){fsm.event("submitButton");return false}}(this));jq("#userlikeSubmitTranscript").click(function(_this){return function(){fsm.event("submitButton");return false}}(this));jq("#userlikeSubmitDisclaimer").click(function(_this){return function(){fsm.event("submitButton");return false}}(this));jq("#userlikeSubmitOfflineMessage").click(function(_this){return function(){fsm.event("submitButton");return false}}(this));jq("#userlikeSubmitFeedback").click(function(_this){return function(){fsm.event("submitButton");return false}}(this));jq("#userlikeSubmitFacebookConnect").click(function(_this){return function(){FB.login(function(response){return fsm.event("facebookLoginResponse",response)},{scope:"email"});return false}}(this));jq(".userlikeFieldsetWrapper div").on("click",function(e){var $select;$select=jq(e.currentTarget).data("select")||jq(e.currentTarget).parent().data("select");if($select){fsm.event("select",$select)}return false});jq("#userlikeRegisterForm,#userlikeOfflineEmail,#userlikeOfflineName,#userlikeFeedbackForm,#userlikeTranscriptForm").keypress(function(_this){return function(e){if(e.which===13){return fsm.event("submitButton")}}}(this));jq(window).resize(function(_this){return function(){return _this.position.update()}}(this));jq("body").bind("gesturestart",function(_this){return function(){return _this.position.update()}}(this));jq(window).bind("focus",function(_this){return function(){_ullog("Popup::focus");return _this.tab_active=true}}(this));return jq(window).bind("blur",function(_this){return function(){_ullog("Popup::blur");return _this.tab_active=false}}(this))};Popup.prototype.isMobile=function(){return is_mobile&&config.mobile_reduced_size};Popup.prototype.needShrink=function(){return config.hide_poweredby&&!config.show_data_privacy_link};Popup.prototype.setupMobileVersion=function(){if(this.isMobile()){return jq("#userlike").addClass("userlikeMobile")}};Popup.prototype.setupLayout=function(){var c;c=rgb(config.colorscheme_hi);jq("#userlike a:not(#userlikePoweredByLink)").each(function(_this){return function(i,el){return jq(el).css({color:c})}}(this));jq("#userlikeSubmitRegister,#userlikeSubmitOfflineMessage,#userlikeSubmitTranscript,#userlikeSubmitFacebookConnect,#userlikeSubmitDisclaimer,#userlikeSubmitFeedback").each(function(_this){
return function(i,el){return jq(el).css({"background-color":c})}}(this));this.$content.css({border:"1px solid "+c});this.$header.text(config.custom_header);if(config.show_data_privacy_link){this.$data_privacy.show();this.$data_privacy_link.attr("href",config.data_privacy_link);return this.$data_privacy_link.text(config.data_privacy_name)}else{return this.$data_privacy.hide()}};Popup.prototype.setupLogo=function(){if(config.logo_mode==="hide"){return this.$popup.removeClass("userlikeShowLogo")}else if(config.logo_mode==="url"){return jq("#userlikeLogo").css({background:"url('"+config.logo_url+"')"})}else if(config.logo_mode==="upload"){return jq("#userlikeLogo").css({background:"url('//"+config.logo_upload_url+"')"})}};Popup.prototype.setupDebranding=function(){if(config.hide_poweredby){return this.$popup.addClass("userlikeHidePoweredBy")}};Popup.prototype.isActive=function(){return this.tab_active&&this.$popup.is(":visible")};Popup.prototype.hideTab=function(callback){return jq("#userlikeTab").fadeOut(Popup.FADE,callback)};Popup.prototype.hide=function(callback){return this.$popup.fadeOut(Popup.FADE,function(){tracking_event.trigger("window_invisible");return callback()})};Popup.prototype.show=function(callback){return this.transition(this.view,callback)};Popup.prototype.reset=function(){button.clear();if(config.favicon_enabled){return setBubble(0)}};Popup.prototype.close=function(callback){return this.hide(function(_this){return function(){_this.reset();_this.view.hide();_this.$content.find("dl").children().remove();_this.$input.val("");return callback()}}(this))};Popup.prototype.setView=function(next_view){var height;this.view=next_view;if(this.isMobile()){height=this.view.data("mobile-height")}else{height=this.view.data("height")}if(this.needShrink()){height-=this.view.data("shrink")}return height};Popup.prototype.transition=function(next_view,callback){var height;_ullog("Popup::transition next="+next_view.attr("id"));if(!this.$popup){this.setup()}if(!this.view.is(next_view)){this.view.stop().hide()}if(!this.$popup.is(":visible")){tracking_event.trigger("window_visible")}height=this.setView(next_view);this.$popup.css({height:height+"px"});this.position.update();this.$popup.fadeIn({duration:Popup.FADE,queue:false});return this.view.fadeIn({duration:Popup.FADE,queue:false,complete:callback})};Popup.prototype.showProgressView=function(callback){return this.transition(jq("#userlikeProgress"),callback)};Popup.prototype.showMessageView=function(text,callback){_ullog("Popup::showMessageView "+text);jq("#userlikeMessageHeadline").text(text);return this.transition(jq("#userlikeMessage"),callback)};Popup.prototype.showTransfer=function(callback){this.reset();return this.showMessageView(config.feedback_transfer,callback)};Popup.prototype.showExpiredWarning=function(callback){this.reset();return this.showMessageView(config.feedback_expired,callback)};Popup.prototype.showNoCookiesMessage=function(callback){this.reset();return this.showMessageView(config.feedback_no_cookies,callback)};Popup.prototype.showErrorMessage=function(callback){this.reset();return this.showMessageView(config.feedback_error,callback)};Popup.prototype.showOfflineMessageSent=function(callback){this.reset();return this.showMessageView(config.offline_message_response,callback)};Popup.prototype.showOfflineMessageView=function(callback){this.reset();return this.showMessageView(config.feedback_offline,callback)};Popup.prototype.showOfflineMessageForm=function(callback){this.reset();jq("#userlikeScreenshotLabel").text(config.offline_message_send_screenshot);this.clearInput("#userlikeOfflineEmail",config.offline_message_enter_email,session.get("email"));this.clearInput("#userlikeOfflineName",config.offline_message_enter_name,session.get("name"));this.clearInput("#userlikeOfflineTextarea",config.offline_message_default_textarea,config.offline_message_default_textarea);jq("#userlikeOfflineMessageHeadline").text(config.offline_message_header);jq("#userlikeOfflineMessageText").text(config.offline_message_body);if(!config.screenshot_enabled){jq("#userlikeScreenshotWrapper").hide()}return this.transition(jq("#userlikeOfflineMessage"),callback)};Popup.prototype.appendOfflineMessageForm=function(text){var $t;$t=jq("#userlikeOfflineTextarea");$t.trigger("focus");return $t.val(t.val()+text+"\n")};Popup.prototype.validateOfflineMessage=function(){var email,message,name;email=this.getInput("#userlikeOfflineEmail");name=this.getInput("#userlikeOfflineName");message=this.getInput("#userlikeOfflineTextarea");if(!session.validateName(name)){jq("#userlikeOfflineName").focus();return false}if(!session.validateEmail(email)){jq("#userlikeOfflineEmail").focus();return false}if(!message){jq("#userlikeOfflineTextarea").focus();return false}if(message.length>1e4){jq("#userlikeOfflineTextarea").focus();return false}session.set("email",email);session.set("name",name);return true};Popup.prototype.requestedScreenshot=function(){return jq("#userlikeScreenshotCheckbox").attr("checked")};Popup.prototype.sendOfflineMessage=function(){var custom,info,message,packet;message=this.getInput("#userlikeOfflineTextarea");jq("#userlikeOfflineTextarea").val("");info=session.packet();try{custom=JSON.stringify(info.custom)}catch(_error){e=_error;custom=void 0}packet={chat_widget_id:config.chat_widget_id,customer_id:config.customer_id,client_name:info.client_name,client_email:info.client_email,visits:info.visits,page_impressions:info.page_impressions,url:info.url,message:message,custom:custom};return jq.ajax({url:protocol()+"api.userlike.com/api/client/message/offline_message/",data:packet,dataType:"jsonp",success:function(_this){return function(resp){return fsm.event("success",resp)}}(this),error:function(_this){return function(resp){return fsm.event("error",resp)}}(this)})};Popup.prototype.takeOfflineScreenshot=function(){return this.screenshot.take(function(err){if(err){return fsm.event("screenshotError")}else{return fsm.event("screenshotTaken")}})};Popup.prototype.sendOfflineScreenshot=function(id){return this.screenshot.attachToOfflineMessage(id,function(){return fsm.event("screenshotSent")})};Popup.prototype.takeScreenshot=function(callback){return this.screenshot.take(function(err){if(err){return fsm.event("screenshotError",{callback:callback})}else{return fsm.event("screenshotTaken",{callback:callback})}})};Popup.prototype.sendScreenshot=function(callback){return this.screenshot.sendToOperator(session.get("meta_id"),function(err,url){if(err){return fsm.event("screenshotError",{callback:callback})}else{return fsm.event("screenshotSent",{callback:callback,url:url})}})};Popup.prototype.showRegisterFormFacebook=function(callback){jq("#userlikeSubmitFacebookConnect").show();return this.showRegister(callback)};Popup.prototype.showRegisterForm=function(callback){jq("#userlikeSubmitFacebookConnect").hide();return this.showRegister(callback)};Popup.prototype.showRegister=function(callback){var height,i,j,len1,ref1;this.clearInput("#userlikeRegisterEmail",config.register_enter_email,session.get("email"));this.clearInput("#userlikeRegisterName",config.register_enter_name,session.get("name"));jq("#userlikeRegisterHeadline").text(config.register_header);jq("#userlikeRegisterText").text(config.register_body);height=0;ref1=[1,2,3];for(j=0,len1=ref1.length;j<len1;j++){i=ref1[j];if(config["register_additional0"+i+"_enabled"]){jq("#userlikeRegisterAdditional0"+i).show();this.clearInput("#userlikeRegisterAdditional0"+i,config["register_additional0"+i+"_default"],session.get("additional0"+i));height+=60}else{jq("#userlikeRegisterAdditional0"+i).hide()}}jq("#userlikeRegister form").css({height:180+height});jq("#userlikeRegister").data("height",340+height);jq("#userlikeRegister").data("mobile-height",340+height);return this.transition(jq("#userlikeRegister"),callback)};Popup.prototype.validateRegisterForm=function(){var email,name,validateAdditional;validateAdditional=function(_this){return function(){var i,j,len1,ref1,value;ref1=[1,2,3];for(j=0,len1=ref1.length;j<len1;j++){i=ref1[j];if(config["register_additional0"+i+"_enabled"]){value=_this.getInput("#userlikeRegisterAdditional0"+i);if(!config["register_additional0"+i+"_optional"]){if(!value||value.length>100){jq("#userlikeRegisterAdditional0"+i).focus();return false}}if(config["register_additional0"+i+"_optional"]){if(value&&value.length>100){jq("#userlikeRegisterAdditional0"+i).focus();return false}}if(value){session.set("additional0"+i,value)}}}return true}}(this);name=this.getInput("#userlikeRegisterName");email=this.getInput("#userlikeRegisterEmail");if(config.optional_registration){if(!name&&!email){session.del("name");session.del("email")}else if(!email){session.set("name",name);session.del("email")}else if(!session.validateEmail(email)){jq("#userlikeRegisterEmail").focus();return false}else if(!session.validateName(name)){session.del("name");session.set("email",email)}else{session.set("name",name);session.set("email",email)}}else{if(!session.validateName(name)){jq("#userlikeRegisterName").focus();return false}if(!session.validateEmail(email)){jq("#userlikeRegisterEmail").focus();return false}session.set("email",email);session.set("name",name)}return validateAdditional()};Popup.prototype.showTranscriptForm=function(callback){this.clearInput("#userlikeTranscriptEmail",config.register_enter_email,session.get("email"));jq("#userlikeTranscriptHeadline").text(config.transcript_header);jq("#userlikeTranscriptText").text(config.transcript_body);return this.transition(jq("#userlikeTranscript"),callback)};Popup.prototype.validateTranscriptForm=function(){var email;email=this.getInput("#userlikeTranscriptEmail");if(!session.validateEmail(email)){jq("#userlikeTranscriptEmail").focus();return false}return session.set("email",email)};Popup.prototype.showDisclaimer=function(callback){var height;jq("#userlikeDisclaimerHeadline").text(config.disclaimer_headline);jq("#userlikeDisclaimerText").text(config.disclaimer_text);height=200+config.disclaimer_text.length/45*18;jq("#userlikeDisclaimer").data("height",height);jq("#userlikeDisclaimer").data("mobile-height",height);return this.transition(jq("#userlikeDisclaimer"),callback)};Popup.prototype.showOperatorDisconnect=function(){return this.showProgressView(function(_this){return function(){}}(this))};Popup.prototype.showOperatorReconnect=function(){return this.showChatView(true)};Popup.prototype.showRatingView=function(callback){jq("#userlikeRatingHeadline").text(config.rating_question);jq("#userlikeRating span").on("click",function(e){jq("#userlikeRating span").off("click");fsm.event("select",jq(e.currentTarget).text());return false});return this.transition(jq("#userlikeRating"),callback)};Popup.prototype.showFeedbackView=function(callback){this.reset();this.clearInput("#userlikeFeedbackTextarea",config.feedback_default_textarea,config.feedback_default_textarea);jq("#userlikeFeedbackHeadline").text(config.feedback_header);jq("#userlikeFeedbackText").text(config.feedback_body);return this.transition(jq("#userlikeFeedback"),callback)};Popup.prototype.validateFeedback=function(){var feedback_message;feedback_message=this.getInput("#userlikeFeedbackTextarea");if(!feedback_message){fsm.event("cancel");return}if(feedback_message.length>1e4){jq("#userlikeFeedbackTextarea").focus();return}jq.ajax({url:protocol()+"api.userlike.com/api/client/feedback/",data:{operator_id:session.get("operator_id"),customer_id:config.customer_id,chat_meta_id:session.get("meta_id"),feedback_message:feedback_message},dataType:"jsonp"});return fsm.event("done")};Popup.prototype.showFacebookLikeView=function(callback){var b,ref1;jq("#userlikeFacebookLikeHeadline").text(config.facebook_like_headline);if(jq("#userlikeFacebookLikeButton").size()===0){b='<div id="userlikeFacebookLikeButton" class="fb-like" ';b+='data-send="false" data-width="200" ';b+='data-show-faces="'+config.facebook_like_show_faces+'" ';b+='data-action="'+config.facebook_like_verb+'" ';if((ref1=config.facebook_like_href)!=null?ref1.length:void 0){b+='data-href="'+config.facebook_like_href+'" '}b+='data-layout="'+config.facebook_like_layout+'">';jq("#userlikeFacebookLikeWrapper").append(b);_ullog("Popup::showFacebookLikeView: b="+b);try{FB.XFBML.parse(jq("#userlike")[0])}catch(_error){e=_error;_ullog("showFacebookLikeView: err=",e)}}return this.transition(jq("#userlikeFacebookLike"),callback)};Popup.prototype.showTwitterTweetView=function(callback){var b;jq("#userlikeTwitterTweetHeadline").text(config.twitter_headline);jq("#userlikeTwitterTweetButton").remove();b='<div id="userlikeTwitterTweetButton">';if(config.twitter_type==="share"){b+='<a href="https://twitter.com/share" ';b+='data-size="large" ';b+='data-lang="'+config.lang+'" ';b+='class="twitter-share-button" ';b+='data-text="'+config.twitter_share_text+'" ';b+='data-via="'+config.twitter_share_via+'" ';b+='data-hashtags="'+config.twitter_share_hashtag+'" ';if(!config.twitter_share_show_count){b+='data-count="none" '}b+="></a>"}else if(config.twitter_type==="follow"){b+='<a href="https://twitter.com/'+config.twitter_follow_user+'" ';b+='data-size="large" ';b+='data-show-count="false" ';b+='data-lang="'+config.lang+'" ';b+='class="twitter-follow-button" ';if(!config.twitter_follow_show_username){b+='data-show-screen-name="false" '}b+="></a>"}else if(config.twitter_type==="mention"){b+='<a href="https://twitter.com/intent/tweet?screen_name='+config.twitter_mention_user+"&text="+config.twitter_mention_text+'" ';b+='data-size="large" ';b+='data-lang="'+config.lang+'" ';b+='class="twitter-mention-button" ';b+="></a>"}b+="</div>";_ullog("Popup::showTwitterTweetView: b="+b);jq("#userlikeTwitterTweetWrapper").append(b);try{twttr.widgets.load();twttr.events.bind("tweet",function(){return tracking_event.trigger("twitter_tweet_tweeted")})}catch(_error){e=_error;_ullog("showTwitterTweetView: err=",e)}return this.transition(jq("#userlikeTwitterTweet"),callback)};Popup.prototype.showGroupSelect=function(data,callback){var $userlikeGroupSelect,height;height=170;$userlikeGroupSelect=jq("#userlikeGroupSelect");jq("#userlikeGroupSelectHeadline").text(config.group_select_headline);$userlikeGroupSelect.find(".userlikeFieldsetWrapper>div").each(function(i,el){var $el;$el=jq(el);if(i<data.available.length){$el.find("input").removeAttr("checked");$el.find(".userlikeLabel").text(data.available[i].name);$el.show();return height+=24}else{return $el.hide()}});$userlikeGroupSelect.data({height:height},"mobile-height",height);return this.transition($userlikeGroupSelect,callback)};Popup.prototype.showSurveyView=function(prefix,callback){var $userlikeSurvey,height;height=170;$userlikeSurvey=jq("#userlikeSurvey");jq("#userlikeSurveyHeadline").text(config[prefix+"_survey_question"]);$userlikeSurvey.find(".userlikeFieldsetWrapper>div").each(function(i,el){var $el,ref1;$el=jq(el);if((ref1=config[prefix+"_survey_option0"+(i+1)])!=null?ref1.length:void 0){$el.find(".userlikeLabel").text(config[prefix+"_survey_option0"+(i+1)]);$el.find("input").removeAttr("checked");$el.show();return height+=24}else{return $el.hide()}});$userlikeSurvey.data({height:height},"mobile-height",height);return this.transition($userlikeSurvey,callback)};Popup.prototype.showPreSurveyView=function(callback){return this.showSurveyView("pre",callback)};Popup.prototype.showPostSurveyView=function(callback){return this.showSurveyView("post",callback)};Popup.prototype.scrollDown=function(callback){return this.$content.animate({scrollTop:1e4},Popup.FADE,callback)};Popup.prototype.showChatView=function(callback){if(!this.$popup){this.setup()}this.clearInput("#userlikeChatTextarea",config.default_textarea);return this.transition(jq("#userlikeChatView"),function(_this){return function(){return _this.scrollDown(function(){return callback()})}}(this))};Popup.prototype.sendMessage=function(){var j,len1,line,raw_text,ref1,text;text=this.getInput("#userlikeChatTextarea");if(!(text!=null?text.length:void 0)){return}if(text.length>5e3){return this.$input.css({border:"1px solid #d3d4d5"}).delay(200).queue(function(){return jq(this).css({border:"1px solid "+rgb(config.colorscheme_hi)}).dequeue()})}else{raw_text=text;this.$input.val("");text=text.replace(/\r/g,"");ref1=text.split("\n");for(j=0,len1=ref1.length;j<len1;j++){line=ref1[j];this.addMessage("co",config.chat_me,line)}return raw_text}};Popup.prototype.replaceText=function(data){var $el;$el=this.$content.find("dd:last");return $el!=null?$el.text($el.text().replace(data[1],data[2])):void 0};Popup.prototype.checkIframe=function(url){if(session.get("iframe_blacklist_"+hashCode(url))!==void 0){return}return loadScript("api.userlike.com/api/client/iframe/?url="+encodeURIComponent(url)+"&callback=userlikeCallbackIframeCheck",function(){})};Popup.prototype.injectIframe=function(url){var $iframe;if(session.get("iframe_blacklist_"+hashCode(url))||jq.browser.msie){return window.open(url)}$iframe=jq('<div id="userlikePushIframe"><div id="userlikePushIframeClose"></div><div id="userlikePushIframeOpen"></div><div id="userlikeSpinnerIframe"><div id="userlikeBounce1"></div><div id="userlikeBounce2"></div><div id="userlikeBounce3"></div></div><iframe id="userlikePushIframe" src="'+url+'" style="border:none"></div>');jq("#userlikePushIframe").remove();jq("body").append($iframe);jq("#userlikePushIframeClose").click(function(){return jq("#userlikePushIframe").remove()});jq("#userlikePushIframeOpen").click(function(){window.open(url);return jq("#userlikePushIframe").remove()});return setTimeout(function(){return jq("#userlikeSpinnerIframe").remove()},5e3)};Popup.prototype.replaceLinkOffsite=function(url){return'<a style="color: '+rgb(config.colorscheme_hi)+'" href="'+url+'" target="_blank">'+url+"</a>"};Popup.prototype.replaceLinkOnsite=function(url){return'<a style="color: '+rgb(config.colorscheme_hi)+'" href="'+url+'">'+url+"</a>"};Popup.prototype.replaceLinkIframe=function(url){this.checkIframe(url);return'<a style="color: '+rgb(config.colorscheme_hi)+'" href="javascript:void(0)" onclick="userlikeInjectIframe(\''+encodeURIComponent(url)+"');return false\">"+url+"</a>"};Popup.prototype.replaceEmails=function(email){return'<a style="color: '+rgb(config.colorscheme_hi)+'" href="mailto:'+email+'">'+email+"</a>"};Popup.prototype.replaceUrls=function(item){var replacement,up;up=new UrlParser(item,true);if(up.isOffsite()){if(config.links_offsite==="new"){replacement=this.replaceLinkOffsite(up.original())}else if(config.links_offsite==="same"){replacement=this.replaceLinkOnsite(up.original())}else{replacement=this.replaceLinkIframe(up.url_inherit())}}else{if(config.links_onsite==="new"){replacement=this.replaceLinkOffsite(up.original())}else{replacement=this.replaceLinkOnsite(up.original())}}return replacement};Popup.prototype.replaceLinks=function(text){text=this.regex_replace(text,regex_email,this.replaceEmails);text=this.regex_replace(text,regex_url_full,this.replaceUrls);return text=this.regex_replace(text,regex_url_simple,this.replaceUrls)};Popup.prototype.regex_replace=function(text,regex,replace_func){var end,item,match,replacement,start,text_end,text_start;regex=new RegExp(regex.source,"i");while(true){match=regex.exec(text);if(match){start=match.index;end=start+match[0].length;item=match[0];if(/^\s/.test(item)){start+=1;item=item.trim()}replacement=replace_func.apply(this,[item]);if(replacement){text_start=text.substr(0,start);text_end=text.substr(end);text=text_start+replacement+text_end;continue}}break}return text};Popup.prototype.escapeTag=function(text){return(""+text).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};Popup.prototype.escapeUrl=function(text){return(""+text).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};Popup.prototype.replaceNewlines=function(text){return(""+text).replace(/(?:\r\n|\r|\n)/g,"<br />")};Popup.prototype.addMessage=function(type,name,text){text=this.escapeTag(text);text=emotify(text.replace(/&gt;/g,">"));text=this.replaceLinks(text);text=this.replaceNewlines(text);this.addToContent(type,name,text);if(type==="co"){this.incoming_messages=0}else{this.incoming_messages++}if(config.favicon_enabled){return setBubble(this.incoming_messages)}};Popup.prototype.addToContent=function(type,name,text){var color,last;if(type==="ct"){this.$chat_state_area.empty()}last=this.$content.find("dt").last();if(last.size()&&last.hasClass(type)){this.$content.children("dl").append(jq("<dd>").html(text))}else{color=type==="ct"?rgb(config.text_color):rgb(config.colorscheme_hi);this.$content.children("dl").append(jq("<dt>").addClass(type).addClass("userlikename").css({color:color}).text(name+":"));this.$content.children("dl").append(jq("<dd>").html(text))}return this.$content.scrollTop(1e4)};Popup.prototype.showChatState=function(text){var $el;this.$chat_state_area.empty();$el=jq("<div>").text(text).css({opacity:.1});this.$chat_state_area.append($el);$el.animate({opacity:1},Popup.FADE);return $el.delay(6e4).fadeOut(Popup.FADE)};Popup.prototype.showInfoMessage=function(text){this.$chat_state_area.empty();this.$content.children("dl").append(jq("<dt>").text(text));return this.$content.scrollTop(1e4)};Popup.prototype.receiveDownload=function(from,url,name){return this.addToContent("ct",from,config.feedback_download_link+(' <a style="color: '+rgb(config.colorscheme_hi)+'" href="'+url+'" target="_blank">'+name+"</a>"))};Popup.prototype.receiveMessage=function(from,body){return this.addMessage("ct",from,body)};Popup.prototype.stateComposing=function(from){return this.showChatState(config.chat_is_typing.replace("{{name}}",from))};Popup.prototype.statePaused=function(from){return this.showChatState(config.chat_stopped_typing.replace("{{name}}",from))};Popup.prototype.showConnectView=function(callback){return this.showChatView(function(_this){return function(){_this.$content.children("dl").append(jq("<dt>",{"class":"connect-message"}).css({color:rgb(config.text_color)}).text(config.connect_message));_this.$content.scrollTop(1e4);return callback()}}(this))};Popup.prototype.displaySlot=function(name,url,text,callback){_ullog("displaySlot name="+name+" text="+text+" url="+url);if(!this.$popup){this.setup()}if(config.operator_picture_style!=="off"){this.$content.children("dl").append(jq("<dt>").append(jq("<div>",{"class":"userlikeOperatorPicture"+capitalize(config.operator_picture_style)}).css({"background-image":"url('"+url+"')"})))}this.$content.find(".connect-message").remove();this.$content.children("dl").append(jq("<dt>",{"class":"ct"}).css({color:rgb(config.text_color)}).text(text.replace("{{name}}",name)));this.$content.scrollTop(1e4);this.enable();return callback()};Popup.prototype.playbackSlot=function(buffer){var item,j,len1,results1;results1=[];for(j=0,len1=buffer.length;j<len1;j++){item=buffer[j];if(item.type==="co"){results1.push(this.addMessage("co",config.chat_me,item.body))}else if(item.type==="ct"){results1.push(this.addMessage("ct",item.from,item.body))}else if(item.type==="op"){results1.push(this.displaySlot(item.from,item.url,item.from,function(){}))}else{results1.push(void 0)}}return results1};Popup.prototype.disable=function(){return jq("#userlikeTextarea").attr("disabled","disabled")};Popup.prototype.enable=function(){return jq("#userlikeTextarea").removeAttr("disabled")};Popup.prototype.getInput=function(name){var $input;$input=jq(name);if($input.val()===$input.data("default")){return void 0}else{return $input.val()}};Popup.prototype.clearInput=function(name,def,val){var $e;$e=jq(name);if(!val){val=def}$e.data("default",def);if(!$e.val().length&&!$e.is(":focus")){$e.val(val);$e.css({color:rgb(config.text_color)})}$e.focus(function(){$e=jq(this);if($e.val()===def){$e.val("").css({color:"#4b4d4f"})}return $e.css({border:"1px solid "+rgb(config.colorscheme_hi)})});return $e.blur(function(){$e=jq(this);if($e.val()===""){$e.val(def).css({color:rgb(config.text_color)})}return $e.css({border:"1px solid #d3d4d5"})})};return Popup}();SmileyPopover=function(){SmileyPopover.prototype.el_id="userlikeSmileyPopover";SmileyPopover.prototype.is_visible=false;SmileyPopover.prototype.textarea_caret_postion=null;SmileyPopover.prototype.template='<span style="cursor:pointer" data-code="$$code">\n  <img title="$$name" class="userlikeSmiley" src="//userlike-cdn-client.s3-eu-west-1.amazonaws.com/$$image">\n</span>';function SmileyPopover(){this.hide=bind(this.hide,this);this.show=bind(this.show,this);this.onSmileyClick=bind(this.onSmileyClick,this);this.onPopupButtonClick=bind(this.onPopupButtonClick,this);this.$el=jq("#"+this.el_id);this.$el.on("click",this.onPopupButtonClick);this.$smiley_list=null}SmileyPopover.prototype.onPopupButtonClick=function(){if(this.is_visible){return this.hide()}else{return this.show()}};SmileyPopover.prototype.onSmileyClick=function(e){var clicked_smiley;clicked_smiley=jq(e.currentTarget).data();jq("#userlikeChatTextarea").val(function(_this){return function(i,chatMessage){var chat_message_trimmed,smiley_code_whitespaced,text_with_smiley;chat_message_trimmed=chatMessage.replace(config.default_textarea,"");smiley_code_whitespaced=" "+clicked_smiley.code+" ";text_with_smiley=insertStringAtIndex(chat_message_trimmed,_this.textarea_caret_postion,smiley_code_whitespaced);_this.textarea_caret_postion+=smiley_code_whitespaced.length;return text_with_smiley}}(this));return this.hide()};SmileyPopover.prototype.show=function(){this.textarea_caret_postion=jq("#userlikeChatTextarea").prop("selectionStart");if(this.$smiley_list!=null){this.$smiley_list.addClass("show")}else{this.compileTemplate();this.$el.after(this.$smiley_list);this.$smiley_list.find("span").on("click",this.onSmileyClick)}jq(document).on("click.userlikeSmileyPopover",function(_this){return function(e){var $drag_container,$target;$target=jq(e.target);$drag_container=jq(".userlikeDrag");if(!$target.is(_this.$smiley_list)&&!$target.is(_this.$el)&&!$target.is($drag_container)){return _this.hide()}}}(this));return this.is_visible=true};SmileyPopover.prototype.hide=function(){this.$smiley_list.removeClass("show");jq("#userlikeChatTextarea").focus();jq("#userlikeChatTextarea").prop("selectionStart",this.textarea_caret_postion);jq("#userlikeChatTextarea").prop("selectionEnd",this.textarea_caret_postion);jq(document).off("click.userlikeSmileyPopover");return this.is_visible=false};SmileyPopover.prototype.compileTemplate=function(){var list_markup,smiley_list;smiley_list=document.createElement("div");smiley_list.id="userlikeSmileyList";smiley_list.className="show";list_markup="";jq(UL_EMOTICONS).each(function(_this){return function(i,smiley){return list_markup+=_this.template.replace("$$code",smiley.code).replace("$$name",smiley.name).replace("$$image",smiley.image)}}(this));smiley_list.innerHTML=list_markup;this.$smiley_list=jq(smiley_list);return this.$smiley_list};return SmileyPopover}();WidgetGoal=function(){function WidgetGoal(){}WidgetGoal.prototype.check=function(){var j,len1,ref1,ref2,results1,target;if(!config.goals.length){return _ullog("WidgetGoal::check no goals")}else{ref1=config.goals;results1=[];for(j=0,len1=ref1.length;j<len1;j++){target=ref1[j];_ullog("WidgetGoal::check "+target.url+" == "+document.location.href);if(((ref2=document.location.href)!=null?ref2.indexOf(target.url):void 0)>-1){_ullog("WidgetGoal::check match "+target.url);if(session.get("uuid")&&!session.getGoal(target.key)){session.setGoal(target.key);session.set("goal",target.name);this.send(target);fsm.event("goalReached")}break}else{results1.push(void 0)}}return results1}};WidgetGoal.prototype.send=function(target){var img,url;url="//api.userlike.com/api/client/goal/";url+="?chat_meta_id="+encodeURIComponent(session.get("meta_id"));url+="&customer_id="+encodeURIComponent(config.customer_id);url+="&goal_key="+encodeURIComponent(target.key);url+="&_="+ +new Date;_ullog("WidgetGoal::send "+url);img=document.createElement("img");img.setAttribute("src",url);img.setAttribute("width",1);img.setAttribute("height",1);return document.body.appendChild(img)};return WidgetGoal}();Rating=function(){function Rating(){}Rating.prototype.send=function(rate){var url;url="//api.userlike.com/api/client/rate/";_ullog("Rating::send "+url);return jq.ajax({url:url,dataType:"jsonp",data:{operator_id:session.get("operator_id"),customer_id:config.customer_id,chat_meta_id:session.get("meta_id"),rate:rate}})};return Rating}();Survey=function(){function Survey(){}Survey.prototype.send=function(option,index){var url;url="//api.userlike.com/api/client/survey/";_ullog("Survey::send "+url);return jq.ajax({url:url,dataType:"jsonp",data:{operator_id:session.get("operator_id"),customer_id:config.customer_id,chat_meta_id:session.get("meta_id"),option:option,index:index}})};return Survey}();Slot=function(){function Slot(){this.socket=null;this.requests=[];this.queue_timer=null;this.cache=null;this.timer=null}Slot.prototype.resetCache=function(){_ullog("Slot::resetCache");return this.cache=null};Slot.prototype.setCache=function(data){_ullog("Slot::setCache data=",data);this.cache=data;clearTimeout(this.timer);return this.timer=setTimeout(function(_this){return function(){return _this.resetCache()}}(this),15*1e3)};Slot.prototype.checkCache=function(callback){if(this.cache){_ullog("Slot::checkCache found callback="+callback+" data=",this.cache);eval(callback)(this.cache);return true}return false};Slot.prototype.checkButton=function(jsonp_callback){if(this.checkCache(jsonp_callback)){return}return loadScript("api.userlike.com/api/chat/button/check/?customer_id="+config.customer_id+"&chat_widget_id="+config.chat_widget_id+"&callback="+jsonp_callback,function(){})};Slot.prototype.checkAvailable=function(jsonp_callback){if(this.checkCache(jsonp_callback)){return}return loadScript("api.userlike.com/api/chat/slot/available/?customer_id="+config.customer_id+"&chat_widget_id="+config.chat_widget_id+"&callback="+jsonp_callback,function(){})};Slot.prototype.checkProactive=function(jsonp_callback){var operator_id;operator_id=session.getOperatorBinding(config.operator_group_id);if(operator_id){return loadScript("api.userlike.com/api/chat/slot/proactive/?customer_id="+config.customer_id+"&chat_widget_id="+config.chat_widget_id+"&operator_id="+operator_id+"&operator_group_id="+config.operator_group_id+"&callback="+jsonp_callback,function(){})}else{return loadScript("api.userlike.com/api/chat/slot/proactive/?customer_id="+config.customer_id+"&chat_widget_id="+config.chat_widget_id+"&operator_group_id="+config.operator_group_id+"&callback="+jsonp_callback,function(){})}};Slot.prototype.checkPassiveConnect=function(jsonp_callback){var group_select_id,operator_id;group_select_id=session.get("group_select_id");if(group_select_id){return loadScript("api.userlike.com/api/chat/slot/passive/?customer_id="+config.customer_id+"&chat_widget_id="+config.chat_widget_id+"&operator_group_id="+group_select_id+"&callback="+jsonp_callback,function(){})}else{operator_id=session.getOperatorBinding(config.operator_group_id);if(operator_id){return loadScript("api.userlike.com/api/chat/slot/passive/?customer_id="+config.customer_id+"&chat_widget_id="+config.chat_widget_id+"&operator_id="+operator_id+"&operator_group_id="+config.operator_group_id+"&callback="+jsonp_callback,function(){})}else{return loadScript("api.userlike.com/api/chat/slot/passive/?customer_id="+config.customer_id+"&chat_widget_id="+config.chat_widget_id+"&operator_group_id="+config.operator_group_id+"&callback="+jsonp_callback,function(){})}}};Slot.prototype.checkSlotStats=function(callback){var jsonp_callback;jsonp_callback="userlikeCallback"+ +new Date;window[jsonp_callback]=function(data){return callback(data)};return loadScript("api.userlike.com/api/chat/slot/stats/?customer_id="+config.customer_id+"&chat_widget_id="+config.chat_widget_id+"&callback="+jsonp_callback,function(){})};Slot.prototype.checkOperatorStatus=function(callback){var jsonp_callback;jsonp_callback="userlikeCallbackOperatorStatus";window[jsonp_callback]=function(data){return callback(data)};return loadScript("api.userlike.com/api/chat/operator/status/?customer_id="+config.customer_id+"&callback="+jsonp_callback,function(){});
};Slot.prototype.sendTranscript=function(callback){var jsonp_callback;jsonp_callback="userlikeCallbackSendTranscript";loadScript("api.userlike.com/api/client/message/chat_meta/email/?customer_id="+config.customer_id+"&chat_meta_id="+session.get("meta_id")+"&client_email="+encodeURIComponent(session.get("email"))+"&client_uuid="+encodeURIComponent(session.get("uuid"))+"&callback="+jsonp_callback,function(){});return window[jsonp_callback]=function(data){return callback(data)}};Slot.prototype.create=function(data){var packet;if(data.operator_group_id){packet={customer_id:config.customer_id,chat_widget_id:config.chat_widget_id,operator_group_id:data.operator_group_id,proactive:false,info:session.packet()}}else{packet={customer_id:config.customer_id,chat_widget_id:config.chat_widget_id,operator_id:session.getOperatorBinding(config.operator_group_id),operator_group_id:config.operator_group_id,info:session.packet(),proactive:data.proactive}}return this.queue("emit","create",packet,function(resp){return fsm.event("slotCreated",resp)})};Slot.prototype.direct=function(data){var packet;packet={customer_id:config.customer_id,chat_widget_id:config.chat_widget_id,operator_id:data.operator_id,info:session.packet(),operator_group_id:config.operator_group_id,proactive:false};return this.queue("emit","direct",packet,function(resp){return fsm.event("slotCreated",resp)})};Slot.prototype.reconnect=function(callback){var packet;packet={id:session.get("id"),info:session.packet()};return this.queue("emit","reconnect",packet,function(resp){return fsm.event("slotReconnceted",resp)})};Slot.prototype["switch"]=function(callback){var packet;packet={id:session.get("id"),info:session.packet()};return this.queue("emit","switch",packet,function(resp){return fsm.event("slotSwitched",resp)})};Slot.prototype.playback=function(){return this.queue("emit","playback",null,function(data){return fsm.event("slotPlayback",data)})};Slot.prototype.wakeup=function(){var packet;packet={id:session.get("id"),info:session.packet()};return this.queue("emit","wakeup",packet,function(data){return fsm.event("wakeupDone",data)})};Slot.prototype.disconnect=function(){_ullog("Slot::disconnect");clearInterval(this.queue_timer);if(this.socket){try{this.socket.removeAllListeners("disconnect");this.socket.removeAllListeners("connect");this.socket.removeAllListeners("connecting");this.socket.removeAllListeners("reconnect");this.socket.removeAllListeners("reconnecting");this.socket.disconnect()}catch(_error){e=_error;_ullog("Slot::disconnect raised an exception ",e)}return delete this.socket}};Slot.prototype.queue=function(func,command,data,callback){return this.requests.push([func,command,data,callback])};Slot.prototype.emit=function(name,data,callback){return this.socket.emit(name,data,callback)};Slot.prototype.connect=function(){var port,transport;try{if(jq.browser.msie&&parseInt(jq.browser.version)<10){transport="jsonp-polling"}else{transport="xhr-polling"}if(is_ssl()){port="443"}else{port="80"}this.socket=io.connect(protocol()+"www.userlike.com",{resource:"chat","connect timeout":5e3,reconnect:true,"reconnection delay":100,"reconnection limit":1e3,"max reconnection attempts":120,"force new connection":true,"sync disconnect on unload":true,"try multiple transports":false,transports:[transport],port:port},_ullog("Slot:connect transport="+transport+" port="+port))}catch(_error){e=_error;_ullog("Slot::connect raised an exception ",e);fsm.signal("error");return}this.queue_timer=setInterval(function(_this){return function(){var r;if(_this.requests.length){r=_this.requests.shift();return _this[r[0]](r[1],r[2],r[3])}}}(this),100);this.socket.on("error",function(){return fsm.signal("error")});this.socket.on("connect",function(){return fsm.signal("connect")});this.socket.on("connecting",function(transport){return fsm.signal("connecting",transport)});this.socket.on("connect_failed",function(){return fsm.signal("connectFailed")});this.socket.on("disconnect",function(){return fsm.signal("disconnect")});this.socket.on("reconnect",function(){return fsm.signal("reconnect")});this.socket.on("reconnecting",function(delay,count){return fsm.signal("reconnecting",{delay:delay,count:count})});this.socket.on("reconnect_failed",function(_this){return function(){return fsm.signal("reconnectFailed")}}(this));this.socket.on("message",function(data){return fsm.event("receiveMessage",data)});this.socket.on("composing",function(data){return fsm.event("receiveComposing",data)});this.socket.on("paused",function(data){return fsm.event("receivePaused",data)});this.socket.on("block",function(){return fsm.signal("receiveBlock")});this.socket.on("replace",function(data){return fsm.event("receiveReplaceText",data)});this.socket.on("name",function(data){return fsm.event("receiveName",data)});this.socket.on("email",function(data){return fsm.event("receiveEmail",data)});this.socket.on("additional",function(data){return fsm.event("receiveAdditional",data)});this.socket.on("offline",function(data){return fsm.signal("receiveOffline")});this.socket.on("inactive",function(data){return fsm.event("receiveInactive")});this.socket.on("operator_disconnect",function(data){return fsm.signal("receiveOperatorDisconnect")});this.socket.on("operator_reconnect",function(data){return fsm.signal("receiveOperatorReconnect")});this.socket.on("quit",function(){return fsm.signal("receiveQuit")});this.socket.on("switch",function(){return fsm.signal("receiveSwitch")});this.socket.on("screenshot",function(_this){return function(data,callback){return fsm.signal("receiveScreenshot",callback)}}(this));this.socket.on("slot",function(_this){return function(data){return fsm.signal("receiveSlot",data)}}(this));this.socket.on("forward",function(_this){return function(data){return fsm.signal("receiveForward",data)}}(this));this.socket.on("push",function(_this){return function(data,callback){data.callback=callback;return fsm.event("receivePush",data)}}(this));this.socket.on("download",function(_this){return function(data){return fsm.event("receiveDownload",data)}}(this));return this.socket.on("hibernate",function(_this){return function(){return fsm.signal("receiveHibernate")}}(this))};return Slot}();Pusher=function(){function Pusher(){this.socket=null}Pusher.prototype.update=function(){_ullog("Pusher::update request pusher connect");return this.socket.emit("update",{customer_id:config.customer_id,info:session.packet(),widget:{data_privacy:config.data_privacy,id:config.chat_widget_id,name:config.name,geo_type:config.geo_type}},function(resp){_ullog("Pusher::update created new pusher session  id="+resp.id);return session.set("pusher",resp.id)})};Pusher.prototype.disconnect=function(){_ullog("Pusher::disconnect");if(this.socket){try{this.socket.removeAllListeners("disconnect");this.socket.removeAllListeners("connect");this.socket.removeAllListeners("connecting");this.socket.removeAllListeners("reconnect");this.socket.removeAllListeners("reconnecting");this.socket.disconnect()}catch(_error){e=_error;_ullog("Pusher::disconnect raised an exception ",e)}return delete this.socket}};Pusher.prototype.connect=function(){var port,transport;try{if(jq.browser.msie&&parseInt(jq.browser.version)<10){transport="jsonp-polling"}else{transport="xhr-polling"}if(is_ssl()){port="443"}else{port="80"}this.socket=io.connect(protocol()+"www.userlike.com",{resource:"pusher","connect timeout":5e3,reconnect:true,"reconnection delay":100,"reconnection limit":1e3,"max reconnection attempts":120,"force new connection":true,"sync disconnect on unload":true,"try multiple transports":false,transports:[transport],port:port},_ullog("Pusher:connect transport="+transport+" port="+port))}catch(_error){e=_error;_ullog("Pusher::connect raised an exception ",e);fsm.signal("error");return}this.socket.on("error",function(){return fsm.signal("error")});this.socket.on("connect",function(){return fsm.signal("connect")});this.socket.on("disconnect",function(){return fsm.signal("disconnect")});this.socket.on("reconnect",function(){return fsm.signal("reconnect")});this.socket.on("reconnecting",function(delay,count){return fsm.signal("reconnecting",{delay:delay,count:count})});this.socket.on("pick",function(data){return fsm.event("pick",data)});return this.socket.on("ban",function(data){return fsm.event("ban",data)})};return Pusher}();Singleton=function(){var instance;function Singleton(){}instance=null;Singleton.get=function(){if(this.instance==null){this.instance=new this}return this.instance};return Singleton}();App=function(superClass){extend(App,superClass);function App(){return App.__super__.constructor.apply(this,arguments)}App.prototype.run=function(app_key,widget_key,data){fsm=new FSM;return fsm.start({app_key:app_key,widget_key:widget_key,config:unpack(data)})};return App}(Singleton);this.userlikeInit=function(app_key,widget_key,data){return App.get().run(app_key,widget_key,data)};this.userlikeMonitorGoal=function(){return goal!=null?goal.check():void 0};this.userlikeQuitChat=function(){return fsm.event("receiveQuit")};this.userlikeStartChat=function(e){fsm.event("chatButton");return e!=null?e.preventDefault():void 0};this.userlikeChatButton=function(e){fsm.event("chatButton");return e!=null?e.preventDefault():void 0};this.userlikeCloseButton=function(e){fsm.event("closeButton");return e!=null?e.preventDefault():void 0};this.userlikeUpdateAPI=function(){return fsm.event("updateAPI")};this.userlikePushState=function(){return fsm.event("pushstate")};this.userlikeInputEnter=function(e){fsm.event("inputEnter");return e!=null?e.preventDefault():void 0};this.userlikeCheckOperatorStatus=function(callback){return slot.checkOperatorStatus(callback)};this.userlikeCheckSlotStats=function(callback){return slot.checkSlotStats(callback)};this.userlikeRequestOperatorChat=function(operator_id){return fsm.event("directRequest",operator_id)};this.userlikeChatState=function(){return session.getState()};this.userlikeSendEvent=function(name,data){return fsm.event(name,data)};this.userlikeDeleteCookies=function(){session._delete_all();this.userlikeEnableDebug();return window.location.reload()};this.userlikeResetState=function(){session.setState("");session.yieldConfig();return window.location.reload()};this.userlikeGetFsmStateName=function(){return fsm.state.getName()};this.userlikeIsFsmStateFrozen=function(){return fsm.freeze};this.userlikeEnableDebug=function(){return session.set("debug",1)};this.userlikeDisableDebug=function(){return session.set("debug",0)};this.userlikeEnableNoState=function(){return window.userlike.nostate=true};this.userlikeDisableNoState=function(){return window.userlike.nostate=false};this.userlikeRemoteApiModeNormal=function(){return fsm.event("normal")};this.userlikeRemoteApiModeProactivePassive=function(timeout,message){return fsm.event("proactive_passive",{timeout:timeout,message:message})};this.userlikeRemoteApiModeProactiveActive=function(timeout,message){return fsm.event("proactive_active",{timeout:timeout,message:message})};this.userlikeRemoteApiModeProactivePassiveAndRegister=function(timeout,message){return fsm.event("proactive_passive_register",{timeout:timeout,message:message})};this.userlikeRemoteApiModeProactiveActiveAndRegister=function(timeout,message){return fsm.event("proactive_active_register",{timeout:timeout,message:message})};this.userlikeRemoteApiModeRegister=function(){return fsm.event("register")};this.userlikeRemoteApiResetState=function(){return fsm.event("reset")};this.userlikeFacebookLoginCallback=function(response){return fsm.event("facebookLoginResponse",response)};this.userlikeSelectValue=function(v){return fsm.event("select",v)};this.userlikeInjectIframe=function(url){return popup.injectIframe(decodeURIComponent(url))};this.userlikeDebugViews=function(){config.hide_logo=false;config.hide_poweredby=false;config.show_data_privacy_link=true;config.data_privacy_link="test";config.data_privacy_name="Privacy";return loadStage2(function(){return loadScript("connect.facebook.net/"+config.locale+"/all.js",function(){var automatic;facebook=true;automatic=false;return loadScript("platform.twitter.com/widgets.js",function(){var show,views;twitter=true;views=["showErrorMessage","showFacebookLikeView","showTwitterTweetView","showPostSurveyView","showRatingView","showChatView","showRegisterForm","showOfflineMessageForm","showPreSurveyView","showProgressView"];show=function(){var view;view=views.pop();if(!view){return}popup[view](function(){});_ullog("Popup::"+view+" called");if(automatic){setTimeout(function(){return show()},2e3)}};if(!automatic){jq("body").on("click",function(){return show()})}return show()})})})};TrackingFactory=function(){function TrackingFactory(widget){this.widget=widget}TrackingFactory.prototype.get=function(client){_ullog("TrackingFactory type="+config.tracking);if(config.tracking==="ga"){return new TrackingGA(client)}if(config.tracking==="ga"){return new TrackingGAUniversal(client)}else if(config.tracking==="piwik"){return new TrackingPiwik(client)}else if(config.tracking==="kissmetr"){return new TrackingKissMetrics(client)}else if(config.tracking==="mixpanel"){return new TrackingMixpanel(client)}else{return new TrackingDummy}};return TrackingFactory}();TrackingDummy=function(){function TrackingDummy(){}TrackingDummy.prototype.sendOfflineMessage=function(){};TrackingDummy.prototype.offerProactiveChat=function(){};TrackingDummy.prototype.sendMessage=function(){};TrackingDummy.prototype.receiveMessage=function(){};TrackingDummy.prototype.startSlot=function(){};TrackingDummy.prototype.startProactiveSlot=function(){};return TrackingDummy}();TrackingGA=function(superClass){extend(TrackingGA,superClass);function TrackingGA(){return TrackingGA.__super__.constructor.apply(this,arguments)}TrackingGA.prototype.sendOfflineMessage=function(){return typeof _gaq!=="undefined"&&_gaq!==null?_gaq.push(["_trackEvent","Userlike_Chat","Offline_message_sent",""]):void 0};TrackingGA.prototype.offerProactiveChat=function(){return typeof _gaq!=="undefined"&&_gaq!==null?_gaq.push(["_trackEvent","Userlike_Chat","Proactive_chat_offered_to_webuser","Operator_"+session.get("operator_name")]):void 0};TrackingGA.prototype.sendMessage=function(){return typeof _gaq!=="undefined"&&_gaq!==null?_gaq.push(["_trackEvent","Userlike_Chat","Webuser_sent_message","Operator_"+session.get("operator_name")]):void 0};TrackingGA.prototype.receiveMessage=function(){return typeof _gaq!=="undefined"&&_gaq!==null?_gaq.push(["_trackEvent","Userlike_Chat","Webuser_received_message","Operator_"+session.get("operator_name")]):void 0};TrackingGA.prototype.startSlot=function(){return typeof _gaq!=="undefined"&&_gaq!==null?_gaq.push(["_trackEvent","Userlike_Chat","Chat_session_started","Operator_"+session.get("operator_name")]):void 0};TrackingGA.prototype.startProactiveSlot=function(){return typeof _gaq!=="undefined"&&_gaq!==null?_gaq.push(["_trackEvent","Userlike_Chat","Proactive_chat_session_started","Operator_"+session.get("operator_name")]):void 0};return TrackingGA}(TrackingDummy);TrackingGAUniversal=function(superClass){extend(TrackingGAUniversal,superClass);function TrackingGAUniversal(){return TrackingGAUniversal.__super__.constructor.apply(this,arguments)}TrackingGAUniversal.prototype.sendOfflineMessage=function(){return typeof ga==="function"?ga("send","event","Userlike_Chat","Offline_message_sent",""):void 0};TrackingGAUniversal.prototype.offerProactiveChat=function(){return typeof ga==="function"?ga("send","event","Userlike_Chat","Proactive_chat_offered_to_webuser","Operator_"+session.get("operator_name")):void 0};TrackingGAUniversal.prototype.sendMessage=function(){return typeof ga==="function"?ga("send","event","Userlike_Chat","Webuser_sent_message","Operator_"+session.get("operator_name")):void 0};TrackingGAUniversal.prototype.receiveMessage=function(){return typeof ga==="function"?ga("send","event","Userlike_Chat","Webuser_received_message","Operator_"+session.get("operator_name")):void 0};TrackingGAUniversal.prototype.startSlot=function(){return typeof ga==="function"?ga("send","event","Userlike_Chat","Chat_session_started","Operator_"+session.get("operator_name")):void 0};TrackingGAUniversal.prototype.startProactiveSlot=function(){return typeof ga==="function"?ga("send","event","Userlike_Chat","Proactive_chat_session_started","Operator_"+session.get("operator_name")):void 0};return TrackingGAUniversal}(TrackingDummy);TrackingPiwik=function(superClass){extend(TrackingPiwik,superClass);function TrackingPiwik(){return TrackingPiwik.__super__.constructor.apply(this,arguments)}TrackingPiwik.prototype.sendOfflineMessage=function(){if(typeof _paq!=="undefined"&&_paq!==null){_paq.push(["setCustomVariable",1,"Offline_message_sent",""])}return typeof _paq!=="undefined"&&_paq!==null?_paq.push(["trackPageView"]):void 0};TrackingPiwik.prototype.offerProactiveChat=function(){if(typeof _paq!=="undefined"&&_paq!==null){_paq.push(["setCustomVariable",2,"Proactive_chat_offered_to_webuser","Operator_"+session.get("operator_name")])}return typeof _paq!=="undefined"&&_paq!==null?_paq.push(["trackPageView"]):void 0};TrackingPiwik.prototype.startProactiveSlot=function(){if(typeof _paq!=="undefined"&&_paq!==null){_paq.push(["setCustomVariable",3,"Proactive_chat_session_started","Operator_"+session.get("operator_name")])}return typeof _paq!=="undefined"&&_paq!==null?_paq.push(["trackPageView"]):void 0};TrackingPiwik.prototype.startSlot=function(){if(typeof _paq!=="undefined"&&_paq!==null){_paq.push(["setCustomVariable",4,"Chat_session_started","Operator_"+session.get("operator_name")])}return typeof _paq!=="undefined"&&_paq!==null?_paq.push(["trackPageView"]):void 0};TrackingPiwik.prototype.sendMessage=function(){};TrackingPiwik.prototype.receiveMessage=function(){};return TrackingPiwik}(TrackingDummy);TrackingKissMetrics=function(superClass){extend(TrackingKissMetrics,superClass);function TrackingKissMetrics(){if(typeof _kmq!=="undefined"&&_kmq!==null){_kmq.push(["identify",session.get("uuid")])}}TrackingKissMetrics.prototype.sendOfflineMessage=function(){return typeof _kmq!=="undefined"&&_kmq!==null?_kmq.push(["record","Userlike_Chat",{action:"Offline_message_sent",operator:""}]):void 0};TrackingKissMetrics.prototype.offerProactiveChat=function(){return typeof _kmq!=="undefined"&&_kmq!==null?_kmq.push(["record","Userlike_Chat",{action:"Proactive_chat_offered_to_webuser",operator:session.get("operator_name")}]):void 0};TrackingKissMetrics.prototype.startProactiveSlot=function(){return typeof _kmq!=="undefined"&&_kmq!==null?_kmq.push(["record","Userlike_Chat",{action:"Proactive_chat_session_started",operator:session.get("operator_name")}]):void 0};TrackingKissMetrics.prototype.startSlot=function(){return typeof _kmq!=="undefined"&&_kmq!==null?_kmq.push(["record","Userlike_Chat",{action:"Chat_session_started",operator:session.get("operator_name")}]):void 0};TrackingKissMetrics.prototype.sendMessage=function(){return typeof _kmq!=="undefined"&&_kmq!==null?_kmq.push(["record","Userlike_Chat",{action:"Webuser_sent_message",operator:session.get("operator_name")}]):void 0};TrackingKissMetrics.prototype.receiveMessage=function(){return typeof _kmq!=="undefined"&&_kmq!==null?_kmq.push(["record","Userlike_Chat",{action:"Webuser_received_message",operator:session.get("operator_name")}]):void 0};return TrackingKissMetrics}(TrackingDummy);TrackingMixpanel=function(superClass){extend(TrackingMixpanel,superClass);function TrackingMixpanel(){if(typeof mixpanel!=="undefined"&&mixpanel!==null){mixpanel.identify(session.get("uuid"))}}TrackingMixpanel.prototype.sendOfflineMessage=function(){return typeof mixpanel!=="undefined"&&mixpanel!==null?mixpanel.track("Userlike_Chat",{action:"Offline_message_sent",operator:""}):void 0};TrackingMixpanel.prototype.offerProactiveChat=function(){return typeof mixpanel!=="undefined"&&mixpanel!==null?mixpanel.track("Userlike_Chat",{action:"Proactive_chat_offered_to_webuser",operator:session.get("operator_name")}):void 0};TrackingMixpanel.prototype.startProactiveSlot=function(){return typeof mixpanel!=="undefined"&&mixpanel!==null?mixpanel.track("Userlike_Chat",{action:"Proactive_chat_session_started",operator:session.get("operator_name")}):void 0};TrackingMixpanel.prototype.startSlot=function(){return typeof mixpanel!=="undefined"&&mixpanel!==null?mixpanel.track("Userlike_Chat",{action:"Chat_session_started",operator:session.get("operator_name")}):void 0};TrackingMixpanel.prototype.sendMessage=function(){return typeof mixpanel!=="undefined"&&mixpanel!==null?mixpanel.track("Userlike_Chat",{action:"Webuser_sent_message",operator:session.get("operator_name")}):void 0};TrackingMixpanel.prototype.receiveMessage=function(){return typeof mixpanel!=="undefined"&&mixpanel!==null?mixpanel.track("Userlike_Chat",{action:"Webuser_received_message",operator:session.get("operator_name")}):void 0};return TrackingMixpanel}(TrackingDummy);TrackingEvent=function(){function TrackingEvent(){}TrackingEvent.prototype.events_chat={rating_show:true,rating_cancel:true,rating_submit:true,feedback_show:true,feedback_cancel:true,feedback_submit:true,post_survey_show:true,post_survey_cancel:true,post_survey_submit:true,facebook_like_show:true,facebook_like_cancel:true,twitter_tweet_show:true,twitter_tweet_tweeted:true,twitter_tweet_cancel:true,chat_connected:true,chat_connected_proactive:true,chat_started:true,chat_started_proactive:true,chat_quit:true,chat_window_minimzed:true,chat_window_maximized:true,chat_reconnect:true,message_operator_terminating:true,message_client_terminating:true,message_client_terminating_first:true,proactive_offer:true,proactive_reject:true};TrackingEvent.prototype.events={chat_passive_connect:true,register_show:true,register_cancel:true,register_submit:true,group_select_show:true,group_select_cancel:true,group_select_submit:true,pre_survey_show:true,pre_survey_cancel:true,pre_survey_submit:true,button_hidden:true,button_displayed:true,chat_requested:true,proactive_timer:true,proactive_unavailable:true,slot_check:true,slot_available:true,slot_unavailable:true,slot_connect:true,error_message:true,offline_mode:true,offline_form_show:true,offline_view_show:true,offline_form_submit:true,facebook_login_timeout:true,facebook_login_status_response:true,facebook_login_success:true,facebook_login_failure:true,facebook_me_response:true,window_visible:true,window_invisible:true};TrackingEvent.prototype.globalCTX=function(){var global_ctx;global_ctx={widget_id:config.chat_widget_id,widget_lang:config.lang,operator_group_id:config.operator_group_id,client_uuid:session.get("uuid")};return global_ctx};TrackingEvent.prototype.sessionCTX=function(name){var session_ctx;session_ctx={client_name:session.get("name"),client_email:session.get("email"),session_id:session.get("id"),chat_id:void 0,custom_data:session.getCustomFromAPI(),duration:session.getChatDuration(),operator_id:void 0,operator_name:void 0};if(this.events_chat[name]!=null){session_ctx.operator_id=session.get("operator_id");session_ctx.operator_name=session.get("operator_name");session_ctx.chat_id=session.get("meta_id")}return session_ctx};TrackingEvent.prototype.trigger=function(name){if(typeof userlikeTrackingEvent!=="function"){return}return userlikeTrackingEvent(name,this.globalCTX(),session.addAdditionalRegisterValues(this.sessionCTX(name)))};TrackingEvent.prototype.track=function(name){var data;data={name:name,customer_id:config.customer_id,widget_id:config.chat_widget_id,operator_id:session.get("operator_id"),operator_group_id:config.operator_group_id,session_id:session.get("id"),client_uuid:session.get("uuid")};return(new Image).src=protocol()+"track.userlike.com/pixel.gif?"+serialize(data)};return TrackingEvent}();App.get().run(userlikeConfig.app_key,userlikeConfig.widget_key,userlikeConfig.data)}).call(this);var JSON;if(!JSON){JSON={}}(function(){"use strict";function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else if(typeof space==="string"){indent=space}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}})();
